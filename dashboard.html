<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Syn Agency</title>
    <meta name="description" content="Tableau de bord Syn Agency - Suivez vos performances et gérez votre compte">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="./css/style.css?v=1.7">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="./js/of-config.js"></script>
    <script src="./js/onlyfans-api.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Animations simplifiées - visibilité garantie */
        @keyframes slideInUp {
            from {
                opacity: 1;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 1;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 1;
                transform: translateX(10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 1;
                transform: scale(0.98);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 1;
                transform: scale(0.95);
            }
            50% {
                transform: scale(1.02);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes glowPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(180,138,255,0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(180,138,255,0.6), 0 0 60px rgba(180,138,255,0.3);
            }
        }

        @keyframes floatAnimation {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        @keyframes cardHover {
            0% {
                transform: translateY(0) scale(1);
                filter: brightness(1);
            }
            100% {
                transform: translateY(-8px) scale(1.02);
                filter: brightness(1.1);
            }
        }

        /* Classes d'animation */
        .animate-slide-up {
            animation: slideInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-slide-left {
            animation: slideInLeft 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-slide-right {
            animation: slideInRight 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-fade-scale {
            animation: fadeInScale 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-bounce {
            animation: bounceIn 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-float {
            animation: floatAnimation 3s ease-in-out infinite;
        }

        .animate-glow {
            animation: glowPulse 2s ease-in-out infinite;
        }

        /* État initial pour les animations */
        .dashboard-header,
        .financial-section,
        .activities-section,
        .tips-section {
            opacity: 0;
            transform: translateY(40px);
        }

        /* Animations de hover interactives */
        .interactive-hover {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .interactive-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(180,138,255,0.3);
            filter: brightness(1.1) saturate(1.1);
        }

        /* Animation shimmer pour les boutons */
        .shimmer-effect {
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.2) 50%, 
                transparent 100%);
            background-size: 200% 100%;
            animation: shimmer 2s ease-in-out infinite;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a093e, #120726);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .dashboard-header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
        }

        .dashboard-title {
            color: #b48aff;
            font-size: 2.5em;
            font-weight: 700;
            margin: 0;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(26,9,62,0.7);
            border-radius: 12px;
            padding: 12px 20px;
            border: 1px solid #23233a;
        }

        .notification-bell {
            position: relative;
            background: rgba(180,138,255,0.1);
            border: 1px solid #b48aff;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-right: 10px;
            z-index: 99998;
            overflow: visible !important;
            animation: subtleBreathe 4s ease-in-out infinite;
        }

        @keyframes subtleBreathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .notification-bell:hover {
            background: rgba(180,138,255,0.2);
            transform: scale(1.1) !important;
            box-shadow: 0 0 20px rgba(180,138,255,0.4);
            animation: none;
        }

        .notification-bell i {
            color: #b48aff;
            font-size: 1.2em;
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: 600;
        }

        .notification-dropdown {
            position: absolute !important;
            top: 100% !important;
            right: -10px !important;
            background: rgba(26,9,62,0.98) !important;
            border: 1px solid #b48aff !important;
            border-radius: 12px !important;
            width: 350px !important;
            max-height: 400px !important;
            overflow-y: auto !important;
            z-index: 999999 !important;
            display: none !important;
            margin-top: 10px !important;
            backdrop-filter: blur(15px) !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5), 0 0 0 1px rgba(180,138,255,0.3) !important;
        }

        .notification-dropdown.show {
            display: block;
            animation: slideDown 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes slideDown {
            from {
                opacity: 1;
                transform: translateY(-5px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 1;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 1;
                transform: translateX(10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(180,138,255,0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(180,138,255,0.6);
            }
        }
        
        @keyframes shimmer {
            0% {
                transform: translateX(-100%) skewX(-15deg);
            }
            100% {
                transform: translateX(200%) skewX(-15deg);
            }
        }

        /* Nouvelles animations pour les améliorations */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }

        @keyframes chartGrow {
            from {
                height: 0;
                opacity: 1;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes drawCircle1 {
            from {
                stroke-dashoffset: 251.2;
            }
            to {
                stroke-dashoffset: 62.8;
            }
        }

        @keyframes drawCircle2 {
            from {
                stroke-dashoffset: 251.2;
            }
            to {
                stroke-dashoffset: 125.6;
            }
        }

        @keyframes drawCircle3 {
            from {
                stroke-dashoffset: 251.2;
            }
            to {
                stroke-dashoffset: 188.4;
            }
        }

        @keyframes celebrateCard {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05) rotate(1deg);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Animations pour les cartes d'accomplissements */
        .achievement-card:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .achievement-card.unlocked:hover {
            box-shadow: 0 15px 40px rgba(255,215,0,0.4);
        }

        /* Animations pour les cartes de temps réel */
        .realtime-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .realtime-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(180,138,255,0.25);
        }

        /* Animation pour les éléments de la timeline */
        .timeline-item {
            transition: all 0.3s ease;
        }

        .timeline-item:hover {
            background: rgba(180,138,255,0.05);
            transform: translateX(5px);
            border-radius: 12px;
            margin: 0 -10px;
            padding: 15px 25px;
        }

        .timeline-icon {
            transition: all 0.3s ease;
        }

        .timeline-item:hover .timeline-icon {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        /* Styles pour les cartes de tendances */
        .trend-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .trend-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(180,138,255,0.25);
            border-color: rgba(180,138,255,0.4);
        }

        /* Animations pour les jours du calendrier */
        .calendar-day {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .calendar-day:hover {
            background: rgba(180,138,255,0.2) !important;
            transform: scale(1.1);
            color: white !important;
        }

        .calendar-day.today {
            animation: pulseGlow 2s ease-in-out infinite;
        }

        /* Styles pour les cartes de santé du compte */
        .health-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .health-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(180,138,255,0.25);
        }

        /* Animation pour les barres de progression */
        .progress-bar div {
            animation: progressFill 2s ease-in-out;
        }

        @keyframes progressFill {
            from {
                width: 0;
            }
        }

        /* Styles pour les hashtags */
        .trend-card span {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .trend-card span:hover {
            background: rgba(180,138,255,0.4) !important;
            transform: scale(1.05);
        }

        /* Animation pour les indicateurs live */
        .live-indicator {
            animation: subtleBounce 2s ease-in-out infinite;
        }

        @keyframes subtleBounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-2px);
            }
        }

        /* Styles responsive améliorés */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .calendar-grid {
                gap: 1px;
            }
            
            .calendar-day {
                padding: 4px;
                font-size: 0.8em;
            }
            
            .achievements-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .trends-grid {
                grid-template-columns: 1fr;
            }
            
            .realtime-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .timeline-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .timeline-content {
                order: 1;
            }

            .timeline-icon {
                order: 0;
                align-self: center;
            }
        }

        .notification-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(180,138,255,0.2);
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .notification-title {
            color: #b48aff;
            font-weight: 600;
            margin: 0;
            font-size: 1.1em;
        }

        .notification-dropdown .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .notification-dropdown .notification-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(180,138,255,0.1), transparent);
            transition: width 0.3s ease;
        }

        .notification-dropdown .notification-item:hover {
            background: rgba(180,138,255,0.1);
            transform: translateX(5px);
        }

        .notification-dropdown .notification-item:hover::before {
            width: 100%;
        }

        .notification-dropdown .notification-item:last-child {
            border-bottom: none;
        }

        .notification-dropdown .notification-dot {
            width: 8px;
            height: 8px;
            background: #b48aff;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .notification-dropdown .notification-content {
            flex: 1;
        }

        .notification-dropdown .notification-text {
            color: #f5f5fa;
            margin: 0 0 4px 0;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .notification-dropdown .notification-time {
            color: #b0b0b0;
            font-size: 0.8em;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #b48aff, #6c2eb6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2em;
        }

        .user-info h3 {
            color: #f5f5fa;
            margin: 0;
            font-size: 1.1em;
        }

        .user-info p {
            color: #b48aff;
            margin: 0;
            font-size: 0.9em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(26,9,62,0.7);
            border-radius: 18px;
            padding: 25px;
            border: 1px solid #23233a;
            box-shadow: 0 4px 24px rgba(80,0,160,0.13);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            transform: translateY(0) scale(1);
            backface-visibility: hidden;
            will-change: transform, box-shadow;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s ease;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(180,138,255,0.25);
            border-color: rgba(180,138,255,0.4);
        }

        .stat-card:hover::after {
            left: 100%;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #b48aff, #6c2eb6);
        }

        .stat-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #b48aff, #6c2eb6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 800;
            color: #b48aff;
            margin: 10px 0;
        }

        .stat-label {
            color: #f5f5fa;
            font-size: 1.1em;
            font-weight: 600;
        }

        .stat-change {
            font-size: 0.9em;
            margin-top: 8px;
        }

        .positive {
            color: #4CAF50;
        }

        .negative {
            color: #f44336;
        }

        .charts-section {
            margin-bottom: 40px;
        }

        .profile-section {
            margin-bottom: 40px;
        }

        .profile-card {
            background: rgba(26,9,62,0.7);
            border-radius: 18px;
            padding: 30px;
            border: 1px solid #23233a;
            box-shadow: 0 4px 24px rgba(80,0,160,0.13);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(180,138,255,0.1);
        }

        .profile-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #b48aff, #6c2eb6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8em;
        }

        .profile-info {
            flex: 1;
        }

        .profile-info h3 {
            color: #f5f5fa;
            margin: 0 0 5px 0;
            font-size: 1.4em;
            font-weight: 600;
        }

        .profile-info p {
            color: #b0b0b0;
            margin: 0;
            font-size: 0.95em;
        }

        .profile-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-indicator.connected {
            background: #4CAF50;
            box-shadow: 0 0 8px rgba(76,175,80,0.4);
        }

        .status-indicator.disconnected {
            background: #f44336;
            box-shadow: 0 0 8px rgba(244,67,54,0.4);
        }

        /* Styles pour garantir que le modal soit toujours au premier plan */
        #invoice-modal {
            z-index: 2147483647 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
        }
        
        #invoice-modal * {
            z-index: 2147483647 !important;
        }
        
        .modal-open #invoice-modal {
            z-index: 2147483647 !important;
        }
        
        /* Force l'affichage du modal au-dessus de tout */
        body.modal-open {
            position: fixed !important;
            width: 100% !important;
            overflow: hidden !important;
        }
        
        body.modal-open * {
            z-index: auto !important;
        }
        
        body.modal-open #invoice-modal,
        body.modal-open #invoice-modal * {
            z-index: 2147483647 !important;
        }

        .status-text {
            color: #f5f5fa;
            font-size: 0.9em;
            font-weight: 600;
        }

        .profile-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .profile-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: #f5f5fa;
            font-weight: 600;
            font-size: 0.95em;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper i {
            position: absolute;
            left: 15px;
            color: #b48aff;
            z-index: 1;
        }

        .input-wrapper input,
        .input-wrapper textarea {
            width: 100%;
            background: rgba(180,138,255,0.1);
            border: 1px solid rgba(180,138,255,0.3);
            border-radius: 12px;
            padding: 12px 15px 12px 45px;
            color: #f5f5fa;
            font-size: 0.95em;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
        }

        .input-wrapper input:focus,
        .input-wrapper textarea:focus {
            outline: none;
            border-color: #b48aff;
            background: rgba(180,138,255,0.15);
            box-shadow: 0 0 0 3px rgba(180,138,255,0.1), 0 0 20px rgba(180,138,255,0.2);
            transform: translateY(-2px);
        }

        .input-wrapper input:disabled,
        .input-wrapper textarea:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .input-wrapper input::placeholder,
        .input-wrapper textarea::placeholder {
            color: #888;
        }

        .profile-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(180,138,255,0.1);
        }

        .connect-btn,
        .sync-btn {
            background: linear-gradient(135deg, #b48aff, #6c2eb6);
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            color: white;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .connect-btn:hover,
        .sync-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(180,138,255,0.3);
        }

        .sync-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #555;
        }

        .profile-features {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(180,138,255,0.1);
        }

        .profile-features h4 {
            color: #f5f5fa;
            margin: 0 0 15px 0;
            font-size: 1.1em;
        }

        .features-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .features-list li {
            color: #b0b0b0;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .features-list li i {
            color: #4CAF50;
            font-size: 0.8em;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .chart-card {
            background: rgba(26,9,62,0.7);
            border-radius: 18px;
            padding: 25px;
            border: 1px solid #23233a;
            box-shadow: 0 4px 24px rgba(80,0,160,0.13);
        }

        .chart-title {
            color: #f5f5fa;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .chart-placeholder {
            height: 300px;
            background: rgba(180,138,255,0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #b48aff;
            font-size: 1.1em;
            border: 2px dashed rgba(180,138,255,0.3);
        }

        .activities-section {
            margin-bottom: 40px;
        }

        .activities-card {
            background: rgba(26,9,62,0.7);
            border-radius: 18px;
            padding: 25px;
            border: 1px solid #23233a;
            box-shadow: 0 4px 24px rgba(80,0,160,0.13);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(180,138,255,0.1);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #b48aff, #6c2eb6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1em;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            color: #f5f5fa;
            font-weight: 600;
            margin: 0 0 5px 0;
        }

        .activity-desc {
            color: #b0b0b0;
            font-size: 0.9em;
            margin: 0;
        }

        .activity-time {
            color: #888;
            font-size: 0.8em;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .action-btn {
            background: linear-gradient(135deg, #b48aff, #6c2eb6);
            border: none;
            border-radius: 12px;
            padding: 20px;
            color: white;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            position: relative;
            overflow: hidden;
            transform: translateY(0) scale(1);
            backface-visibility: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s ease;
        }

        .action-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(180,138,255,0.4);
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:active {
            transform: translateY(-3px) scale(1.02);
        }

        .notifications-panel {
            background: rgba(26,9,62,0.7);
            border-radius: 18px;
            padding: 25px;
            border: 1px solid #23233a;
            box-shadow: 0 4px 24px rgba(80,0,160,0.13);
            margin-bottom: 20px;
        }

        .notification-item {
            display: flex;
            align-items: start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(180,138,255,0.1);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            margin-top: 6px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-text {
            color: #f5f5fa;
            margin: 0 0 5px 0;
            font-size: 0.95em;
        }

        .notification-time {
            color: #888;
            font-size: 0.8em;
        }

        .nav-dashboard {
            background: linear-gradient(135deg, rgba(26,9,62,0.95), rgba(18,7,45,0.95));
            backdrop-filter: blur(15px);
            padding: 20px 0;
            border-bottom: 1px solid rgba(180,138,255,0.2);
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            margin-top: 0;
        }

        .nav-dashboard .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            color: #b48aff;
            font-size: 1.8em;
            font-weight: 700;
            text-decoration: none;
            background: linear-gradient(45deg, #b48aff, #8a5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            filter: none;
            backface-visibility: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .nav-brand:hover {
            background: linear-gradient(45deg, #c49fff, #9d6eff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: brightness(1.2) contrast(1.1);
            box-shadow: 0 0 20px rgba(180,138,255,0.4);
        }

        .nav-links {
            display: flex;
            gap: 8px;
            align-items: center;
            background: rgba(35,35,58,0.6);
            border-radius: 25px;
            padding: 8px;
            border: 1px solid rgba(180,138,255,0.1);
        }

        .nav-links a {
            color: #f5f5fa;
            text-decoration: none;
            font-weight: 500;
            padding: 12px 20px;
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            white-space: nowrap;
            background: transparent;
            border: 1px solid transparent;
            transform: translateY(0);
        }

        .nav-links a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(180,138,255,0.1), transparent);
            transition: left 0.6s ease;
        }

        .nav-links a:hover {
            color: #b48aff;
            background: rgba(180,138,255,0.1);
            border-color: rgba(180,138,255,0.3);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 5px 15px rgba(180,138,255,0.2);
        }

        .nav-links a:hover::before {
            left: 100%;
        }

        .nav-links a:hover::before {
            left: 100%;
        }

        .nav-links a:hover {
            color: #b48aff;
            background: rgba(180,138,255,0.1);
            border-color: rgba(180,138,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(180,138,255,0.2);
        }

        .nav-links a i {
            font-size: 1.1em;
            transition: transform 0.3s ease;
        }

        .nav-links a:hover i {
            transform: scale(1.1);
        }

        /* Style spécial pour le bouton de déconnexion */
        .nav-links a[onclick*="logout"] {
            background: rgba(255,71,87,0.1);
            border-color: rgba(255,71,87,0.2);
            color: #ff4757;
        }

        .nav-links a[onclick*="logout"]:hover {
            background: rgba(255,71,87,0.2);
            border-color: rgba(255,71,87,0.4);
            color: #ff4757;
            box-shadow: 0 8px 25px rgba(255,71,87,0.2);
        }

        /* Styles pour l'administration */
        .admin-tab-btn {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .admin-tab-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255,193,7,0.3);
        }

        .admin-tab-content {
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Style spécial pour le lien d'administration */
        .nav-links a[onclick*="showAdminPanel"]:hover {
            background: rgba(255,193,7,0.2) !important;
            border-color: rgba(255,193,7,0.4) !important;
            color: #ffc107 !important;
            box-shadow: 0 8px 25px rgba(255,193,7,0.2) !important;
        }

        /* Styles pour garantir l'affichage du modal */
        .modal-open {
            overflow: hidden !important;
            height: 100vh !important;
        }
        
        /* Style pour le bouton de test */
        .action-btn:last-child {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* S'assurer que le modal de secours est au-dessus de tout */
        #backup-invoice-modal {
            z-index: 2147483647 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
        }

        /* CORRECTION DE VISIBILITÉ - Forcer l'affichage des éléments principaux */
        body, 
        .dashboard-container, 
        .dashboard-header, 
        .financial-section, 
        .activities-section,
        .tips-section,
        .nav-dashboard,
        #financial-commissions,
        .financial-tab-content {
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
        }
        
        .nav-dashboard {
            display: flex !important;
        }
        
        /* Forcer la visibilité des boutons et liens */
        button, a, .nav-links a {
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        /* Exceptions pour les éléments qui doivent rester cachés */
        #add-model-modal[style*="display: none"],
        #models-list[style*="display: none"],
        .notification-dropdown:not(.show) {
            display: none !important;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 15px;
            }

            .dashboard-title {
                font-size: 2em;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                text-align: center;
                flex-direction: column;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .nav-dashboard .container {
                flex-direction: column;
                gap: 20px;
                padding: 0 15px;
            }

            .nav-brand {
                font-size: 1.5em;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
                gap: 6px;
                padding: 6px;
                background: rgba(35,35,58,0.8);
            }

            .nav-links a {
                padding: 10px 16px;
                font-size: 0.85em;
                min-width: auto;
            }

            .nav-links a span {
                display: none;
            }

            .nav-links a i {
                margin-right: 0;
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Dashboard -->
    <nav class="nav-dashboard">
        <div class="container">
            <a href="index.html" class="nav-brand">Syn Agency</a>
            <div class="nav-links">
                <a href="index.html"><i class="fas fa-home"></i> <span>Accueil</span></a>
                <a href="#" onclick="showMaintenanceNotification('Analytics'); return false;" style="opacity: 0.6; cursor: not-allowed;"><i class="fas fa-chart-line"></i> <span>Analytics</span></a>
                <a href="content.html"><i class="fas fa-folder"></i> <span>Contenu</span></a>
                <a href="#" onclick="showMaintenanceNotification('Messages'); return false;" style="opacity: 0.6; cursor: not-allowed;"><i class="fas fa-envelope"></i> <span>Messages</span></a>
                <a href="settings.html"><i class="fas fa-cog"></i> <span>Paramètres</span></a>
                <a href="#" id="admin-link" onclick="showAdminPanel(); return false;" style="display: none; background: rgba(255,193,7,0.1); border-color: rgba(255,193,7,0.3); color: #ffc107;"><i class="fas fa-crown"></i> <span>Administration</span></a>
                <a href="#" onclick="logout(); return false;"><i class="fas fa-sign-out-alt"></i> <span>Déconnexion</span></a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div>
                <h1 class="dashboard-title">Tableau de Bord</h1>
                <a href="index.html" class="back-to-site-btn" style="
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    background: rgba(180,138,255,0.1);
                    border: 1px solid #b48aff;
                    border-radius: 8px;
                    padding: 8px 16px;
                    color: #b48aff;
                    text-decoration: none;
                    font-weight: 600;
                    font-size: 0.9em;
                    transition: all 0.3s ease;
                    margin-top: 10px;
                " onmouseover="this.style.background='rgba(180,138,255,0.2)'; this.style.transform='translateY(-3px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(180,138,255,0.3)'" onmouseout="this.style.background='rgba(180,138,255,0.1)'; this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'">
                    <i class="fas fa-arrow-left"></i>
                    Retour au site
                </a>
            </div>
            <div style="display: flex; align-items: center; gap: 15px; position: absolute; right: 0; top: 0;">
                <div class="user-profile">
                    <div class="user-avatar" id="user-avatar">US</div>
                    <div class="user-info">
                        <h3 id="user-name">Utilisateur</h3>
                        <p id="user-role">Membre</p>
                    </div>
                </div>
                <div class="notification-bell" onclick="toggleNotifications()">
                    <i class="fas fa-bell"></i>
                    <div class="notification-badge">4</div>
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <h3 class="notification-title">Notifications</h3>
                        </div>
                        <div class="notification-item">
                            <div class="notification-dot"></div>
                            <div class="notification-content">
                                <p class="notification-text">Bienvenue dans votre espace Syn Agency</p>
                                <div class="notification-time">Maintenant</div>
                            </div>
                        </div>
                        <div class="notification-item">
                            <div class="notification-dot"></div>
                            <div class="notification-content">
                                <p class="notification-text">Explorez les fonctionnalités disponibles</p>
                                <div class="notification-time">Information</div>
                            </div>
                        </div>
                        <div class="notification-item">
                            <div class="notification-dot"></div>
                            <div class="notification-content">
                                <p class="notification-text">Configurez vos préférences dans les paramètres</p>
                                <div class="notification-time">Conseil</div>
                            </div>
                        </div>
                        <div class="notification-item">
                            <div class="notification-dot"></div>
                            <div class="notification-content">
                                <p class="notification-text">Contactez le support si vous avez des questions</p>
                                <div class="notification-time">Aide</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gestion Financière -->
        <section class="financial-section" style="margin-bottom: 40px;">
            <h2 style="color: #b48aff; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-coins"></i>
                Gestion Financière
                <div style="background: rgba(34,197,94,0.2); color: #22c55e; padding: 4px 8px; border-radius: 12px; font-size: 0.7em; font-weight: 600;">
                    � COMPTABILITÉ
                </div>
            </h2>

            <!-- Indicateurs financiers -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div style="background: rgba(26,9,62,0.7); border-radius: 15px; padding: 20px; border: 1px solid #23233a;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <i class="fas fa-users" style="color: #3b82f6; font-size: 1.5em;"></i>
                        <div>
                            <h4 style="color: #f5f5fa; margin: 0; font-size: 0.9em;">Nombre de modèles</h4>
                            <div style="color: #f59e0b; font-size: 1.8em; font-weight: bold;" id="pending-invoices">0</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(26,9,62,0.7); border-radius: 15px; padding: 20px; border: 1px solid #23233a;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <i class="fas fa-euro-sign" style="color: #22c55e; font-size: 1.5em;"></i>
                        <div>
                            <h4 style="color: #f5f5fa; margin: 0; font-size: 0.9em;">Revenus des modèles</h4>
                            <div style="color: #888; font-size: 1.8em; font-weight: bold;" id="monthly-revenue">--</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(26,9,62,0.7); border-radius: 15px; padding: 20px; border: 1px solid #23233a;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <i class="fas fa-percentage" style="color: #ec4899; font-size: 1.5em;"></i>
                        <div>
                            <h4 style="color: #f5f5fa; margin: 0; font-size: 0.9em;">Commissions totales</h4>
                            <div style="color: #888; font-size: 1.8em; font-weight: bold;" id="total-commissions">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglets de gestion -->
            <div style="background: rgba(26,9,62,0.7); border-radius: 20px; padding: 25px; border: 1px solid #23233a; box-shadow: 0 4px 24px rgba(80,0,160,0.13);">
                <!-- Navigation des onglets -->
                <div style="display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 1px solid rgba(180,138,255,0.2); padding-bottom: 15px;">
                    <button onclick="showFinancialTab('commissions')" id="tab-commissions" style="
                        background: linear-gradient(135deg, #3b82f6, #2563eb);
                        border: none;
                        border-radius: 10px;
                        padding: 10px 20px;
                        color: white;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 0.9em;
                    ">
                        💳 Commissions
                    </button>
                </div>

                <!-- Contenu Commissions (par défaut visible) -->
                <div id="financial-commissions" class="financial-tab-content">
                    <!-- En-tête principal centré -->
                    <div style="text-align: center; margin-bottom: 35px; padding: 25px; background: linear-gradient(135deg, rgba(180,138,255,0.15), rgba(139,92,246,0.1)); border-radius: 20px; border: 2px solid rgba(180,138,255,0.3);">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #b48aff, #9333ea); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto; box-shadow: 0 15px 35px rgba(180,138,255,0.4);">
                            <i class="fas fa-users" style="color: white; font-size: 2em;"></i>
                        </div>
                        <h2 style="color: #f5f5fa; margin: 0 0 10px 0; font-size: 2em; font-weight: 700;">Gestion des Modèles</h2>
                        <p style="color: rgba(245,245,250,0.8); margin: 0 0 25px 0; font-size: 1.1em;">Gérez vos modèles et leurs commissions en temps réel</p>
                        
                        <!-- Statistiques rapides -->
                        <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 25px;">
                            <div style="text-align: center;">
                                <div style="color: #22c55e; font-size: 1.8em; font-weight: bold;" id="active-models-count-header">0</div>
                                <div style="color: rgba(245,245,250,0.7); font-size: 0.9em;">Modèles actifs</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #f59e0b; font-size: 1.8em; font-weight: bold;" id="average-commission-header">0%</div>
                                <div style="color: rgba(245,245,250,0.7); font-size: 0.9em;">Commission moy.</div>
                            </div>
                            <div style="text-align: center; cursor: pointer;" onclick="showRevenueInfo()">
                                <div style="color: #3b82f6; font-size: 1.8em; font-weight: bold; position: relative;" id="estimated-revenue-header">
                                    0€
                                    <i class="fas fa-info-circle" style="font-size: 0.5em; position: absolute; top: -5px; right: -15px; color: rgba(59,130,246,0.6);"></i>
                                </div>
                                <div style="color: rgba(245,245,250,0.7); font-size: 0.9em; display: flex; justify-content: space-between; align-items: center;">
                                    <span>Revenus estimés</span>
                                    <i class="fas fa-calculator" style="font-size: 0.8em;"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Bouton d'ajout principal -->
                        <button onclick="openAddModelModal()" style="
                            background: linear-gradient(135deg, #22c55e, #16a34a);
                            border: none;
                            border-radius: 15px;
                            padding: 16px 32px;
                            color: white;
                            font-weight: 700;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            font-size: 1.1em;
                            box-shadow: 0 8px 25px rgba(34,197,94,0.3);
                        " onmouseover="this.style.transform='translateY(-3px) scale(1.05)'; this.style.boxShadow='0 15px 40px rgba(34,197,94,0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 8px 25px rgba(34,197,94,0.3)'">
                            <i class="fas fa-plus-circle"></i> Ajouter votre premier modèle
                        </button>
                    </div>

                    <!-- Liste des modèles - Centré avec une meilleure présentation -->
                    <div id="models-list" style="
                        display: none;
                        max-width: 1400px;
                        margin: 0 auto;
                        grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); 
                        gap: 25px; 
                        padding: 0 20px;
                    ">
                        <!-- Les modèles seront ajoutés dynamiquement ici -->
                    </div>

                    <!-- Modal d'ajout de modèle -->
                    <div id="add-model-modal" style="
                        display: none; 
                        position: absolute !important; 
                        top: 0 !important; 
                        left: 0 !important; 
                        width: 100% !important; 
                        height: 100% !important; 
                        background: rgba(18,7,45,0.90) !important; 
                        z-index: 100 !important;
                        backdrop-filter: blur(10px) !important;
                        padding: 20px !important;
                        box-sizing: border-box !important;
                        border-radius: 20px !important;
                        margin: 20px 0 !important;
                    " onclick="closeAddModelModal()">
                        <div style="
                            background: linear-gradient(135deg, #1a093e, #120726) !important; 
                            border-radius: 20px !important; 
                            padding: 35px 30px 25px 30px !important; 
                            max-width: 500px !important; 
                            width: 100% !important; 
                            border: 2px solid #b48aff !important; 
                            box-shadow: 0 20px 60px rgba(0,0,0,0.5) !important; 
                            position: absolute !important; 
                            top: 50% !important; 
                            left: 50% !important; 
                            transform: translate(-50%, -50%) !important; 
                            backdrop-filter: blur(15px) !important; 
                            margin: 0 !important;
                        " onclick="event.stopPropagation();">
                            <button onclick="closeAddModelModal()" style="position:absolute; top:15px; right:15px; background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); color:#ef4444; font-size:1.2em; cursor:pointer; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(239,68,68,0.2)'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='rgba(239,68,68,0.1)'; this.style.transform='scale(1)'">&times;</button>
                            
                            <div style="text-align: center; margin-bottom: 25px;">
                                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #b48aff, #9333ea); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto; box-shadow: 0 8px 25px rgba(180,138,255,0.3);">
                                    <i class="fas fa-user-plus" style="color: white; font-size: 1.5em;"></i>
                                </div>
                                <h3 style="color:#b48aff; margin: 0; font-size: 1.4em; font-weight: 700;">Ajouter un modèle</h3>
                                <p style="color: rgba(245,245,250,0.7); margin: 8px 0 0 0; font-size: 0.9em;">Ajoutez un nouveau modèle et configurez sa commission</p>
                            </div>
                            
                            <form id="add-model-form" onsubmit="submitAddModelForm(event)">
                                <div style="margin-bottom: 18px;">
                                    <label style="color:#f5f5fa; font-size:0.95em; font-weight: 600; display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <i class="fas fa-user" style="color: #b48aff;"></i>
                                        Nom du modèle
                                    </label>
                                    <input type="text" id="model-name" required placeholder="Ex: Sarah Martin, Emma K..." style="width:100%; border-radius:12px; border:2px solid rgba(180,138,255,0.3); background:rgba(180,138,255,0.05); color:#f5f5fa; padding:12px 15px; font-size: 0.95em; transition: all 0.3s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#b48aff'; this.style.boxShadow='0 0 0 3px rgba(180,138,255,0.1)'" onblur="this.style.borderColor='rgba(180,138,255,0.3)'; this.style.boxShadow='none'">
                                </div>
                                
                                <div style="margin-bottom: 18px;">
                                    <label style="color:#f5f5fa; font-size:0.95em; font-weight: 600; display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <i class="fas fa-at" style="color: #b48aff;"></i>
                                        Username OnlyFans (optionnel)
                                    </label>
                                    <input type="text" id="model-username" placeholder="@username" style="width:100%; border-radius:12px; border:2px solid rgba(180,138,255,0.3); background:rgba(180,138,255,0.05); color:#f5f5fa; padding:12px 15px; font-size: 0.95em; transition: all 0.3s ease; box-sizing: border-box;" onfocus="this.style.borderColor='#b48aff'; this.style.boxShadow='0 0 0 3px rgba(180,138,255,0.1)'" onblur="this.style.borderColor='rgba(180,138,255,0.3)'; this.style.boxShadow='none'">
                                </div>
                                
                                <div style="margin-bottom: 25px;">
                                    <label style="color:#f5f5fa; font-size:0.95em; font-weight: 600; display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                        <i class="fas fa-percentage" style="color: #22c55e;"></i>
                                        Commission (%)
                                    </label>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <input type="range" id="model-commission" min="5" max="50" value="25" 
                                               style="flex: 1; height: 8px; background: rgba(34,197,94,0.2); border-radius: 4px; outline: none;"
                                               oninput="updateCommissionPreview(this.value)">
                                        <span id="commission-preview" style="color: #22c55e; font-weight: bold; font-size: 1.3em; min-width: 50px;">25%</span>
                                    </div>
                                    <div style="background: rgba(34,197,94,0.1); border-radius: 8px; padding: 12px; margin-top: 12px;">
                                        <div style="display: flex; justify-content: space-between; color: rgba(245,245,250,0.8); font-size: 0.9em;">
                                            <span>Sur 1000€ de revenus :</span>
                                            <div style="text-align: right;">
                                                <div>Modèle : <span style="color: #b48aff; font-weight: 600;" id="model-earnings-preview">750€</span></div>
                                                <div>Agence : <span style="color: #22c55e; font-weight: 600;" id="agency-earnings-preview">250€</span></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 12px;">
                                    <button type="button" onclick="closeAddModelModal()" style="
                                        flex: 1;
                                        background: rgba(107,114,128,0.2);
                                        border: 2px solid rgba(107,114,128,0.3);
                                        border-radius: 12px;
                                        padding: 14px 20px;
                                        color: #9ca3af;
                                        font-weight: 600;
                                        cursor: pointer;
                                        font-size: 0.95em;
                                        transition: all 0.3s ease;
                                    " onmouseover="this.style.background='rgba(107,114,128,0.3)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(107,114,128,0.2)'; this.style.transform='translateY(0)'">
                                        <i class="fas fa-times"></i> Annuler
                                    </button>
                                    <button type="submit" style="
                                        flex: 2;
                                        background: linear-gradient(135deg, #b48aff, #9333ea);
                                        border: none;
                                        border-radius: 12px;
                                        padding: 14px 20px;
                                        color: white;
                                        font-weight: 700;
                                        cursor: pointer;
                                        font-size: 0.95em;
                                        transition: all 0.3s ease;
                                        box-shadow: 0 4px 15px rgba(180,138,255,0.3);
                                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(180,138,255,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(180,138,255,0.3)'">
                                        <i class="fas fa-plus"></i> Ajouter le modèle
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Activités récentes améliorées -->
        <section class="activities-section" style="margin-bottom: 40px;">
            <h2 style="color: #b48aff; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-history"></i>
                Activités Récentes
            </h2>
            <div class="activities-card" style="
                background: rgba(26,9,62,0.7);
                border-radius: 18px;
                padding: 25px;
                border: 1px solid #23233a;
                box-shadow: 0 4px 24px rgba(80,0,160,0.13);
            ">
                <div class="activities-timeline">
                    <div style="text-align: center; padding: 40px 20px; color: rgba(245,245,250,0.6);">
                        <i class="fas fa-rocket" style="font-size: 3em; margin-bottom: 15px; opacity: 0.8;"></i>
                        <p style="margin: 0; font-size: 1.1em;">Espace prêt à utiliser</p>
                        <p style="margin: 5px 0 0 0; font-size: 0.9em;">Commencez par explorer les outils disponibles</p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="document.querySelector('.creative-tools-section').scrollIntoView({behavior: 'smooth'})" style="
                        background: rgba(180,138,255,0.1);
                        border: 1px solid #b48aff;
                        border-radius: 20px;
                        padding: 10px 20px;
                        color: #b48aff;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='rgba(180,138,255,0.2)'" onmouseout="this.style.background='rgba(180,138,255,0.1)'">
                        <i class="fas fa-crown"></i> Découvrir les outils
                    </button>
                </div>
            </div>
        </section>

        <!-- Section Conseils -->
        <section class="tips-section" style="margin-bottom: 30px;">
            <h2 style="color: #b48aff; margin-bottom: 20px; text-align: center;">
                <i class="fas fa-lightbulb"></i> Conseils & Astuces
            </h2>
            
            <div style="
                background: linear-gradient(135deg, rgba(26,9,62,0.8), rgba(18,7,45,0.6));
                border: 2px solid rgba(180,138,255,0.3);
                border-radius: 20px;
                padding: 25px;
                backdrop-filter: blur(10px);
                box-shadow: 0 10px 30px rgba(180,138,255,0.2);
            ">
                <!-- En-tête de la section -->
                <div style="text-align: center; margin-bottom: 25px;">
                    <h3 style="color: #b48aff; margin: 0 0 10px 0; font-size: 1.3em;">
                        💡 Optimisez votre succès OnlyFans
                    </h3>
                    <p style="color: rgba(245,245,250,0.7); margin: 0; font-size: 0.9em;">
                        Conseils experts pour maximiser vos revenus et engagement
                    </p>
                </div>

                <!-- Grille des conseils -->
                <div style="
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px;
                    margin-bottom: 20px;
                ">
                    <!-- Conseil Contenu -->
                    <div class="tip-card" style="
                        background: linear-gradient(135deg, rgba(34,197,94,0.1), rgba(22,163,74,0.05));
                        border: 1px solid rgba(34,197,94,0.2);
                        border-radius: 15px;
                        padding: 20px;
                        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                        cursor: pointer;
                    " onmouseover="this.style.transform='translateY(-8px) scale(1.02)'; this.style.boxShadow='0 20px 50px rgba(34,197,94,0.3)'; this.style.borderColor='rgba(34,197,94,0.5)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'; this.style.borderColor='rgba(34,197,94,0.2)'">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="
                                background: linear-gradient(135deg, #22c55e, #16a34a);
                                border-radius: 12px;
                                padding: 12px;
                                color: white;
                                font-size: 1.2em;
                            ">
                                <i class="fas fa-camera"></i>
                            </div>
                            <h4 style="color: #22c55e; margin: 0; font-size: 1.1em;">Contenu de Qualité</h4>
                        </div>
                        <ul style="color: rgba(245,245,250,0.8); margin: 0; padding-left: 20px; font-size: 0.9em; line-height: 1.6;">
                            <li>Postez quotidiennement à heures fixes</li>
                            <li>Variez vos types de contenu</li>
                            <li>Utilisez un bon éclairage naturel</li>
                            <li>Soignez vos titres et descriptions</li>
                        </ul>
                    </div>

                    <!-- Conseil Engagement -->
                    <div class="tip-card" style="
                        background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(37,99,235,0.05));
                        border: 1px solid rgba(59,130,246,0.2);
                        border-radius: 15px;
                        padding: 20px;
                        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                        cursor: pointer;
                    " onmouseover="this.style.transform='translateY(-8px) scale(1.02)'; this.style.boxShadow='0 20px 50px rgba(59,130,246,0.3)'; this.style.borderColor='rgba(59,130,246,0.5)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'; this.style.borderColor='rgba(59,130,246,0.2)'">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="
                                background: linear-gradient(135deg, #3b82f6, #2563eb);
                                border-radius: 12px;
                                padding: 12px;
                                color: white;
                                font-size: 1.2em;
                            ">
                                <i class="fas fa-heart"></i>
                            </div>
                            <h4 style="color: #3b82f6; margin: 0; font-size: 1.1em;">Engagement Fans</h4>
                        </div>
                        <ul style="color: rgba(245,245,250,0.8); margin: 0; padding-left: 20px; font-size: 0.9em; line-height: 1.6;">
                            <li>Répondez rapidement aux messages</li>
                            <li>Organisez des lives réguliers</li>
                            <li>Créez du contenu personnalisé</li>
                            <li>Interagissez dans les commentaires</li>
                        </ul>
                    </div>

                    <!-- Conseil Marketing -->
                    <div class="tip-card" style="
                        background: linear-gradient(135deg, rgba(236,72,153,0.1), rgba(219,39,119,0.05));
                        border: 1px solid rgba(236,72,153,0.2);
                        border-radius: 15px;
                        padding: 20px;
                        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                        cursor: pointer;
                    " onmouseover="this.style.transform='translateY(-8px) scale(1.02)'; this.style.boxShadow='0 20px 50px rgba(236,72,153,0.3)'; this.style.borderColor='rgba(236,72,153,0.5)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'; this.style.borderColor='rgba(236,72,153,0.2)'">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="
                                background: linear-gradient(135deg, #ec4899, #db2777);
                                border-radius: 12px;
                                padding: 12px;
                                color: white;
                                font-size: 1.2em;
                            ">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <h4 style="color: #ec4899; margin: 0; font-size: 1.1em;">Stratégie Marketing</h4>
                        </div>
                        <ul style="color: rgba(245,245,250,0.8); margin: 0; padding-left: 20px; font-size: 0.9em; line-height: 1.6;">
                            <li>Utilisez les réseaux sociaux</li>
                            <li>Créez des offres promotionnelles</li>
                            <li>Collaborez avec d'autres créateurs</li>
                            <li>Analysez vos statistiques</li>
                        </ul>
                    </div>

                    <!-- Conseil Monétisation -->
                    <div class="tip-card" style="
                        background: linear-gradient(135deg, rgba(251,146,60,0.1), rgba(249,115,22,0.05));
                        border: 1px solid rgba(251,146,60,0.2);
                        border-radius: 15px;
                        padding: 20px;
                        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                        cursor: pointer;
                    " onmouseover="this.style.transform='translateY(-8px) scale(1.02)'; this.style.boxShadow='0 20px 50px rgba(251,146,60,0.3)'; this.style.borderColor='rgba(251,146,60,0.5)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'; this.style.borderColor='rgba(251,146,60,0.2)'">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="
                                background: linear-gradient(135deg, #fb923c, #f97316);
                                border-radius: 12px;
                                padding: 12px;
                                color: white;
                                font-size: 1.2em;
                            ">
                                <i class="fas fa-coins"></i>
                            </div>
                            <h4 style="color: #fb923c; margin: 0; font-size: 1.1em;">Maximiser Revenus</h4>
                        </div>
                        <ul style="color: rgba(245,245,250,0.8); margin: 0; padding-left: 20px; font-size: 0.9em; line-height: 1.6;">
                            <li>Proposez du contenu premium</li>
                            <li>Utilisez les tips et pourboires</li>
                            <li>Créez des bundles attractifs</li>
                            <li>Fixez des prix stratégiques</li>
                        </ul>
                    </div>
                </div>

                <!-- Conseil du jour -->
                <div style="
                    background: linear-gradient(135deg, rgba(180,138,255,0.15), rgba(139,92,246,0.1));
                    border: 1px solid rgba(180,138,255,0.3);
                    border-radius: 15px;
                    padding: 20px;
                    margin-top: 20px;
                    text-align: center;
                ">
                    <h4 style="color: #b48aff; margin: 0 0 10px 0; font-size: 1.1em;">
                        <i class="fas fa-star"></i> Conseil du Jour
                    </h4>
                    <p id="daily-tip" style="color: rgba(245,245,250,0.9); margin: 0; font-size: 1em; line-height: 1.5; font-style: italic;">
                        "La régularité est la clé du succès : postez du contenu de qualité chaque jour pour fidéliser votre audience."
                    </p>
                    <button onclick="
                        var tips = ['La régularité est la clé du succès', 'Interagissez authentiquement avec vos fans', 'Utilisez des hashtags pertinents et populaires', 'Créez du contenu exclusif et premium', 'Analysez vos statistiques régulièrement', 'Proposez des offres spéciales et promotions', 'Collaborez avec d autres créateurs', 'Soignez votre profil et votre bio', 'Utilisez les stories temporaires', 'Répondez rapidement aux messages privés'];
                        var tip = document.getElementById('daily-tip');
                        var newText = tips[Math.floor(Math.random() * tips.length)];
                        tip.style.transition = 'opacity 0.3s ease';
                        tip.style.opacity = '0';
                        setTimeout(function() {
                            tip.textContent = '&quot;' + newText + '&quot;';
                            tip.style.opacity = '1';
                        }, 300);
                    " style="
                        background: linear-gradient(135deg, #b48aff, #6c2eb6);
                        border: none;
                        border-radius: 10px;
                        padding: 8px 16px;
                        color: white;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                        margin-top: 15px;
                        font-size: 0.9em;
                    " onmouseover="this.style.transform='translateY(-3px) scale(1.05)'; this.style.boxShadow='0 8px 20px rgba(180,138,255,0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'">
                        <i class="fas fa-refresh"></i> Nouveau Conseil
                    </button>
                </div>
            </div>
        </section>

        <!-- Panel d'Administration (visible uniquement pour les admins) -->
        <section id="admin-panel" style="margin-bottom: 30px; display: none;">
            <h2 style="color: #ffc107; margin-bottom: 20px; text-align: center;">
                <i class="fas fa-crown"></i> Panel d'Administration
            </h2>
            
            <div style="
                background: linear-gradient(135deg, rgba(255,193,7,0.1), rgba(255,152,0,0.05));
                border: 2px solid rgba(255,193,7,0.3);
                border-radius: 20px;
                padding: 25px;
                backdrop-filter: blur(10px);
                box-shadow: 0 10px 30px rgba(255,193,7,0.2);
            ">
                <!-- Onglets d'administration -->
                <div style="
                    display: flex;
                    gap: 10px;
                    margin-bottom: 25px;
                    border-bottom: 2px solid rgba(255,193,7,0.2);
                    padding-bottom: 15px;
                    flex-wrap: wrap;
                    justify-content: center;
                ">
                    <button onclick="showAdminTab('users')" class="admin-tab-btn active" data-tab="users" style="
                        background: linear-gradient(135deg, #ffc107, #ff8f00);
                        border: none;
                        border-radius: 25px;
                        padding: 12px 20px;
                        color: white;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        margin: 5px;
                    ">
                        <i class="fas fa-users"></i> Gestion Utilisateurs
                    </button>
                    <button onclick="showAdminTab('security')" class="admin-tab-btn" data-tab="security" style="
                        background: rgba(255,193,7,0.1);
                        border: 2px solid #ffc107;
                        border-radius: 25px;
                        padding: 12px 20px;
                        color: #ffc107;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        margin: 5px;
                    ">
                        <i class="fas fa-shield-alt"></i> Sécurité
                    </button>
                    <button onclick="showAdminTab('system')" class="admin-tab-btn" data-tab="system" style="
                        background: rgba(255,193,7,0.1);
                        border: 2px solid #ffc107;
                        border-radius: 25px;
                        padding: 12px 20px;
                        color: #ffc107;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        margin: 5px;
                    ">
                        <i class="fas fa-cogs"></i> Système
                    </button>
                </div>

                <!-- Contenu des onglets -->
                <div id="admin-content">
                    <!-- Onglet Gestion Utilisateurs -->
                    <div id="admin-users" class="admin-tab-content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                            <h3 style="color: #ffc107; margin: 0;">Utilisateurs Enregistrés</h3>
                            <button onclick="showCreateUserModal()" style="
                                background: linear-gradient(135deg, #22c55e, #16a34a);
                                border: none;
                                border-radius: 20px;
                                padding: 10px 20px;
                                color: white;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            ">
                                <i class="fas fa-plus"></i> Créer Utilisateur
                            </button>
                        </div>
                        
                        <div id="users-list" style="
                            background: rgba(26,9,62,0.3);
                            border-radius: 15px;
                            padding: 20px;
                            max-height: 400px;
                            overflow-y: auto;
                        ">
                            <!-- Liste des utilisateurs générée dynamiquement -->
                        </div>
                    </div>

                    <!-- Onglet Sécurité -->
                    <div id="admin-security" class="admin-tab-content" style="display: none;">
                        <h3 style="color: #ffc107; margin-bottom: 20px;">Paramètres de Sécurité</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <div style="
                                background: rgba(26,9,62,0.3);
                                border-radius: 15px;
                                padding: 20px;
                                border: 1px solid rgba(255,193,7,0.2);
                            ">
                                <h4 style="color: #f5f5fa; margin-bottom: 15px;"><i class="fas fa-key"></i> Sessions</h4>
                                <p style="color: rgba(245,245,250,0.8); margin-bottom: 15px;">Durée de session maximum :</p>
                                <select style="
                                    width: 100%;
                                    background: rgba(255,193,7,0.1);
                                    border: 1px solid rgba(255,193,7,0.3);
                                    border-radius: 8px;
                                    padding: 10px;
                                    color: #f5f5fa;
                                    margin-bottom: 15px;
                                ">
                                    <option value="8">8 heures</option>
                                    <option value="24" selected>24 heures</option>
                                    <option value="72">3 jours</option>
                                    <option value="168">1 semaine</option>
                                </select>
                                <button onclick="updateSecuritySettings()" style="
                                    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                                    border: none;
                                    border-radius: 8px;
                                    padding: 8px 16px;
                                    color: white;
                                    font-weight: 600;
                                    cursor: pointer;
                                    width: 100%;
                                ">Mettre à jour</button>
                            </div>

                            <div style="
                                background: rgba(26,9,62,0.3);
                                border-radius: 15px;
                                padding: 20px;
                                border: 1px solid rgba(255,193,7,0.2);
                            ">
                                <h4 style="color: #f5f5fa; margin-bottom: 15px;"><i class="fas fa-history"></i> Logs de Connexion</h4>
                                <div style="max-height: 200px; overflow-y: auto;">
                                    <div style="color: rgba(245,245,250,0.7); font-size: 0.9em; padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                        Charli - Connexion réussie - ${new Date().toLocaleString()}
                                    </div>
                                    <div style="color: rgba(245,245,250,0.7); font-size: 0.9em; padding: 8px;">
                                        Utilisateur - Dernière connexion - Hier 14:32
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Système -->
                    <div id="admin-system" class="admin-tab-content" style="display: none;">
                        <h3 style="color: #ffc107; margin-bottom: 20px;">Informations Système</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div style="
                                background: rgba(26,9,62,0.3);
                                border-radius: 15px;
                                padding: 20px;
                                text-align: center;
                            ">
                                <h4 style="color: #22c55e; margin-bottom: 10px;">Utilisateurs Actifs</h4>
                                <div style="font-size: 2em; color: #22c55e; font-weight: bold;" id="active-users-count">2</div>
                            </div>
                            
                            <div style="
                                background: rgba(26,9,62,0.3);
                                border-radius: 15px;
                                padding: 20px;
                                text-align: center;
                            ">
                                <h4 style="color: #3b82f6; margin-bottom: 10px;">Administrateurs</h4>
                                <div style="font-size: 2em; color: #3b82f6; font-weight: bold;" id="admin-count">1</div>
                            </div>
                            
                            <div style="
                                background: rgba(26,9,62,0.3);
                                border-radius: 15px;
                                padding: 20px;
                                text-align: center;
                            ">
                                <h4 style="color: #ffc107; margin-bottom: 10px;">Sessions Actives</h4>
                                <div style="font-size: 2em; color: #ffc107; font-weight: bold;">1</div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="exportUserData()" style="
                                background: linear-gradient(135deg, #8b5cf6, #7c3aed);
                                border: none;
                                border-radius: 25px;
                                padding: 12px 25px;
                                color: white;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                margin: 5px;
                            ">
                                <i class="fas fa-download"></i> Exporter Données
                            </button>
                            <button onclick="clearSystemLogs()" style="
                                background: linear-gradient(135deg, #ef4444, #dc2626);
                                border: none;
                                border-radius: 25px;
                                padding: 12px 25px;
                                color: white;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                margin: 5px;
                            ">
                                <i class="fas fa-trash"></i> Nettoyer Logs
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script>
        // Fonction de maintenance (définie globalement en premier)
        function showMaintenanceNotification(section) {
            console.log('Fonction showMaintenanceNotification appelée avec:', section);
            
            // Supprimer les notifications existantes
            const existingNotifications = document.querySelectorAll('.maintenance-notification');
            existingNotifications.forEach(notif => notif.remove());
            
            // Créer la nouvelle notification directement avec les bons styles
            const notification = document.createElement('div');
            notification.className = 'maintenance-notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ff9800, #f57c00);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(255, 152, 0, 0.4);
                z-index: 10001;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 10px;
                max-width: 350px;
                animation: slideInFromRight 0.3s ease-out;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-tools"></i>
                <span>${section} en maintenance - Fonctionnalité temporairement indisponible</span>
            `;
            
            // Ajouter au DOM
            document.body.appendChild(notification);
            
            // Supprimer automatiquement après 3 secondes
            setTimeout(() => {
                if (notification && notification.parentNode) {
                    notification.style.animation = 'slideOutToRight 0.3s ease-out';
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }
            }, 3000);
            
            return false; // Empêcher la navigation
        }

        // Ajouter les animations CSS pour les notifications
        const maintenanceStyle = document.createElement('style');
        maintenanceStyle.id = 'maintenance-animations';
        maintenanceStyle.textContent = `
            @keyframes slideInFromRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutToRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(maintenanceStyle);

        // Fonction pour obtenir un nouveau conseil quotidien (globale)
        function getNewDailyTip() {
            const dailyTips = [
                "La régularité est la clé du succès : postez du contenu de qualité chaque jour pour fidéliser votre audience.",
                "Interagissez authentiquement avec vos fans - les relations personnelles génèrent plus de revenus.",
                "Utilisez des hashtags pertinents et populaires pour augmenter la visibilité de vos posts.",
                "Créez du contenu exclusif et premium pour justifier vos prix d'abonnement.",
                "Analysez vos statistiques pour identifier les types de contenu les plus performants.",
                "Proposez des offres spéciales et des promotions lors d'événements ou de saisons.",
                "Collaborez avec d'autres créateurs pour élargir votre audience et partager des conseils.",
                "Soignez votre profil et votre bio - c'est votre première impression auprès des nouveaux visiteurs.",
                "Utilisez les stories et les posts temporaires pour créer un sentiment d'urgence.",
                "Répondez rapidement aux messages privés - la réactivité fidélise vos abonnés premium.",
                "Variez vos formats : photos, vidéos, lives, messages audio pour maintenir l'intérêt.",
                "Planifiez votre contenu à l'avance avec un calendrier éditorial structuré.",
                "Utilisez un bon éclairage naturel ou des ring lights pour améliorer la qualité visuelle.",
                "Créez des séries ou des thématiques récurrentes pour fidéliser votre audience.",
                "Montrez votre personnalité authentique - les fans apprécient la sincérité.",
                "Utilisez les sondages et questions pour engager votre communauté.",
                "Optimisez vos prix en fonction de votre contenu et de votre audience cible.",
                "Créez des bundles et des packages attractifs pour augmenter votre revenu moyen.",
                "Utilisez les réseaux sociaux pour promouvoir votre contenu OnlyFans.",
                "Restez à l'écoute des tendances et adaptez votre contenu en conséquence."
            ];

            const tipElement = document.getElementById('daily-tip');
            if (!tipElement) {
                console.error('❌ Élément daily-tip non trouvé');
                showNotification('❌ Erreur - Élément conseil non trouvé', 'error');
                return;
            }

            // Récupérer les conseils déjà utilisés depuis le localStorage
            let usedTips = JSON.parse(localStorage.getItem('usedDailyTips') || '[]');
            
            // Si tous les conseils ont été utilisés, réinitialiser la liste
            if (usedTips.length >= dailyTips.length) {
                usedTips = [];
                localStorage.setItem('usedDailyTips', JSON.stringify(usedTips));
                console.log('🔄 Tous les conseils ont été vus - Liste réinitialisée');
                showNotification('🔄 Cycle des conseils terminé ! Nouveaux conseils disponibles.', 'info');
            }
            
            // Filtrer les conseils disponibles (non utilisés)
            const availableTips = dailyTips.filter(tip => !usedTips.includes(tip));
            
            // Vérification de sécurité
            if (availableTips.length === 0) {
                console.error('❌ Aucun conseil disponible');
                showNotification('❌ Erreur - Aucun conseil disponible', 'error');
                return;
            }
            
            // Sélectionner un conseil aléatoire parmi ceux disponibles
            const randomTip = availableTips[Math.floor(Math.random() * availableTips.length)];
            
            // Ajouter le conseil sélectionné à la liste des conseils utilisés
            usedTips.push(randomTip);
            localStorage.setItem('usedDailyTips', JSON.stringify(usedTips));
            
            // Animation de changement fluide
            tipElement.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            tipElement.style.opacity = '0';
            tipElement.style.transform = 'translateY(-20px) scale(0.95)';
            
            setTimeout(() => {
                tipElement.textContent = `"${randomTip}"`;
                tipElement.style.opacity = '1';
                tipElement.style.transform = 'translateY(0) scale(1)';
                
                // Effet de brillance temporaire
                tipElement.style.textShadow = '0 0 15px rgba(180,138,255,0.6)';
                setTimeout(() => {
                    tipElement.style.textShadow = '';
                }, 1000);
            }, 250);

            // Notification de succès avec informations sur les conseils restants
            const remainingTips = dailyTips.length - usedTips.length;
            const progressInfo = remainingTips > 0 ? ` (${remainingTips} conseils restants)` : ' (Cycle terminé)';
            showNotification(`💡 Nouveau conseil généré !${progressInfo}`, 'info');
            console.log(`✅ Nouveau conseil généré: ${randomTip}`);
            console.log(`📊 Conseils utilisés: ${usedTips.length}/${dailyTips.length}`);
        }

        // Rendre la fonction globalement accessible
        window.getNewDailyTip = getNewDailyTip;

        // Base de données utilisateurs simulée avec rôles
        const usersDatabase = {
            'charli@synagency.fr': {
                email: 'charli@synagency.fr',
                password: '$2a$10$N9qo8uLOickgx2ZMRZoMye', // Hash simulé de "Monstergtx123!"
                role: 'admin',
                name: 'Charli',
                avatar: 'CH',
                permissions: ['dashboard', 'users', 'analytics', 'content', 'settings', 'admin_panel'],
                createdAt: new Date().toISOString(),
                lastLogin: null,
                isActive: true
            },
            'valentin@synagency.fr': {
                email: 'valentin@synagency.fr',
                password: '$2a$10$vL3lO6uZz123456789AbCdE', // Hash simulé de "valouzz123"
                role: 'admin',
                name: 'Valentin',
                avatar: 'VA',
                permissions: ['dashboard', 'users', 'analytics', 'content', 'settings', 'admin_panel'],
                createdAt: new Date().toISOString(),
                lastLogin: null,
                isActive: true
            },
            'user@example.com': {
                email: 'user@example.com',
                password: '$2a$10$92IXUNpkjO0rOQ5byMi.Ye', // Hash simulé de "password123"
                role: 'user',
                name: 'Utilisateur',
                avatar: 'US',
                permissions: ['dashboard', 'content'],
                createdAt: new Date().toISOString(),
                lastLogin: null,
                isActive: true
            }
        };

        // Système de gestion des utilisateurs
        class UserManager {
            static createUser(userData) {
                const userId = userData.email;
                if (usersDatabase[userId]) {
                    throw new Error('Utilisateur déjà existant');
                }
                
                usersDatabase[userId] = {
                    ...userData,
                    password: this.hashPassword(userData.password),
                    createdAt: new Date().toISOString(),
                    lastLogin: null,
                    isActive: true
                };
                
                localStorage.setItem('synAgencyUsers', JSON.stringify(usersDatabase));
                return true;
            }
            
            static authenticate(email, password) {
                const user = usersDatabase[email];
                if (user && user.isActive && this.verifyPassword(password, user.password)) {
                    user.lastLogin = new Date().toISOString();
                    localStorage.setItem('synAgencyUsers', JSON.stringify(usersDatabase));
                    return user;
                }
                return null;
            }
            
            static getCurrentUser() {
                const sessionData = JSON.parse(localStorage.getItem('synAgencySession') || 
                                             sessionStorage.getItem('synAgencySession') || '{}');
                console.log('🔍 Session data:', sessionData);
                if (sessionData.email) {
                    const user = usersDatabase[sessionData.email];
                    console.log('🔍 User found:', user);
                    return user;
                }
                console.log('❌ No email in session data');
                return null;
            }
            
            static hasPermission(permission) {
                const user = this.getCurrentUser();
                return user && user.permissions.includes(permission);
            }
            
            static isAdmin() {
                const user = this.getCurrentUser();
                return user && user.role === 'admin';
            }
            
            static getAllUsers() {
                return Object.values(usersDatabase);
            }
            
            static updateUser(email, updates) {
                if (usersDatabase[email]) {
                    Object.assign(usersDatabase[email], updates);
                    localStorage.setItem('synAgencyUsers', JSON.stringify(usersDatabase));
                    return true;
                }
                return false;
            }
            
            static deleteUser(email) {
                if (usersDatabase[email]) {
                    delete usersDatabase[email];
                    localStorage.setItem('synAgencyUsers', JSON.stringify(usersDatabase));
                    return true;
                }
                return false;
            }
            
            // Fonction de hachage simulée (en production, utiliser bcrypt)
            static hashPassword(password) {
                return '$2a$10$' + btoa(password).slice(0, 22);
            }
            
            static verifyPassword(password, hash) {
                // Pour la démo, on compare directement les mots de passe
                const knownPasswords = {
                    'Monstergtx123!': '$2a$10$N9qo8uLOickgx2ZMRZoMye',
                    'password123': '$2a$10$92IXUNpkjO0rOQ5byMi.Ye',
                    'valouzz123': '$2a$10$vL3lO6uZz123456789AbCdE'
                };
                return knownPasswords[password] === hash;
            }
        }

        // Vérification stricte de sécurité avec rôles - DOIT être exécutée immédiatement
        (function() {
            // Éviter la redirection infinie si on vient de login.html
            const referrer = document.referrer;
            const isFromLogin = referrer.includes('login.html') || window.location.search.includes('from=login');
            
            const sessionData = JSON.parse(localStorage.getItem('synAgencySession') || 
                                         sessionStorage.getItem('synAgencySession') || '{}');

            if (!sessionData || !sessionData.isLoggedIn) {
                // Aucune session valide - redirection immédiate seulement si pas de login en cours
                if (!isFromLogin) {
                    console.log('❌ Aucune session trouvée - redirection vers login');
                    window.location.replace('login.html');
                    return;
                }
                console.log('⏳ En attente de connexion...');
                return;
            }

            // Vérifier si la session n'a pas expiré
            const now = new Date().getTime();
            const sessionAge = now - sessionData.loginTime;
            const maxAge = sessionData.rememberMe ? 24 * 60 * 60 * 1000 : 8 * 60 * 60 * 1000; // 24h ou 8h

            if (sessionAge > maxAge) {
                // Session expirée - nettoyer et rediriger
                localStorage.removeItem('synAgencySession');
                sessionStorage.removeItem('synAgencySession');
                console.log('⏰ Session expirée - redirection vers login');
                window.location.replace('login.html');
                return;
            }

            // Vérifier les permissions utilisateur
            const currentUser = UserManager.getCurrentUser();
            if (!currentUser || !UserManager.hasPermission('dashboard')) {
                console.log('❌ Permissions insuffisantes - redirection vers login');
                window.location.replace('login.html');
                return;
            }

            // Session valide - continuer le chargement
            console.log('✅ Accès autorisé au dashboard - Utilisateur:', currentUser.name, '- Rôle:', currentUser.role);
            
            // Mettre à jour l'interface utilisateur avec les informations du rôle
            updateUserInterface(currentUser);
        })();

        // Fonction pour mettre à jour l'interface utilisateur
        function updateUserInterface(user) {
            // Mettre à jour les informations utilisateur dans l'interface
            const userNameElement = document.querySelector('.user-info h3');
            const userRoleElement = document.querySelector('.user-info p');
            const userAvatarElement = document.querySelector('.user-avatar');
            
            if (userNameElement) userNameElement.textContent = user.name;
            if (userRoleElement) userRoleElement.textContent = user.role === 'admin' ? 'Administrateur' : 'Membre';
            if (userAvatarElement) userAvatarElement.textContent = user.avatar;

            // Afficher le lien d'administration pour les admins
            if (UserManager.isAdmin()) {
                const adminLink = document.getElementById('admin-link');
                if (adminLink) {
                    adminLink.style.display = 'flex';
                }
            }

            // Personnaliser l'interface selon le rôle
            if (user.role === 'admin') {
                // Ajouter un badge admin
                const userRole = document.getElementById('user-role');
                if (userRole) {
                    userRole.style.background = 'linear-gradient(45deg, #ffc107, #ff8f00)';
                    userRole.style.color = 'white';
                    userRole.style.padding = '4px 8px';
                    userRole.style.borderRadius = '12px';
                    userRole.style.fontSize = '0.8em';
                    userRole.innerHTML = '<i class="fas fa-crown"></i> Administrateur';
                }
            }
        }

        // Fonctions d'administration
        function showAdminPanel() {
            if (!UserManager.isAdmin()) {
                showNotification('❌ Accès refusé - Privilèges administrateur requis', 'error');
                return;
            }

            const panel = document.getElementById('admin-panel');
            panel.style.display = 'block';
            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Charger la liste des utilisateurs
            loadUsersList();
            showNotification('🔑 Panel d\'administration activé', 'success');
        }

        function showAdminTab(tabName) {
            // Masquer tous les contenus d'onglets
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Désactiver tous les boutons d'onglets
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.style.background = 'rgba(255,193,7,0.1)';
                btn.style.border = '2px solid #ffc107';
                btn.style.color = '#ffc107';
                btn.classList.remove('active');
            });

            // Activer l'onglet sélectionné
            document.getElementById(`admin-${tabName}`).style.display = 'block';
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.style.background = 'linear-gradient(135deg, #ffc107, #ff8f00)';
            activeBtn.style.border = 'none';
            activeBtn.style.color = 'white';
            activeBtn.classList.add('active');

            // Charger le contenu spécifique
            if (tabName === 'users') {
                loadUsersList();
            } else if (tabName === 'system') {
                updateSystemStats();
            }
        }

        function loadUsersList() {
            const usersList = document.getElementById('users-list');
            const users = UserManager.getAllUsers();
            
            usersList.innerHTML = users.map(user => `
                <div style="
                    background: rgba(180,138,255,0.1);
                    border: 1px solid rgba(180,138,255,0.3);
                    border-radius: 12px;
                    padding: 15px;
                    margin-bottom: 10px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    flex-wrap: wrap;
                    gap: 10px;
                ">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="
                            width: 40px;
                            height: 40px;
                            border-radius: 50%;
                            background: linear-gradient(135deg, #b48aff, #6c2eb6);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-weight: bold;
                        ">${user.avatar}</div>
                        <div>
                            <h4 style="color: #f5f5fa; margin: 0 0 5px 0;">${user.name}</h4>
                            <p style="color: rgba(245,245,250,0.7); margin: 0; font-size: 0.9em;">${user.email}</p>
                            <span style="
                                background: ${user.role === 'admin' ? 'linear-gradient(45deg, #ffc107, #ff8f00)' : 'rgba(180,138,255,0.2)'};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 10px;
                                font-size: 0.8em;
                                font-weight: 600;
                            ">
                                ${user.role === 'admin' ? '👑 Admin' : '👤 Utilisateur'}
                            </span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button onclick="editUser('${user.email}')" style="
                            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                            border: none;
                            border-radius: 8px;
                            padding: 6px 12px;
                            color: white;
                            font-size: 0.8em;
                            cursor: pointer;
                        ">
                            <i class="fas fa-edit"></i> Modifier
                        </button>
                        ${user.email !== 'charli@synagency.fr' ? `
                        <button onclick="deleteUser('${user.email}')" style="
                            background: linear-gradient(135deg, #ef4444, #dc2626);
                            border: none;
                            border-radius: 8px;
                            padding: 6px 12px;
                            color: white;
                            font-size: 0.8em;
                            cursor: pointer;
                        ">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                        ` : '<span style="color: rgba(245,245,250,0.5); font-size: 0.8em;">Super Admin</span>'}
                    </div>
                </div>
            `).join('');
        }

        function showCreateUserModal() {
            const modal = document.createElement('div');
            modal.className = 'modal'; // Ajouter la classe modal
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            `;

            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, rgba(26,9,62,0.95), rgba(18,7,45,0.95));
                    border: 2px solid rgba(180,138,255,0.3);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                ">
                    <h3 style="color: #b48aff; margin-bottom: 20px; text-align: center;">
                        <i class="fas fa-user-plus"></i> Créer un Nouvel Utilisateur
                    </h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: #f5f5fa; font-weight: 600; display: block; margin-bottom: 5px;">Email :</label>
                        <input type="email" id="new-user-email" style="
                            width: 100%;
                            background: rgba(180,138,255,0.1);
                            border: 1px solid rgba(180,138,255,0.3);
                            border-radius: 8px;
                            padding: 10px;
                            color: #f5f5fa;
                            box-sizing: border-box;
                        " placeholder="exemple@synagency.fr">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: #f5f5fa; font-weight: 600; display: block; margin-bottom: 5px;">Nom :</label>
                        <input type="text" id="new-user-name" style="
                            width: 100%;
                            background: rgba(180,138,255,0.1);
                            border: 1px solid rgba(180,138,255,0.3);
                            border-radius: 8px;
                            padding: 10px;
                            color: #f5f5fa;
                            box-sizing: border-box;
                        " placeholder="Nom complet">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: #f5f5fa; font-weight: 600; display: block; margin-bottom: 5px;">Mot de passe :</label>
                        <input type="password" id="new-user-password" style="
                            width: 100%;
                            background: rgba(180,138,255,0.1);
                            border: 1px solid rgba(180,138,255,0.3);
                            border-radius: 8px;
                            padding: 10px;
                            color: #f5f5fa;
                            box-sizing: border-box;
                        " placeholder="Mot de passe sécurisé">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="color: #f5f5fa; font-weight: 600; display: block; margin-bottom: 5px;">Rôle :</label>
                        <select id="new-user-role" style="
                            width: 100%;
                            background: rgba(180,138,255,0.1);
                            border: 1px solid rgba(180,138,255,0.3);
                            border-radius: 8px;
                            padding: 10px;
                            color: #f5f5fa;
                            box-sizing: border-box;
                        ">
                            <option value="user">Utilisateur</option>
                            <option value="admin">Administrateur</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="createNewUser()" style="
                            background: linear-gradient(135deg, #22c55e, #16a34a);
                            border: none;
                            border-radius: 20px;
                            padding: 12px 25px;
                            color: white;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            <i class="fas fa-save"></i> Créer
                        </button>
                        <button onclick="this.closest('div').parentElement.remove()" style="
                            background: rgba(255,71,87,0.1);
                            border: 2px solid #ff4757;
                            border-radius: 20px;
                            padding: 12px 25px;
                            color: #ff4757;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        function createNewUser() {
            const email = document.getElementById('new-user-email').value;
            const name = document.getElementById('new-user-name').value;
            const password = document.getElementById('new-user-password').value;
            const role = document.getElementById('new-user-role').value;

            if (!email || !name || !password) {
                showNotification('❌ Tous les champs sont requis', 'error');
                return;
            }

            try {
                const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
                const permissions = role === 'admin' 
                    ? ['dashboard', 'users', 'analytics', 'content', 'settings', 'admin_panel']
                    : ['dashboard', 'content'];

                UserManager.createUser({
                    email,
                    name,
                    password,
                    role,
                    avatar: initials,
                    permissions
                });

                showNotification('✅ Utilisateur créé avec succès', 'success');
                loadUsersList();
                updateSystemStats();
                
                // Fermer la modal
                const modal = document.querySelector('.modal');
                if (modal) {
                    modal.remove();
                }
            } catch (error) {
                console.error('Erreur lors de la création de l\'utilisateur:', error);
                showNotification('❌ ' + error.message, 'error');
            }
        }

        function editUser(email) {
            showNotification('🔧 Fonction d\'édition en développement', 'info');
        }

        function deleteUser(email) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')) {
                UserManager.deleteUser(email);
                showNotification('✅ Utilisateur supprimé', 'success');
                loadUsersList();
                updateSystemStats();
            }
        }

        function updateSystemStats() {
            const users = UserManager.getAllUsers();
            const activeUsers = users.filter(u => u.isActive).length;
            const adminCount = users.filter(u => u.role === 'admin').length;

            document.getElementById('active-users-count').textContent = activeUsers;
            document.getElementById('admin-count').textContent = adminCount;
        }

        function updateSecuritySettings() {
            showNotification('✅ Paramètres de sécurité mis à jour', 'success');
        }

        function exportUserData() {
            const users = UserManager.getAllUsers().map(u => ({
                email: u.email,
                name: u.name,
                role: u.role,
                createdAt: u.createdAt,
                lastLogin: u.lastLogin
            }));

            const dataStr = JSON.stringify(users, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `synagency-users-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('📁 Données exportées avec succès', 'success');
        }

        function clearSystemLogs() {
            if (confirm('Êtes-vous sûr de vouloir nettoyer les logs système ?')) {
                showNotification('🧹 Logs système nettoyés', 'success');
            }
        }

        // Fonction pour afficher des notifications améliorées
        function showNotification(message, type = 'info') {
            const colors = {
                success: { bg: '#22c55e', border: '#16a34a', icon: 'fas fa-check-circle' },
                error: { bg: '#ef4444', border: '#dc2626', icon: 'fas fa-exclamation-circle' },
                warning: { bg: '#f59e0b', border: '#d97706', icon: 'fas fa-exclamation-triangle' },
                info: { bg: '#3b82f6', border: '#1d4ed8', icon: 'fas fa-info-circle' }
            };

            const color = colors[type] || colors.info;

            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color.bg};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                border-left: 4px solid ${color.border};
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                z-index: 10001;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 10px;
                max-width: 400px;
                opacity: 0;
                transform: translateX(100%) scale(0.8);
                transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            `;

            notification.innerHTML = `
                <i class="${color.icon}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            // Animation d'entrée
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0) scale(1)';
            }, 100);

            // Suppression automatique
            const duration = type === 'error' ? 6000 : type === 'warning' ? 4000 : 3000;
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%) scale(0.8)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 500);
            }, duration);
        }

        // Fonction pour gérer le dropdown des notifications
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            dropdown.classList.toggle('show');
        }

        // Fermer le dropdown si on clique ailleurs
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('notificationDropdown');
            const bell = event.target.closest('.notification-bell');
            
            if (!bell && dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            }
        });

        // Initialisation de l'API OnlyFans
        const ofAPI = new OnlyFansAPI();

        // Vérification de l'authentification au chargement de la page
        function checkAuthentication() {
            const sessionData = JSON.parse(localStorage.getItem('synAgencySession')) || 
                               JSON.parse(sessionStorage.getItem('synAgencySession'));

            if (!sessionData || !sessionData.isLoggedIn) {
                // Ne pas rediriger automatiquement, laisser la vérification principale s'en charger
                console.warn('⚠️ Aucune session active détectée');
                return false;
            }

            // Vérifier si la session n'a pas expiré
            const now = new Date().getTime();
            const sessionAge = now - sessionData.loginTime;
            const maxAge = sessionData.rememberMe ? 24 * 60 * 60 * 1000 : 8 * 60 * 60 * 1000; // 24h ou 8h

            if (sessionAge > maxAge) {
                // Session expirée
                console.warn('⚠️ Session expirée');
                localStorage.removeItem('synAgencySession');
                sessionStorage.removeItem('synAgencySession');
                return false;
            }

            // Mettre à jour les informations utilisateur
            updateUserInfo(sessionData);
            console.log('✅ Session valide confirmée');
            return true;
        }

        // Mettre à jour les informations utilisateur dans l'interface
        function updateUserInfo(sessionData) {
            const userNames = {
                'admin@synagency.com': { name: 'Administrateur', role: 'Admin', avatar: 'AD' },
                'demo@synagency.com': { name: 'Utilisateur Demo', role: 'Demo', avatar: 'DU' }
            };

            const userInfo = userNames[sessionData.email] || { name: 'Utilisateur', role: 'Membre', avatar: 'US' };
            
            document.querySelector('.user-info h3').textContent = userInfo.name;
            document.querySelector('.user-info p').textContent = userInfo.role;
            document.querySelector('.user-avatar').textContent = userInfo.avatar;
        }

        // Fonction de déconnexion
        function logout() {
            localStorage.removeItem('synAgencySession');
            sessionStorage.removeItem('synAgencySession');
            console.log('🔒 Déconnexion effectuée');
            window.location.replace('login.html');
        }

        // Rendre la fonction logout globalement accessible
        window.logout = logout;

        // Surveillance continue de la session
        function monitorSession() {
            setInterval(() => {
                const sessionData = JSON.parse(localStorage.getItem('synAgencySession')) || 
                                   JSON.parse(sessionStorage.getItem('synAgencySession'));

                if (!sessionData || !sessionData.isLoggedIn) {
                    console.warn('⚠️ Session perdue - redirection');
                    window.location.replace('login.html');
                    return;
                }

                // Vérifier l'expiration
                const now = new Date().getTime();
                const sessionAge = now - sessionData.loginTime;
                const maxAge = sessionData.rememberMe ? 24 * 60 * 60 * 1000 : 8 * 60 * 60 * 1000;

                if (sessionAge > maxAge) {
                    console.warn('⚠️ Session expirée - déconnexion automatique');
                    localStorage.removeItem('synAgencySession');
                    sessionStorage.removeItem('synAgencySession');
                    window.location.replace('login.html');
                }
            }, 30000); // Vérification toutes les 30 secondes
        }

        // Protection contre les tentatives de manipulation de l'historique
        window.addEventListener('popstate', function(event) {
            // Re-vérifier l'authentification lors de navigation dans l'historique
            if (!checkAuthentication()) {
                event.preventDefault();
                window.location.replace('login.html');
            }
        });

        // Animation des statistiques au chargement
        window.addEventListener('DOMContentLoaded', function() {
            // Vérifier l'authentification avant de charger le dashboard
            const isAuthenticated = checkAuthentication();
            if (!isAuthenticated) {
                console.log('❌ Authentification échouée - arrêt du chargement dashboard');
                // Ne pas forcer la redirection, laisser la vérification principale s'en charger
                return;
            }

            // Démarrer la surveillance continue de la session
            monitorSession();

            // Vérifier les paramètres d'URL pour les redirections de maintenance
            checkMaintenanceRedirect();

            console.log('🚀 Dashboard initialisé avec sécurité active');

            // Animation des cartes statistiques
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(40px) scale(0.9)';
                card.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0) scale(1)';
                }, index * 120 + 200);
            });

            // Révéler toutes les autres cartes
            setTimeout(() => {
                revealCards();
            }, 600);

            // Animation des valeurs de statistiques (seulement si pas de profil OF connecté)
            const profile = JSON.parse(localStorage.getItem('ofProfile') || '{}');
            if (!profile.connected) {
                setTimeout(() => {
                    animateValue('revenue-month', 0, 0, 1500, '€');
                    animateValue('subscribers', 0, 0, 1200);
                    animateValue('views', 0, 0, 1800);
                    animateValue('engagement', 0, 0, 1000, '%');
                }, 500);
            }

            // Vérifier l'état de connexion OnlyFans
            checkOFProfileStatus();
        });

        // Vérifier les redirections de maintenance
        function checkMaintenanceRedirect() {
            const urlParams = new URLSearchParams(window.location.search);
            const maintenanceSection = urlParams.get('maintenance');
            
            if (maintenanceSection) {
                // Nettoyer l'URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // Afficher la notification correspondante
                setTimeout(() => {
                    const sectionNames = {
                        'analytics': 'Analytics',
                        'messages': 'Messages'
                    };
                    
                    const sectionName = sectionNames[maintenanceSection] || maintenanceSection;
                    showMaintenanceNotification(sectionName);
                }, 1000);
            }
        }

        // Fonction d'animation des valeurs (améliorée)
        function animateValue(id, start, end, duration, suffix = '') {
            const element = document.getElementById(id);
            if (!element) return;
            
            const range = end - start;
            let startTime = null;
            
            // Fonction d'ease-out pour une animation plus naturelle
            function easeOutCubic(t) {
                return 1 - Math.pow(1 - t, 3);
            }
            
            // Fonction d'ease-in-out pour plus de fluidité
            function easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }

            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);
                
                // Utiliser la fonction d'easing pour un mouvement plus naturel
                const easedProgress = easeInOutCubic(progress);
                const value = Math.floor(easedProgress * range + start);
                
                // Effet de vibration subtile pendant l'animation
                if (progress < 1) {
                    const shake = Math.sin(progress * 20) * (1 - progress) * 2;
                    element.style.transform = `translateX(${shake}px)`;
                } else {
                    element.style.transform = 'translateX(0)';
                }
                
                // Mise à jour du contenu avec formatage
                if (suffix === '€') {
                    element.textContent = value.toLocaleString('fr-FR') + suffix;
                } else if (id === 'views') {
                    element.textContent = value.toLocaleString('fr-FR');
                } else {
                    element.textContent = value + suffix;
                }
                
                // Effet de glow pendant l'animation
                if (progress < 1) {
                    element.style.textShadow = `0 0 ${10 * (1 - progress)}px rgba(180,138,255,0.6)`;
                    requestAnimationFrame(step);
                } else {
                    element.style.textShadow = '';
                    // Animation finale de confirmation
                    element.style.transition = 'transform 0.3s ease';
                    element.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        element.style.transform = 'scale(1)';
                    }, 200);
                }
            }
            requestAnimationFrame(step);
        }

        // Effet de hover amélioré sur les cartes
        document.querySelectorAll('.stat-card, .chart-card, .activities-card, .notifications-panel').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                this.style.transform = 'translateY(-8px) scale(1.02)';
                this.style.boxShadow = '0 20px 60px rgba(180,138,255,0.25)';
                
                // Effet de brillance
                const shimmer = this.querySelector('::after') || this.style.setProperty('--shimmer', '1');
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
                this.style.boxShadow = '';
            });
            
            // Animation d'entrée pour chaque carte
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px) scale(0.9)';
            card.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        });

        // Révéler les cartes avec un délai progressif
        function revealCards() {
            const cards = document.querySelectorAll('.stat-card, .chart-card, .activities-card, .notifications-panel');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0) scale(1)';
                }, index * 150 + 300);
            });
        }

        // Simulation de mise à jour en temps réel (désactivée pour éviter les fausses données)
        // setInterval(() => {
        //     // Les données seront mises à jour via l'API réelle
        // }, 5000);

        // Gestion améliorée des clics sur les actions rapides
        document.querySelectorAll('.action-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Animation de clic sophistiquée
                this.style.transition = 'all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                this.style.transform = 'scale(0.92) translateY(2px)';
                
                // Effet de ripple
                const ripple = document.createElement('span');
                ripple.style.cssText = `
                    position: absolute;
                    border-radius: 50%;
                    background: rgba(255,255,255,0.3);
                    transform: scale(0);
                    animation: rippleEffect 0.6s linear;
                    pointer-events: none;
                `;
                
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = (e.clientX - rect.left - size / 2) + 'px';
                ripple.style.top = (e.clientY - rect.top - size / 2) + 'px';
                
                this.style.position = 'relative';
                this.appendChild(ripple);
                
                setTimeout(() => {
                    this.style.transform = 'scale(1) translateY(0)';
                    this.style.transition = 'all 0.3s ease';
                    if (this.contains(ripple)) {
                        this.removeChild(ripple);
                    }
                }, 150);
                
                // Simuler une action
                const action = this.textContent.trim();
                showNotification(`🚀 Action "${action}" en cours...`);
            });
            
            // Ajouter l'animation du ripple au CSS si elle n'existe pas
            if (!document.querySelector('#ripple-animation')) {
                const style = document.createElement('style');
                style.id = 'ripple-animation';
                style.textContent = `
                    @keyframes rippleEffect {
                        to {
                            transform: scale(4);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        });

        // Fonction pour afficher des notifications (améliorée)
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'error' ? 'linear-gradient(135deg, #f44336, #d32f2f)' : 
                             type === 'warning' ? 'linear-gradient(135deg, #ff9800, #f57c00)' :
                             'linear-gradient(135deg, #b48aff, #6c2eb6)';
            const icon = type === 'error' ? 'fas fa-exclamation-triangle' : 
                        type === 'warning' ? 'fas fa-exclamation-circle' :
                        'fas fa-check-circle';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 15px 20px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(180,138,255,0.4);
                z-index: 10000;
                font-weight: 600;
                opacity: 0;
                transform: translateX(100%) scale(0.8);
                transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                max-width: 350px;
                display: flex;
                align-items: center;
                gap: 12px;
                border: 1px solid rgba(255,255,255,0.2);
                backdrop-filter: blur(10px);
                overflow: hidden;
            `;
            
            // Ajouter un effet de brillance
            notification.innerHTML = `
                <div style="
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    animation: shimmer 2s ease-in-out infinite;
                "></div>
                <i class="${icon}"></i> 
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Animation d'entrée sophistiquée
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0) scale(1)';
            }, 100);
            
            // Animation de pulsation pour les types importants
            if (type === 'error' || type === 'warning') {
                setTimeout(() => {
                    notification.style.animation = 'pulseGlow 1.5s ease-in-out infinite';
                }, 500);
            }
            
            // Suppression automatique avec animation fluide
            const duration = type === 'error' ? 6000 : type === 'warning' ? 4000 : 3000;
            setTimeout(() => {
                notification.style.animation = 'none';
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%) scale(0.8)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 500);
            }, duration);
        }

        // Fonction améliorée pour gérer les clics sur les liens en maintenance
        function handleMaintenanceClick(section, event) {
            try {
                // Empêcher la navigation
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                console.log(`🔧 Tentative d'accès à ${section} - Affichage notification maintenance`);
                
                // Afficher la notification de maintenance
                showMaintenanceNotification(section);
                
                // Effet visuel sur le bouton cliqué
                if (event && event.target) {
                    const clickedElement = event.target.closest('a');
                    if (clickedElement) {
                        clickedElement.style.transition = 'all 0.3s ease';
                        clickedElement.style.transform = 'scale(0.95)';
                        clickedElement.style.opacity = '0.4';
                        
                        setTimeout(() => {
                            clickedElement.style.transform = 'scale(1)';
                            clickedElement.style.opacity = '0.6';
                        }, 200);
                    }
                }
                
                return false;
                
            } catch (error) {
                console.error('❌ Erreur dans handleMaintenanceClick:', error);
                alert(`${section} en maintenance - Fonctionnalité temporairement indisponible`);
                return false;
            }
        }

        // Rendre les fonctions accessibles globalement (après leur définition)
        window.handleMaintenanceClick = handleMaintenanceClick;
        window.showMaintenanceNotification = showMaintenanceNotification;
        window.createNewUser = createNewUser;
        window.showCreateUserModal = showCreateUserModal;
        window.editUser = editUser;
        window.deleteUser = deleteUser;
        window.showAdminPanel = showAdminPanel;
        window.showAdminTab = showAdminTab;

        // Ajouter les animations CSS si elles n'existent pas
        if (!document.querySelector('#maintenance-animations')) {
            const style = document.createElement('style');
            style.id = 'maintenance-animations';
            style.textContent = `
                @keyframes slideInFromRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
                @keyframes slideOutToRight {
                    from {
                        transform: translateX(0);
                        opacity: 1;
                    }
                    to {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }

        // Animation festive de bienvenue pour la première connexion
        function showWelcomeAnimation(username) {
            // Créer l'overlay de l'animation
            const welcomeOverlay = document.createElement('div');
            welcomeOverlay.id = 'welcome-animation';
            welcomeOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(26,9,62,0.95), rgba(18,7,45,0.95));
                backdrop-filter: blur(10px);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                transition: opacity 0.5s ease;
            `;

            // Contenu de l'animation
            welcomeOverlay.innerHTML = `
                <div class="welcome-content" style="
                    text-align: center;
                    color: white;
                    max-width: 600px;
                    padding: 40px;
                    transform: scale(0.8);
                    transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                ">
                    <!-- Étoiles animées -->
                    <div class="stars-container" style="
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        pointer-events: none;
                        overflow: hidden;
                    "></div>
                    
                    <!-- Confettis -->
                    <div class="confetti-container" style="
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        pointer-events: none;
                        overflow: hidden;
                    "></div>
                    
                    <!-- Avatar festif -->
                    <div class="welcome-avatar" style="
                        width: 120px;
                        height: 120px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, #b48aff, #6c2eb6);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin: 0 auto 30px;
                        font-size: 3em;
                        box-shadow: 0 20px 40px rgba(180,138,255,0.4);
                        position: relative;
                        animation: welcomePulse 2s ease-in-out infinite;
                    ">
                        <i class="fas fa-user-check" style="
                            color: white;
                            animation: welcomeBounce 1s ease-in-out infinite alternate;
                        "></i>
                        
                        <!-- Cercles animés autour de l'avatar -->
                        <div style="
                            position: absolute;
                            top: -20px;
                            left: -20px;
                            right: -20px;
                            bottom: -20px;
                            border: 3px solid rgba(180,138,255,0.3);
                            border-radius: 50%;
                            animation: welcomeRotate 3s linear infinite;
                        "></div>
                        <div style="
                            position: absolute;
                            top: -35px;
                            left: -35px;
                            right: -35px;
                            bottom: -35px;
                            border: 2px dashed rgba(180,138,255,0.2);
                            border-radius: 50%;
                            animation: welcomeRotate 4s linear infinite reverse;
                        "></div>
                    </div>
                    
                    <!-- Titre de bienvenue -->
                    <h1 style="
                        font-size: 3em;
                        margin: 0 0 20px 0;
                        background: linear-gradient(45deg, #b48aff, #8a5cf6, #ff6b9d);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                        animation: welcomeGlow 2s ease-in-out infinite alternate;
                        text-shadow: 0 0 30px rgba(180,138,255,0.5);
                    ">🎉 Bienvenue ! 🎉</h1>
                    
                    <!-- Message personnalisé -->
                    <h2 style="
                        font-size: 1.8em;
                        margin: 0 0 30px 0;
                        color: #f5f5fa;
                        opacity: 0;
                        animation: welcomeFadeInUp 1s ease-out 0.5s forwards;
                    ">Salut ${username} !</h2>
                    
                    <!-- Message d'accueil -->
                    <p style="
                        font-size: 1.2em;
                        line-height: 1.6;
                        color: rgba(245,245,250,0.9);
                        margin: 0 0 40px 0;
                        opacity: 0;
                        animation: welcomeFadeInUp 1s ease-out 1s forwards;
                    ">
                        Félicitations pour votre première connexion à <strong style="color: #b48aff;">Syn Agency</strong> !<br>
                        Votre profil OnlyFans est maintenant connecté et synchronisé.
                    </p>
                    
                    <!-- Boutons d'action -->
                    <div style="
                        display: flex;
                        gap: 20px;
                        justify-content: center;
                        flex-wrap: wrap;
                        opacity: 0;
                        animation: welcomeFadeInUp 1s ease-out 1.5s forwards;
                    ">
                        <button onclick="closeWelcomeAnimation()" style="
                            background: linear-gradient(135deg, #b48aff, #6c2eb6);
                            border: none;
                            border-radius: 25px;
                            padding: 15px 30px;
                            color: white;
                            font-weight: 600;
                            font-size: 1.1em;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 10px 30px rgba(180,138,255,0.3);
                            position: relative;
                            overflow: hidden;
                        " onmouseover="this.style.transform='translateY(-3px) scale(1.05)'" onmouseout="this.style.transform='translateY(0) scale(1)'">
                            <i class="fas fa-rocket"></i> Commencer l'aventure !
                        </button>
                        
                        <button onclick="showDashboardTour()" style="
                            background: rgba(180,138,255,0.1);
                            border: 2px solid #b48aff;
                            border-radius: 25px;
                            padding: 15px 30px;
                            color: #b48aff;
                            font-weight: 600;
                            font-size: 1.1em;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='rgba(180,138,255,0.2)'" onmouseout="this.style.background='rgba(180,138,255,0.1)'">
                            <i class="fas fa-map"></i> Visite guidée
                        </button>
                    </div>
                    
                    <!-- Indicateur de progression -->
                    <div style="
                        margin-top: 40px;
                        opacity: 0;
                        animation: welcomeFadeInUp 1s ease-out 2s forwards;
                    ">
                        <p style="color: rgba(245,245,250,0.7); font-size: 0.9em; margin-bottom: 10px;">
                            Cliquez n'importe où pour continuer
                        </p>
                        <div style="
                            width: 40px;
                            height: 6px;
                            background: rgba(180,138,255,0.3);
                            border-radius: 3px;
                            margin: 0 auto;
                            overflow: hidden;
                        ">
                            <div style="
                                width: 100%;
                                height: 100%;
                                background: linear-gradient(90deg, #b48aff, #8a5cf6);
                                border-radius: 3px;
                                animation: welcomeProgress 3s ease-in-out infinite;
                            "></div>
                        </div>
                    </div>
                </div>
            `;

            // Ajouter les styles d'animation
            const welcomeStyles = document.createElement('style');
            welcomeStyles.textContent = `
                @keyframes welcomePulse {
                    0%, 100% { transform: scale(1); box-shadow: 0 20px 40px rgba(180,138,255,0.4); }
                    50% { transform: scale(1.05); box-shadow: 0 25px 50px rgba(180,138,255,0.6); }
                }
                
                @keyframes welcomeBounce {
                    0% { transform: translateY(0); }
                    100% { transform: translateY(-10px); }
                }
                
                @keyframes welcomeRotate {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                
                @keyframes welcomeGlow {
                    0% { text-shadow: 0 0 30px rgba(180,138,255,0.5); }
                    100% { text-shadow: 0 0 50px rgba(180,138,255,0.8), 0 0 80px rgba(180,138,255,0.4); }
                }
                
                @keyframes welcomeFadeInUp {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                
                @keyframes welcomeProgress {
                    0% { transform: translateX(-100%); }
                    50% { transform: translateX(0%); }
                    100% { transform: translateX(100%); }
                }
                
                @keyframes sparkle {
                    0%, 100% { opacity: 0; transform: scale(0); }
                    50% { opacity: 1; transform: scale(1); }
                }
                
                @keyframes confettiFall {
                    0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
                    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
                }
            `;
            document.head.appendChild(welcomeStyles);

            // Ajouter l'overlay au DOM
            document.body.appendChild(welcomeOverlay);

            // Animation d'entrée
            setTimeout(() => {
                welcomeOverlay.style.opacity = '1';
                welcomeOverlay.querySelector('.welcome-content').style.transform = 'scale(1)';
            }, 100);

            // Créer les étoiles animées
            createSparkles(welcomeOverlay.querySelector('.stars-container'));
            
            // Créer les confettis
            createConfetti(welcomeOverlay.querySelector('.confetti-container'));

            // Fermer en cliquant n'importe où après 2 secondes
            setTimeout(() => {
                welcomeOverlay.addEventListener('click', closeWelcomeAnimation);
            }, 2000);

            // Fermeture automatique après 10 secondes
            setTimeout(() => {
                if (document.getElementById('welcome-animation')) {
                    closeWelcomeAnimation();
                }
            }, 10000);
        }

        // Créer des étoiles scintillantes
        function createSparkles(container) {
            for (let i = 0; i < 30; i++) {
                const sparkle = document.createElement('div');
                sparkle.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: #fff;
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: sparkle ${2 + Math.random() * 3}s ease-in-out infinite;
                    animation-delay: ${Math.random() * 2}s;
                `;
                container.appendChild(sparkle);
            }
        }

        // Créer des confettis qui tombent
        function createConfetti(container) {
            const colors = ['#b48aff', '#8a5cf6', '#ff6b9d', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: absolute;
                    width: ${4 + Math.random() * 8}px;
                    height: ${4 + Math.random() * 8}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${Math.random() * 100}%;
                    top: -20px;
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    animation: confettiFall ${3 + Math.random() * 4}s linear infinite;
                    animation-delay: ${Math.random() * 3}s;
                `;
                container.appendChild(confetti);
            }
        }

        // Fermer l'animation de bienvenue
        function closeWelcomeAnimation() {
            const welcomeOverlay = document.getElementById('welcome-animation');
            if (welcomeOverlay) {
                welcomeOverlay.style.opacity = '0';
                welcomeOverlay.querySelector('.welcome-content').style.transform = 'scale(0.8)';
                
                setTimeout(() => {
                    if (document.body.contains(welcomeOverlay)) {
                        document.body.removeChild(welcomeOverlay);
                    }
                }, 500);
                
                // Marquer que la bienvenue a été affichée
                localStorage.setItem('welcomeShown', 'true');
                
                // Animation de célébration sur le dashboard
                celebrateDashboard();
            }
        }

        // Animation de célébration sur le dashboard
        function celebrateDashboard() {
            // Animation des cartes statistiques
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.animation = 'none';
                    card.offsetHeight; // Trigger reflow
                    card.style.animation = 'celebrateCard 0.6s ease-out';
                }, index * 100);
            });

            // Ajouter un style temporaire pour l'animation
            const celebrateStyle = document.createElement('style');
            celebrateStyle.textContent = `
                @keyframes celebrateCard {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.05) rotate(1deg); box-shadow: 0 15px 40px rgba(180,138,255,0.4); }
                    100% { transform: scale(1) rotate(0deg); }
                }
            `;
            document.head.appendChild(celebrateStyle);

            // Supprimer le style après l'animation
            setTimeout(() => {
                document.head.removeChild(celebrateStyle);
            }, 2000);
        }

        // Fonction pour la visite guidée (placeholder)
        function showDashboardTour() {
            closeWelcomeAnimation();
            startDashboardTour();
        }

        // Système de visite guidée interactive
        let currentTourStep = 0;
        const tourSteps = [
            {
                target: '.dashboard-header',
                title: '🏠 En-tête du Dashboard',
                content: 'Bienvenue dans votre espace de gestion ! Ici vous trouvez le titre de votre dashboard et le bouton pour retourner au site principal.',
                position: 'bottom'
            },
            {
                target: '.notification-bell',
                title: '🔔 Centre de Notifications',
                content: 'Restez informé de toutes les activités importantes ! Cliquez sur la cloche pour voir vos notifications en temps réel.',
                position: 'bottom'
            },
            {
                target: '.user-profile',
                title: '👤 Profil Utilisateur',
                content: 'Votre profil utilisateur avec avatar et informations de compte. Vous pouvez voir votre statut actuel ici.',
                position: 'bottom'
            },
            {
                target: '.stats-grid',
                title: '📊 Statistiques Principales',
                content: 'Vos métriques clés en un coup d\'œil : revenus, abonnés, vues et taux d\'engagement. Ces données se mettent à jour automatiquement.',
                position: 'bottom'
            },
            {
                target: '.profile-section',
                title: '🔗 Configuration OnlyFans',
                content: 'Section pour connecter et configurer votre profil OnlyFans. Actuellement en maintenance pour des améliorations.',
                position: 'top'
            },
            {
                target: '.quick-actions',
                title: '⚡ Actions Rapides',
                content: 'Accès rapide aux fonctionnalités principales : créer du contenu, envoyer des messages, gérer les promotions.',
                position: 'top'
            },
            {
                target: '.nav-dashboard',
                title: '🧭 Navigation Principale',
                content: 'Menu de navigation avec tous vos outils : Analytics, Contenu, Messages, Paramètres. Utilisez ces liens pour naviguer dans votre espace.',
                position: 'bottom'
            }
        ];

        function startDashboardTour() {
            currentTourStep = 0;
            createTourOverlay();
            showTourStep(currentTourStep);
        }

        function createTourOverlay() {
            // Créer l'overlay de la visite
            const tourOverlay = document.createElement('div');
            tourOverlay.id = 'tour-overlay';
            tourOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 9999;
                pointer-events: none;
                transition: all 0.3s ease;
            `;
            document.body.appendChild(tourOverlay);

            // Créer le tooltip de la visite
            const tourTooltip = document.createElement('div');
            tourTooltip.id = 'tour-tooltip';
            tourTooltip.style.cssText = `
                position: fixed;
                background: linear-gradient(135deg, #1a0d3e, #0d0a1f);
                border: 2px solid #b48aff;
                border-radius: 20px;
                padding: 25px;
                max-width: 400px;
                min-width: 300px;
                color: white;
                z-index: 10001;
                box-shadow: 0 20px 60px rgba(180,138,255,0.4);
                opacity: 0;
                transform: scale(0.8);
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                pointer-events: auto;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0.8);
            `;
            document.body.appendChild(tourTooltip);
        }

        function showTourStep(stepIndex) {
            const step = tourSteps[stepIndex];
            const targetElement = document.querySelector(step.target);
            const tooltip = document.getElementById('tour-tooltip');
            const overlay = document.getElementById('tour-overlay');

            if (!targetElement || !tooltip) return;

            // Highlight de l'élément cible
            highlightElement(targetElement);

            // Positionner le tooltip
            positionTooltip(tooltip, targetElement, step.position);

            // Contenu du tooltip
            tooltip.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3 style="
                        color: #b48aff; 
                        margin: 0 0 10px 0; 
                        font-size: 1.3em;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    ">
                        ${step.title}
                    </h3>
                    <p style="
                        color: rgba(245,245,250,0.9); 
                        margin: 0; 
                        line-height: 1.5;
                        font-size: 1em;
                    ">
                        ${step.content}
                    </p>
                </div>
                
                <div style="
                    display: flex; 
                    justify-content: space-between; 
                    align-items: center;
                    border-top: 1px solid rgba(180,138,255,0.2);
                    padding-top: 15px;
                ">
                    <div style="color: rgba(180,138,255,0.7); font-size: 0.9em;">
                        Étape ${stepIndex + 1} sur ${tourSteps.length}
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        ${stepIndex > 0 ? `
                            <button onclick="previousTourStep()" style="
                                background: rgba(180,138,255,0.1);
                                border: 1px solid rgba(180,138,255,0.3);
                                border-radius: 12px;
                                padding: 8px 16px;
                                color: #b48aff;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.background='rgba(180,138,255,0.2)'" onmouseout="this.style.background='rgba(180,138,255,0.1)'">
                                <i class="fas fa-arrow-left"></i> Précédent
                            </button>
                        ` : ''}
                        
                        ${stepIndex < tourSteps.length - 1 ? `
                            <button onclick="nextTourStep()" style="
                                background: linear-gradient(135deg, #b48aff, #6c2eb6);
                                border: none;
                                border-radius: 12px;
                                padding: 8px 16px;
                                color: white;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                Suivant <i class="fas fa-arrow-right"></i>
                            </button>
                        ` : `
                            <button onclick="endTour()" style="
                                background: linear-gradient(135deg, #4CAF50, #45a049);
                                border: none;
                                border-radius: 12px;
                                padding: 8px 16px;
                                color: white;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                <i class="fas fa-check"></i> Terminer
                            </button>
                        `}
                        
                        <button onclick="endTour()" style="
                            background: rgba(255,71,87,0.1);
                            border: 1px solid rgba(255,71,87,0.3);
                            border-radius: 12px;
                            padding: 8px 16px;
                            color: #ff4757;
                            cursor: pointer;
                            font-weight: 600;
                            transition: all 0.3s ease;
                            margin-left: 5px;
                        " onmouseover="this.style.background='rgba(255,71,87,0.2)'" onmouseout="this.style.background='rgba(255,71,87,0.1)'">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;

            // Animation d'apparition
            setTimeout(() => {
                tooltip.style.opacity = '1';
                tooltip.style.transform = 'scale(1)';
            }, 100);
        }

        function highlightElement(element) {
            // Supprimer l'ancien highlight
            const oldHighlight = document.querySelector('.tour-highlight');
            if (oldHighlight) {
                oldHighlight.remove();
            }

            // Obtenir les dimensions et position de l'élément
            const rect = element.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

            // Créer le highlight
            const highlight = document.createElement('div');
            highlight.className = 'tour-highlight';
            highlight.style.cssText = `
                position: absolute;
                top: ${rect.top + scrollTop - 10}px;
                left: ${rect.left + scrollLeft - 10}px;
                width: ${rect.width + 20}px;
                height: ${rect.height + 20}px;
                border: 3px solid #b48aff;
                border-radius: 15px;
                background: rgba(180,138,255,0.1);
                z-index: 10000;
                pointer-events: none;
                animation: tourPulse 2s ease-in-out infinite;
                box-shadow: 0 0 30px rgba(180,138,255,0.5);
            `;

            document.body.appendChild(highlight);

            // Scroll vers l'élément avec offset réduit pour la navigation sticky
            const navHeight = 80; // Hauteur réduite de la navigation
            let elementPosition = element.offsetTop - navHeight - 50; // Plus d'espace au-dessus
            
            // Pour la navigation elle-même, scroll tout en haut
            if (element.classList.contains('nav-dashboard') || 
                element.closest('.nav-dashboard')) {
                elementPosition = 0; // Scroll tout en haut de la page
            }
            
            window.scrollTo({
                top: Math.max(0, elementPosition),
                behavior: 'smooth'
            });

            // Ajouter les styles d'animation si pas déjà présents
            if (!document.querySelector('#tour-styles')) {
                const tourStyles = document.createElement('style');
                tourStyles.id = 'tour-styles';
                tourStyles.textContent = `
                    @keyframes tourPulse {
                        0%, 100% { 
                            transform: scale(1); 
                            box-shadow: 0 0 30px rgba(180,138,255,0.5);
                        }
                        50% { 
                            transform: scale(1.02); 
                            box-shadow: 0 0 40px rgba(180,138,255,0.8);
                        }
                    }
                `;
                document.head.appendChild(tourStyles);
            }
        }

        function positionTooltip(tooltip, targetElement, position) {
            const rect = targetElement.getBoundingClientRect();
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
            
            // Attendre que le tooltip soit rendu pour obtenir ses vraies dimensions
            setTimeout(() => {
                const tooltipRect = tooltip.getBoundingClientRect();
                let top, left;

                switch (position) {
                    case 'bottom':
                        top = rect.bottom + scrollTop + 5; // Réduire l'espace à 5px
                        left = rect.left + scrollLeft + (rect.width / 2) - (tooltipRect.width / 2);
                        break;
                    case 'top':
                        top = rect.top + scrollTop - tooltipRect.height - 5; // Réduire l'espace à 5px
                        left = rect.left + scrollLeft + (rect.width / 2) - (tooltipRect.width / 2);
                        break;
                    case 'left':
                        top = rect.top + scrollTop + (rect.height / 2) - (tooltipRect.height / 2);
                        left = rect.left + scrollLeft - tooltipRect.width - 5;
                        break;
                    case 'right':
                        top = rect.top + scrollTop + (rect.height / 2) - (tooltipRect.height / 2);
                        left = rect.right + scrollLeft + 5;
                        break;
                    default:
                        top = rect.bottom + scrollTop + 5;
                        left = rect.left + scrollLeft + (rect.width / 2) - (tooltipRect.width / 2);
                }

                // Vérifier les limites de l'écran et ajuster
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                const navHeight = 80; // Réduire la hauteur de navigation estimée

                // Ajustements horizontaux
                if (left < 15) {
                    left = 15;
                } else if (left + tooltipRect.width > windowWidth - 15) {
                    left = windowWidth - tooltipRect.width - 15;
                }

                // Ajustements verticaux - Plus agressifs pour remonter les tooltips
                if (top < navHeight + 10) {
                    // Si le tooltip est trop haut, le placer en dessous de l'élément mais plus proche
                    top = rect.bottom + scrollTop + 5;
                } else if (top + tooltipRect.height > scrollTop + windowHeight - 15) {
                    // Si le tooltip est trop bas, le placer au-dessus de l'élément
                    top = rect.top + scrollTop - tooltipRect.height - 5;
                }

                // Pour le header spécifiquement, forcer une position plus haute
                if (targetElement.classList.contains('dashboard-header') || 
                    targetElement.closest('.dashboard-header')) {
                    top = rect.bottom + scrollTop - 10; // Position encore plus proche
                }

                // Pour la navigation principale, forcer position tout en haut
                if (targetElement.classList.contains('nav-dashboard') || 
                    targetElement.closest('.nav-dashboard')) {
                    top = rect.bottom + scrollTop + 2; // Position juste sous le menu
                    // S'assurer que c'est visible même avec scroll
                    if (top < 90) {
                        top = 90; // Position minimale sous la nav fixe
                    }
                }

                // S'assurer que le tooltip reste visible mais plus haut
                if (top < navHeight + 10) {
                    top = navHeight + 10;
                }

                tooltip.style.top = top + 'px';
                tooltip.style.left = left + 'px';
                tooltip.style.transform = 'scale(1)';
            }, 30); // Réduire le délai pour un positionnement plus rapide
        }

        function nextTourStep() {
            if (currentTourStep < tourSteps.length - 1) {
                currentTourStep++;
                showTourStep(currentTourStep);
            }
        }

        function previousTourStep() {
            if (currentTourStep > 0) {
                currentTourStep--;
                showTourStep(currentTourStep);
            }
        }

        function endTour() {
            // Supprimer les éléments de la visite
            const overlay = document.getElementById('tour-overlay');
            const tooltip = document.getElementById('tour-tooltip');
            const highlight = document.querySelector('.tour-highlight');
            const styles = document.querySelector('#tour-styles');

            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => overlay.remove(), 300);
            }
            
            if (tooltip) {
                tooltip.style.opacity = '0';
                tooltip.style.transform = 'scale(0.8)';
                setTimeout(() => tooltip.remove(), 300);
            }
            
            if (highlight) {
                highlight.style.opacity = '0';
                setTimeout(() => highlight.remove(), 300);
            }

            if (styles) {
                setTimeout(() => styles.remove(), 300);
            }

            // Message de fin
            setTimeout(() => {
                showNotification('🎯 Visite guidée terminée ! Vous connaissez maintenant toutes les fonctionnalités principales.', 'info');
            }, 500);

            // Reset
            currentTourStep = 0;
        }

        // Fonction de test pour l'animation de bienvenue
        function testWelcomeAnimation() {
            // Forcer l'affichage de l'animation même si elle a déjà été vue
            const testUsernames = [
                'Sarah ✨',
                'Alex 🎉', 
                'Jordan 🌟',
                'Creator Pro 🚀',
                'Superstar 💫'
            ];
            
            const randomUsername = testUsernames[Math.floor(Math.random() * testUsernames.length)];
            
            // Supprimer temporairement le flag pour permettre le test
            const originalWelcomeShown = localStorage.getItem('welcomeShown');
            localStorage.removeItem('welcomeShown');
            
            showNotification('🎬 Lancement de l\'animation de test...', 'info');
            
            setTimeout(() => {
                showWelcomeAnimation(randomUsername);
                
                // Restaurer le flag après l'animation si il existait
                if (originalWelcomeShown) {
                    setTimeout(() => {
                        localStorage.setItem('welcomeShown', originalWelcomeShown);
                    }, 11000);
                }
            }, 1000);
        }

        // Fonction utilitaire pour réinitialiser l'état de bienvenue (pour les tests)
        function resetWelcomeState() {
            localStorage.removeItem('welcomeShown');
            showNotification('✅ État de bienvenue réinitialisé - La prochaine connexion OnlyFans déclenchera l\'animation');
        }

        // Fonction pour afficher des informations de débogage
        function showDebugInfo() {
            const welcomeShown = localStorage.getItem('welcomeShown');
            const ofProfile = JSON.parse(localStorage.getItem('ofProfile') || '{}');
            
            const debugInfo = `
🔍 Informations de débogage :
• Animation déjà vue : ${welcomeShown ? 'Oui' : 'Non'}
• Profil OF connecté : ${ofProfile.connected ? 'Oui' : 'Non'}
• Nom d'utilisateur : ${ofProfile.displayName || ofProfile.username || 'Non défini'}
• Date de connexion : ${ofProfile.connectedAt ? new Date(ofProfile.connectedAt).toLocaleString() : 'Jamais'}
            `;
            
            console.log(debugInfo);
            showNotification('ℹ️ Informations de débogage affichées dans la console', 'info');
        }

        // Fonctions pour la gestion du profil OnlyFans
        async function connectOFProfile() {
            showNotification('⚠️ Configuration OnlyFans en maintenance - Fonctionnalité temporairement indisponible', 'warning');
            return;
            
            // Créer un modal de connexion OnlyFans
            const modal = createOFLoginModal();
            document.body.appendChild(modal);
            
            // Afficher le modal avec animation
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.querySelector('.modal-content').style.transform = 'translateY(0)';
            }, 100);
        }

        function createOFLoginModal() {
            const modal = document.createElement('div');
            modal.className = 'of-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div class="modal-content" style="
                    background: linear-gradient(135deg, #1a0d3e, #0d0a1f);
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 500px;
                    width: 90%;
                    border: 1px solid #b48aff;
                    box-shadow: 0 20px 60px rgba(180,138,255,0.3);
                    transform: translateY(-50px);
                    transition: transform 0.3s ease;
                ">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="
                            width: 80px;
                            height: 80px;
                            border-radius: 50%;
                            background: linear-gradient(135deg, #b48aff, #6c2eb6);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            margin: 0 auto 20px;
                            font-size: 2em;
                            color: white;
                        ">
                            <i class="fab fa-fan" style="transform: rotate(45deg);"></i>
                        </div>
                        <h2 style="color: #f5f5fa; margin: 0 0 10px 0;">Connexion OnlyFans</h2>
                        <p style="color: #b0b0b0; margin: 0;">Connectez votre compte OnlyFans pour synchroniser vos données</p>
                    </div>
                    
                    <form id="of-login-form" style="margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: #f5f5fa; margin-bottom: 8px; font-weight: 600;">Email OnlyFans</label>
                            <input type="email" id="of-email" required style="
                                width: 100%;
                                background: rgba(180,138,255,0.1);
                                border: 1px solid rgba(180,138,255,0.3);
                                border-radius: 12px;
                                padding: 15px;
                                color: #f5f5fa;
                                font-size: 1em;
                                box-sizing: border-box;
                            " placeholder="votre-email@example.com">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: #f5f5fa; margin-bottom: 8px; font-weight: 600;">Mot de passe</label>
                            <input type="password" id="of-password" required style="
                                width: 100%;
                                background: rgba(180,138,255,0.1);
                                border: 1px solid rgba(180,138,255,0.3);
                                border-radius: 12px;
                                padding: 15px;
                                color: #f5f5fa;
                                font-size: 1em;
                                box-sizing: border-box;
                            " placeholder="••••••••">
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <label style="display: block; color: #f5f5fa; margin-bottom: 8px; font-weight: 600;">Token API (optionnel)</label>
                            <input type="text" id="of-token" style="
                                width: 100%;
                                background: rgba(180,138,255,0.1);
                                border: 1px solid rgba(180,138,255,0.3);
                                border-radius: 12px;
                                padding: 15px;
                                color: #f5f5fa;
                                font-size: 1em;
                                box-sizing: border-box;
                            " placeholder="Token API pour accès avancé">
                            <small style="color: #888; margin-top: 5px; display: block;">Le token API permet une synchronisation automatique</small>
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button type="button" onclick="closeOFModal()" style="
                                flex: 1;
                                background: rgba(180,138,255,0.1);
                                border: 1px solid rgba(180,138,255,0.3);
                                border-radius: 12px;
                                padding: 15px;
                                color: #b48aff;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            ">Annuler</button>
                            
                            <button type="submit" style="
                                flex: 2;
                                background: linear-gradient(135deg, #b48aff, #6c2eb6);
                                border: none;
                                border-radius: 12px;
                                padding: 15px;
                                color: white;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            ">
                                <i class="fas fa-link"></i> Connecter
                            </button>
                        </div>
                    </form>
                    
                    <div style="text-align: center; padding-top: 20px; border-top: 1px solid rgba(180,138,255,0.1);">
                        <p style="color: #888; font-size: 0.9em; margin: 0;">
                            <i class="fas fa-shield-alt"></i> Vos données sont sécurisées et chiffrées
                        </p>
                    </div>
                </div>
            `;
            
            // Ajouter l'événement de soumission du formulaire
            modal.querySelector('#of-login-form').addEventListener('submit', handleOFLogin);
            
            // Fermer le modal en cliquant à l'extérieur
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeOFModal();
                }
            });
            
            return modal;
        }

        async function handleOFLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('of-email').value;
            const password = document.getElementById('of-password').value;
            const token = document.getElementById('of-token').value;
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Animation de chargement
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Connexion...';
            submitBtn.disabled = true;
            
            try {
                // Appel à l'API OnlyFans
                const result = await authenticateWithOnlyFans(email, password, token);
                
                if (result.success) {
                    // Stocker les informations de connexion
                    const profileData = {
                        connected: true,
                        email: email,
                        username: result.username,
                        displayName: result.displayName,
                        bio: result.bio,
                        token: token || null,
                        connectedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('ofProfile', JSON.stringify(profileData));
                    
                    // Vérifier si c'est la première connexion
                    const isFirstConnection = !localStorage.getItem('welcomeShown');
                    
                    // Mettre à jour l'interface
                    updateOFProfileStatus(true);
                    populateOFProfileData(result);
                    
                    closeOFModal();
                    
                    if (isFirstConnection) {
                        // Animation de bienvenue pour la première connexion
                        setTimeout(() => {
                            showWelcomeAnimation(result.displayName || result.username || 'Créateur');
                        }, 500);
                    } else {
                        // Message de reconnexion pour les connexions suivantes
                        showNotification('Reconnecté avec succès ! Bienvenue à nouveau.');
                    }
                    
                    // Synchroniser automatiquement les données
                    setTimeout(() => syncOFProfile(), isFirstConnection ? 3000 : 1000);
                    
                } else {
                    throw new Error(result.error || 'Erreur de connexion');
                }
                
            } catch (error) {
                console.error('Erreur de connexion OnlyFans:', error);
                showNotification('Erreur de connexion: ' + error.message, 'error');
                
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function authenticateWithOnlyFans(email, password, token) {
            try {
                // Utiliser l'API OnlyFans réelle
                const result = await ofAPI.authenticate(email, password);
                
                if (result.success) {
                    // Récupérer les informations du profil
                    const profileInfo = await ofAPI.getProfileInfo();
                    const stats = await ofAPI.getProfileStats();
                    
                    return {
                        success: true,
                        username: profileInfo.data.username,
                        displayName: profileInfo.data.displayName,
                        bio: profileInfo.data.bio,
                        stats: stats.data,
                        token: result.token,
                        userId: result.user.id
                    };
                } else {
                    return {
                        success: false,
                        error: result.error || 'Erreur de connexion'
                    };
                }
            } catch (error) {
                console.error('Erreur d\'authentification OnlyFans:', error);
                
                // Fallback vers simulation si l'API réelle échoue
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (email && password) {
                            resolve({
                                success: true,
                                username: email.split('@')[0],
                                displayName: 'Créateur OnlyFans',
                                bio: 'Profil synchronisé depuis OnlyFans',
                                stats: {
                                    subscribers: 1247,
                                    revenue: 2850.50,
                                    posts: 156,
                                    likes: 8932,
                                    views: 45600,
                                    engagement: 78
                                }
                            });
                        } else {
                            resolve({
                                success: false,
                                error: 'Identifiants invalides'
                            });
                        }
                    }, 2000);
                });
            }
        }

        function populateOFProfileData(data) {
            document.getElementById('of-username').disabled = false;
            document.getElementById('of-display-name').disabled = false;
            document.querySelector('.sync-btn').disabled = false;
            document.querySelector('.save-btn').disabled = false;
            
            document.getElementById('of-username').value = data.username || '';
            document.getElementById('of-display-name').value = data.displayName || '';
            
            // Stocker les valeurs originales pour détecter les changements
            window.originalProfileData = {
                username: data.username || '',
                displayName: data.displayName || ''
            };
        }

        function checkProfileChanges() {
            if (!window.originalProfileData) return;
            
            const currentData = {
                username: document.getElementById('of-username').value,
                displayName: document.getElementById('of-display-name').value
            };
            
            const hasChanges = 
                currentData.username !== window.originalProfileData.username ||
                currentData.displayName !== window.originalProfileData.displayName;
            
            const saveBtn = document.querySelector('.save-btn');
            if (hasChanges) {
                saveBtn.style.background = 'linear-gradient(135deg, #ff9800, #f57c00)';
                saveBtn.innerHTML = '<i class="fas fa-exclamation-circle"></i> Modifications non sauvées';
            } else {
                saveBtn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Sauvegarder';
            }
        }

        async function saveOFProfile() {
            showNotification('⚠️ Configuration OnlyFans en maintenance - Fonctionnalité temporairement indisponible', 'warning');
            return;
            
            try {
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sauvegarde...';
                saveBtn.disabled = true;
                
                const profileData = {
                    username: document.getElementById('of-username').value,
                    displayName: document.getElementById('of-display-name').value
                };
                
                const profile = JSON.parse(localStorage.getItem('ofProfile') || '{}');
                
                if (profile.token) {
                    ofAPI.authToken = profile.token;
                }
                
                // Mettre à jour le profil via l'API OnlyFans
                const result = await ofAPI.updateProfile(profileData);
                
                if (result.success) {
                    // Mettre à jour les données locales
                    const updatedProfile = {
                        ...profile,
                        ...profileData,
                        lastUpdate: new Date().toISOString()
                    };
                    localStorage.setItem('ofProfile', JSON.stringify(updatedProfile));
                    
                    // Réinitialiser les valeurs originales
                    window.originalProfileData = { ...profileData };
                    
                    saveBtn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
                    saveBtn.innerHTML = '<i class="fas fa-check"></i> Sauvegardé !';
                    
                    showNotification('Profil mis à jour avec succès !');
                    
                    setTimeout(() => {
                        saveBtn.innerHTML = '<i class="fas fa-save"></i> Sauvegarder';
                    }, 2000);
                    
                } else {
                    throw new Error(result.error || 'Erreur de sauvegarde');
                }
                
            } catch (error) {
                console.error('Erreur sauvegarde profil:', error);
                showNotification('Erreur lors de la sauvegarde: ' + error.message, 'error');
                
                saveBtn.innerHTML = originalText;
            } finally {
                saveBtn.disabled = false;
            }
        }

        function closeOFModal() {
            const modal = document.querySelector('.of-modal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            }
        }

        async function syncOFProfile() {
            showNotification('⚠️ Configuration OnlyFans en maintenance - Fonctionnalité temporairement indisponible', 'warning');
            return;
            
            // Animation de synchronisation
            syncBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Synchronisation...';
            syncBtn.disabled = true;
            
            try {
                const profile = JSON.parse(localStorage.getItem('ofProfile') || '{}');
                
                if (!profile.connected) {
                    throw new Error('Profil non connecté');
                }
                
                // Appel API pour synchroniser les données
                const syncResult = await syncWithOnlyFansAPI(profile);
                
                if (syncResult.success) {
                    // Mettre à jour les statistiques du dashboard
                    updateDashboardStats(syncResult.data);
                    
                    // Mettre à jour les informations de profil
                    const updatedProfile = {
                        ...profile,
                        lastSync: new Date().toISOString(),
                        stats: syncResult.data
                    };
                    localStorage.setItem('ofProfile', JSON.stringify(updatedProfile));
                    
                    showNotification('Synchronisation réussie ! Données mises à jour.');
                } else {
                    throw new Error(syncResult.error || 'Erreur de synchronisation');
                }
                
            } catch (error) {
                console.error('Erreur de synchronisation:', error);
                showNotification('Erreur de synchronisation: ' + error.message, 'error');
            } finally {
                syncBtn.innerHTML = originalText;
                syncBtn.disabled = false;
            }
        }

        async function syncWithOnlyFansAPI(profile) {
            try {
                // Utiliser l'API OnlyFans réelle pour récupérer les statistiques
                if (profile.token) {
                    ofAPI.authToken = profile.token;
                }
                
                const stats = await ofAPI.getProfileStats();
                const profileInfo = await ofAPI.getProfileInfo();
                
                if (stats.success && profileInfo.success) {
                    return {
                        success: true,
                        data: {
                            ...stats.data,
                            username: profileInfo.data.username,
                            displayName: profileInfo.data.displayName,
                            bio: profileInfo.data.bio
                        }
                    };
                } else {
                    throw new Error('Erreur lors de la récupération des données');
                }
                
            } catch (error) {
                console.error('Erreur API OnlyFans:', error);
                
                // Fallback vers simulation
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            success: true,
                            data: {
                                subscribers: Math.floor(Math.random() * 1000) + 1000,
                                revenue: Math.floor(Math.random() * 5000) + 1000,
                                views: Math.floor(Math.random() * 50000) + 10000,
                                engagement: Math.floor(Math.random() * 20) + 80,
                                posts: Math.floor(Math.random() * 100) + 50
                            }
                        });
                    }, 1500);
                });
            }
        }

        function updateDashboardStats(stats) {
            // Mettre à jour les cartes de statistiques avec les vraies données
            if (stats.revenue) {
                document.getElementById('revenue-month').textContent = `${stats.revenue.toLocaleString('fr-FR')}€`;
                document.querySelector('#revenue-month').parentElement.querySelector('.stat-change').innerHTML = 
                    '<i class="fas fa-arrow-up"></i> Données synchronisées';
            }
            
            if (stats.subscribers) {
                document.getElementById('subscribers').textContent = stats.subscribers.toLocaleString('fr-FR');
                document.querySelector('#subscribers').parentElement.querySelector('.stat-change').innerHTML = 
                    '<i class="fas fa-arrow-up"></i> Données synchronisées';
            }
            
            if (stats.views) {
                document.getElementById('views').textContent = stats.views.toLocaleString('fr-FR');
                document.querySelector('#views').parentElement.querySelector('.stat-change').innerHTML = 
                    '<i class="fas fa-arrow-up"></i> Données synchronisées';
            }
            
            if (stats.engagement) {
                document.getElementById('engagement').textContent = `${stats.engagement}%`;
                document.querySelector('#engagement').parentElement.querySelector('.stat-change').innerHTML = 
                    '<i class="fas fa-arrow-up"></i> Données synchronisées';
            }
        }

        function updateOFProfileStatus(connected) {
            const statusIndicator = document.querySelector('.status-indicator');
            const statusText = document.querySelector('.status-text');
            const connectBtn = document.querySelector('.connect-btn');
            
            if (connected) {
                statusIndicator.className = 'status-indicator connected';
                statusText.textContent = 'Connecté';
                connectBtn.innerHTML = '<i class="fas fa-unlink"></i> Déconnecter';
                connectBtn.onclick = disconnectOFProfile;
            } else {
                statusIndicator.className = 'status-indicator disconnected';
                statusText.textContent = 'Non connecté';
                connectBtn.innerHTML = '<i class="fas fa-link"></i> Connecter le profil';
                connectBtn.onclick = connectOFProfile;
            }
        }

        function disconnectOFProfile() {
            showNotification('⚠️ Configuration OnlyFans en maintenance - Fonctionnalité temporairement indisponible', 'warning');
            return;
            
            if (confirmed) {
                // Supprimer les données de connexion
                localStorage.removeItem('ofProfile');
                
                updateOFProfileStatus(false);
                showNotification('Profil OnlyFans déconnecté');
                
                // Désactiver les champs et vider le formulaire
                document.getElementById('of-username').disabled = true;
                document.getElementById('of-display-name').disabled = true;
                document.querySelector('.sync-btn').disabled = true;
                document.querySelector('.save-btn').disabled = true;
                
                document.getElementById('of-username').value = '';
                document.getElementById('of-display-name').value = '';
                
                // Réinitialiser les données originales
                window.originalProfileData = null;
                
                // Remettre les stats à zéro
                resetDashboardStats();
            }
        }

        function resetDashboardStats() {
            document.getElementById('revenue-month').textContent = '0€';
            document.getElementById('subscribers').textContent = '0';
            document.getElementById('views').textContent = '0';
            document.getElementById('engagement').textContent = '0%';
            
            // Remettre les messages de chargement
            document.querySelectorAll('.stat-change').forEach(element => {
                element.innerHTML = '<i class="fas fa-chart-line"></i> Données en cours de chargement';
            });
        }

        // Vérifier l'état de connexion OnlyFans au chargement
        function checkOFProfileStatus() {
            const profile = JSON.parse(localStorage.getItem('ofProfile') || '{}');
            
            if (profile.connected) {
                updateOFProfileStatus(true);
                populateOFProfileData(profile);
                
                // Synchronisation automatique si plus de 1 heure
                const lastSync = new Date(profile.lastSync || 0);
                const now = new Date();
                const hoursSinceSync = (now - lastSync) / (1000 * 60 * 60);
                
                if (hoursSinceSync > 1) {
                    setTimeout(() => {
                        showNotification('Synchronisation automatique en cours...');
                        syncOFProfile();
                    }, 2000);
                } else if (profile.stats) {
                    updateDashboardStats(profile.stats);
                }
            }
        }

        // Fonction pour obtenir un nouveau conseil quotidien
        function getNewDailyTip() {
            const dailyTips = [
                "La régularité est la clé du succès : postez du contenu de qualité chaque jour pour fidéliser votre audience.",
                "Interagissez authentiquement avec vos fans - les relations personnelles génèrent plus de revenus.",
                "Utilisez des hashtags pertinents et populaires pour augmenter la visibilité de vos posts.",
                "Créez du contenu exclusif et premium pour justifier vos prix d'abonnement.",
                "Analysez vos statistiques pour identifier les types de contenu les plus performants.",
                "Proposez des offres spéciales et des promotions lors d'événements ou de saisons.",
                "Collaborez avec d'autres créateurs pour élargir votre audience et partager des conseils.",
                "Soignez votre profil et votre bio - c'est votre première impression auprès des nouveaux visiteurs.",
                "Utilisez les stories et les posts temporaires pour créer un sentiment d'urgence.",
                "Répondez rapidement aux messages privés - la réactivité fidélise vos abonnés premium.",
                "Variez vos formats : photos, vidéos, lives, messages audio pour maintenir l'intérêt.",
                "Planifiez votre contenu à l'avance avec un calendrier éditorial structuré.",
                "Utilisez un bon éclairage naturel ou des ring lights pour améliorer la qualité visuelle.",
                "Créez des séries ou des thématiques récurrentes pour fidéliser votre audience.",
                "Montrez votre personnalité authentique - les fans apprécient la sincérité.",
                "Utilisez les sondages et questions pour engager votre communauté.",
                "Optimisez vos prix en fonction de votre contenu et de votre audience cible.",
                "Créez des bundles et des packages attractifs pour augmenter votre revenu moyen.",
                "Utilisez les réseaux sociaux pour promouvoir votre contenu OnlyFans.",
                "Restez à l'écoute des tendances et adaptez votre contenu en conséquence."
            ];

            const tipElement = document.getElementById('daily-tip');
            const currentTip = tipElement.textContent.trim().replace(/"/g, '');
            
            // Filtrer pour éviter le même conseil
            const availableTips = dailyTips.filter(tip => tip !== currentTip);
            const randomTip = availableTips[Math.floor(Math.random() * availableTips.length)];
            
            // Animation de changement fluide
            tipElement.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            tipElement.style.opacity = '0';
            tipElement.style.transform = 'translateY(-20px) scale(0.95)';
            
            setTimeout(() => {
                tipElement.textContent = `"${randomTip}"`;
                tipElement.style.opacity = '1';
                tipElement.style.transform = 'translateY(0) scale(1)';
                
                // Effet de brillance temporaire
                tipElement.style.textShadow = '0 0 15px rgba(180,138,255,0.6)';
                setTimeout(() => {
                    tipElement.style.textShadow = '';
                }, 1000);
            }, 250);

            // Notification de succès
            showNotification('💡 Nouveau conseil généré !', 'info');
        }

        // Animation d'entrée pour les cartes de conseils
        function animateTipsSection() {
            const tipCards = document.querySelectorAll('.tip-card');
            tipCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(40px) scale(0.9)';
                card.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0) scale(1)';
                }, index * 150 + 400);
            });
        }

        // Initialiser les animations des conseils au chargement
        document.addEventListener('DOMContentLoaded', function() {
            // Attendre que les autres animations soient terminées
            setTimeout(() => {
                animateTipsSection();
            }, 1000);
        });

        // Fonction de test pour les boutons de maintenance (pour debug)
        function testMaintenanceButtons() {
            console.log('🧪 Test des boutons de maintenance...');
            showMaintenanceNotification('Test Analytics');
            setTimeout(() => {
                showMaintenanceNotification('Test Messages');
            }, 1000);
        }

        // Fonction pour obtenir un nouveau conseil quotidien
        function getNewDailyTip() {
            const dailyTips = [
                "La régularité est la clé du succès : postez du contenu de qualité chaque jour pour fidéliser votre audience.",
                "Interagissez authentiquement avec vos fans - les relations personnelles génèrent plus de revenus.",
                "Utilisez des hashtags pertinents et populaires pour augmenter la visibilité de vos posts.",
                "Créez du contenu exclusif et premium pour justifier vos prix d'abonnement.",
                "Analysez vos statistiques pour identifier les types de contenu les plus performants.",
                "Proposez des offres spéciales et des promotions lors d'événements ou de saisons.",
                "Collaborez avec d'autres créateurs pour élargir votre audience et partager des conseils.",
                "Soignez votre profil et votre bio - c'est votre première impression auprès des nouveaux visiteurs.",
                "Utilisez les stories et les posts temporaires pour créer un sentiment d'urgence.",
                "Répondez rapidement aux messages privés - la réactivité fidélise vos abonnés premium.",
                "Variez vos formats : photos, vidéos, lives, messages audio pour maintenir l'intérêt.",
                "Planifiez votre contenu à l'avance avec un calendrier éditorial structuré.",
                "Utilisez un bon éclairage naturel ou des ring lights pour améliorer la qualité visuelle.",
                "Créez des séries ou des thématiques récurrentes pour fidéliser votre audience.",
                "Montrez votre personnalité authentique - les fans apprécient la sincérité.",
                "Utilisez les sondages et questions pour engager votre communauté.",
                "Optimisez vos prix en fonction de votre contenu et de votre audience cible.",
                "Créez des bundles et des packages attractifs pour augmenter votre revenu moyen.",
                "Utilisez les réseaux sociaux pour promouvoir votre contenu OnlyFans.",
                "Restez à l'écoute des tendances et adaptez votre contenu en conséquence."
            ];

            const tipElement = document.getElementById('daily-tip');
            const currentTip = tipElement.textContent.trim().replace(/"/g, '');
            
            // Filtrer pour éviter le même conseil
            const availableTips = dailyTips.filter(tip => tip !== currentTip);
            const randomTip = availableTips[Math.floor(Math.random() * availableTips.length)];
            
            // Animation de changement fluide
            tipElement.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            tipElement.style.opacity = '0';
            tipElement.style.transform = 'translateY(-20px) scale(0.95)';
            
            setTimeout(() => {
                tipElement.textContent = `"${randomTip}"`;
                tipElement.style.opacity = '1';
                tipElement.style.transform = 'translateY(0) scale(1)';
                
                // Effet de brillance temporaire
                tipElement.style.textShadow = '0 0 15px rgba(180,138,255,0.6)';
                setTimeout(() => {
                    tipElement.style.textShadow = '';
                }, 1000);
            }, 250);

            // Notification de succès
            showNotification('💡 Nouveau conseil généré !', 'info');
        }

        // Animation d'entrée pour les cartes de conseils
        function animateTipsSection() {
            const tipCards = document.querySelectorAll('.tip-card');
            tipCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(40px) scale(0.9)';
                card.style.transition = 'all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0) scale(1)';
                }, index * 150 + 400);
            });
        }

        // Initialiser les animations des conseils au chargement
        document.addEventListener('DOMContentLoaded', function() {
            // Attendre que les autres animations soient terminées
            setTimeout(() => {
                animateTipsSection();
            }, 1000);
        });

        // Fonction de test pour les boutons de maintenance (pour debug)
        function testMaintenanceButtons() {
            console.log('🧪 Test des boutons de maintenance...');
            showMaintenanceNotification('Test Analytics');
            setTimeout(() => {
                showMaintenanceNotification('Test Messages');
            }, 1000);
        }

    </script>

    <!-- Scripts pour les nouvelles fonctionnalités -->
    <script>
        // Nouvelles fonctions pour les améliorations du dashboard

        // Fonction pour afficher le modal de planification
        function showAddContentModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
                animation: fadeIn 0.3s ease;
            `;

            modal.innerHTML = `
                <div style="
                    background: rgba(26,9,62,0.95);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    border: 1px solid #b48aff;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                    animation: slideInUp 0.4s ease;
                ">
                    <h3 style="color: #b48aff; margin: 0 0 20px 0; text-align: center;">
                        <i class="fas fa-calendar-plus"></i> Planifier du Contenu
                    </h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: #f5f5fa; display: block; margin-bottom: 5px;">Type de contenu</label>
                        <select style="width: 100%; background: rgba(180,138,255,0.1); border: 1px solid #b48aff; border-radius: 8px; padding: 10px; color: #f5f5fa;">
                            <option>Photo</option>
                            <option>Vidéo</option>
                            <option>Live Stream</option>
                            <option>Message</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="color: #f5f5fa; display: block; margin-bottom: 5px;">Date et heure</label>
                        <input type="datetime-local" style="width: 100%; background: rgba(180,138,255,0.1); border: 1px solid #b48aff; border-radius: 8px; padding: 10px; color: #f5f5fa;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="color: #f5f5fa; display: block; margin-bottom: 5px;">Description</label>
                        <textarea style="width: 100%; height: 80px; background: rgba(180,138,255,0.1); border: 1px solid #b48aff; border-radius: 8px; padding: 10px; color: #f5f5fa; resize: vertical;" placeholder="Décrivez votre contenu..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.closest('.modal').remove()" style="
                            background: rgba(255,255,255,0.1);
                            border: 1px solid rgba(255,255,255,0.3);
                            border-radius: 20px;
                            padding: 10px 20px;
                            color: #f5f5fa;
                            cursor: pointer;
                        ">Annuler</button>
                        <button onclick="scheduleContent(); this.closest('.modal').remove();" style="
                            background: linear-gradient(135deg, #4CAF50, #45a049);
                            border: none;
                            border-radius: 20px;
                            padding: 10px 20px;
                            color: white;
                            font-weight: 600;
                            cursor: pointer;
                        ">Planifier</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Fonction pour planifier du contenu
        function scheduleContent() {
            showNotification('📅 Contenu planifié avec succès !', 'success');
        }

        // Fonction pour afficher le calendrier
        function showCalendar() {
            document.querySelector('.calendar-section').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            showNotification('📅 Section calendrier activée', 'info');
        }

        // Fonction pour afficher les insights
        function showInsights() {
            document.querySelector('.charts-section').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            showNotification('📊 Analytics en cours de chargement...', 'info');
        }

        // Simuler des données en temps réel
        function updateRealTimeData() {
            const liveViews = document.getElementById('live-views');
            if (liveViews) {
                const currentViews = parseInt(liveViews.textContent.replace(/,/g, ''));
                const change = Math.floor(Math.random() * 10) - 5; // -5 à +5
                const newViews = Math.max(0, currentViews + change);
                liveViews.textContent = newViews.toLocaleString();
                
                // Effet de flash pour les changements importants
                if (Math.abs(change) > 3) {
                    liveViews.style.animation = 'flash 0.5s ease';
                    setTimeout(() => {
                        liveViews.style.animation = '';
                    }, 500);
                }
            }
        }

        // Animation de flash pour les mises à jour
        const flashStyle = document.createElement('style');
        flashStyle.textContent = `
            @keyframes flash {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; transform: scale(1.05); }
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes slideInUp {
                from { opacity: 0; transform: translateY(30px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(flashStyle);

        // Démarrer la mise à jour des données en temps réel
        setInterval(updateRealTimeData, 30000); // Chaque 30 secondes

        // Fonction pour animer les barres de graphique au scroll
        function animateChartsOnScroll() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const bars = entry.target.querySelectorAll('.chart-bar');
                        bars.forEach((bar, index) => {
                            setTimeout(() => {
                                bar.style.animation = `chartGrow 1s ease-out both`;
                            }, index * 100);
                        });
                    }
                });
            }, { threshold: 0.5 });

            const chartContainers = document.querySelectorAll('.chart-container');
            chartContainers.forEach(container => {
                observer.observe(container);
            });
        }

        // Améliorer l'animation des cartes d'accomplissements
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                animateChartsOnScroll();
            }, 1000);

            const achievementCards = document.querySelectorAll('.achievement-card');
            achievementCards.forEach((card, index) => {
                card.addEventListener('click', function() {
                    if (this.classList.contains('locked')) {
                        showNotification('🔒 Accomplissement verrouillé - Continuez à progresser !', 'warning');
                    } else {
                        showNotification('🏆 Accomplissement débloqué ! Félicitations !', 'success');
                    }
                });
                
                // Animation d'entrée décalée
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0) scale(1)';
                }, index * 200 + 500);
                
                // État initial pour l'animation
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px) scale(0.9)';
                card.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            });
        });

        // Rendre les nouvelles fonctions globalement accessibles
        window.showAddContentModal = showAddContentModal;
        window.scheduleContent = scheduleContent;
        window.showCalendar = showCalendar;
        window.showInsights = showInsights;

        // ===============================================
        // SUITE D'OUTILS CRÉATIFS - FONCTIONS JAVASCRIPT
        // ===============================================
        // ============================================
        // SYSTÈME DE GESTION DES FACTURES
        // ============================================
        
        // Fonction pour sauvegarder une facture
        function saveInvoice(invoice) {
            let invoices = JSON.parse(localStorage.getItem('invoices') || '[]');
            invoices.push(invoice);
            localStorage.setItem('invoices', JSON.stringify(invoices));
            console.log('💾 Facture sauvegardée :', invoice);
            
            // Mettre à jour les statistiques financières
            updateFinancialStats();
        }
        
        // Fonction pour récupérer toutes les factures
        function getInvoices() {
            return JSON.parse(localStorage.getItem('invoices') || '[]');
        }
        
        // Fonction pour afficher les factures dans le tableau
        function displayInvoices() {
            const invoices = getInvoices();
            const tbody = document.getElementById('invoices-table-body');
            
            if (!tbody) {
                console.log('⚠️ Tableau des factures non trouvé');
                return;
            }
            
            if (invoices.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px 20px; color: rgba(245,245,250,0.6);">
                            <i class="fas fa-file-invoice" style="font-size: 3em; margin-bottom: 15px; opacity: 0.3;"></i>
                            <p style="margin: 0; font-size: 1.1em;">Aucune facture disponible</p>
                            <p style="margin: 5px 0 0 0; font-size: 0.9em;">Créez votre première facture pour commencer</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Trier les factures par date de création (plus récentes en premier)
            invoices.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            tbody.innerHTML = invoices.map(invoice => {
                const statusColors = {
                    'En attente': { color: '#f59e0b', bg: 'rgba(245, 158, 11, 0.1)', icon: '⏳' },
                    'Payée': { color: '#22c55e', bg: 'rgba(34, 197, 94, 0.1)', icon: '✅' },
                    'En retard': { color: '#ef4444', bg: 'rgba(239, 68, 68, 0.1)', icon: '⚠️' }
                };
                
                const statusStyle = statusColors[invoice.status] || statusColors['En attente'];
                
                return `
                    <tr style="border-bottom: 1px solid rgba(180,138,255,0.1); transition: all 0.2s ease;" onmouseover="this.style.background='rgba(180,138,255,0.05)'" onmouseout="this.style.background='transparent'">
                        <td style="padding: 15px 8px; font-weight: 600; color: #b48aff;">${invoice.id}</td>
                        <td style="padding: 15px 8px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #b48aff, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                                    ${invoice.client.charAt(0).toUpperCase()}
                                </div>
                                <span style="color: #f5f5fa; font-weight: 500;">${invoice.client}</span>
                            </div>
                        </td>
                        <td style="padding: 15px 8px; color: #22c55e; font-weight: 700; font-size: 1.1em;">${invoice.amount.toFixed(2)}€</td>
                        <td style="padding: 15px 8px; color: #ec4899; font-weight: 600; font-size: 0.95em;">
                            ${(invoice.commission || 0).toFixed(2)}€
                            <br>
                            <small style="color: rgba(236, 72, 153, 0.7); font-size: 0.75em;">
                                ${invoice.commissionRate || 15}%
                            </small>
                        </td>
                        <td style="padding: 15px 8px; color: rgba(245,245,250,0.8);">${invoice.issueDate}</td>
                        <td style="padding: 15px 8px; color: rgba(245,245,250,0.8);">${invoice.dueDate}</td>
                        <td style="padding: 15px 8px;">
                            <select onchange="updateInvoiceStatus('${invoice.id}', this.value)" class="status-dropdown" style="
                                background: ${statusStyle.bg}; 
                                color: ${statusStyle.color}; 
                                padding: 6px 12px; 
                                border-radius: 20px; 
                                font-size: 0.85em; 
                                font-weight: 600;
                                border: 1px solid ${statusStyle.color}33;
                                cursor: pointer;
                                outline: none;
                                min-width: 140px;
                            ">
                                <option value="En attente" ${invoice.status === 'En attente' ? 'selected' : ''} style="background: #1f2937; color: #f59e0b;">⏳ En attente</option>
                                <option value="Payée" ${invoice.status === 'Payée' ? 'selected' : ''} style="background: #1f2937; color: #22c55e;">✅ Payée</option>
                                <option value="En retard" ${invoice.status === 'En retard' ? 'selected' : ''} style="background: #1f2937; color: #ef4444;">⚠️ En retard</option>
                            </select>
                        </td>
                        <td style="padding: 15px 8px;">
                            <div style="display: flex; gap: 8px;">
                                <button onclick="editInvoice('${invoice.id}')" style="
                                    background: rgba(59, 130, 246, 0.1);
                                    border: 1px solid rgba(59, 130, 246, 0.3);
                                    color: #3b82f6;
                                    border-radius: 6px;
                                    padding: 6px 10px;
                                    cursor: pointer;
                                    font-size: 0.8em;
                                    transition: all 0.2s ease;
                                " onmouseover="this.style.background='rgba(59, 130, 246, 0.2)'" onmouseout="this.style.background='rgba(59, 130, 246, 0.1)'">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteInvoice('${invoice.id}')" style="
                                    background: rgba(239, 68, 68, 0.1);
                                    border: 1px solid rgba(239, 68, 68, 0.3);
                                    color: #ef4444;
                                    border-radius: 6px;
                                    padding: 6px 10px;
                                    cursor: pointer;
                                    font-size: 0.8em;
                                    transition: all 0.2s ease;
                                " onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            console.log(`📊 ${invoices.length} facture(s) affichée(s)`);
        }
        
        // Fonction pour supprimer une facture
        function deleteInvoice(invoiceId) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette facture ?')) {
                let invoices = getInvoices();
                invoices = invoices.filter(invoice => invoice.id !== invoiceId);
                localStorage.setItem('invoices', JSON.stringify(invoices));
                displayInvoices();
                showNotification('🗑️ Facture supprimée avec succès', 'success');
                
                // Mettre à jour les statistiques financières
                updateFinancialStats();
            }
        }
        
        // Fonction pour éditer une facture
        function editInvoice(invoiceId) {
            const invoices = getInvoices();
            const invoice = invoices.find(inv => inv.id === invoiceId);
            
            if (!invoice) {
                showNotification('❌ Facture non trouvée', 'error');
                return;
            }
            
            // Créer le modal d'édition
            createEditModal(invoice);
        }
        
        // Fonction pour créer le modal d'édition
        function createEditModal(invoice) {
            // Supprimer le modal existant s'il y en a un
            const existingModal = document.getElementById('edit-invoice-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.id = 'edit-invoice-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, rgba(16, 7, 45, 0.95), rgba(180, 138, 255, 0.15));
                z-index: 2147483647;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                backdrop-filter: blur(20px);
                animation: fadeIn 0.3s ease-out;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                    padding: 40px;
                    border-radius: 20px;
                    max-width: 550px;
                    width: 90%;
                    max-height: 85vh;
                    overflow-y: auto;
                    box-shadow: 
                        0 25px 50px -12px rgba(0, 0, 0, 0.25),
                        0 0 0 1px rgba(255, 255, 255, 0.05),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
                    transform: translateY(0);
                    animation: slideUp 0.4s ease-out;
                    border: 1px solid rgba(180, 138, 255, 0.2);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="
                                width: 50px;
                                height: 50px;
                                background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                                border-radius: 12px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 20px;
                                color: white;
                                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
                            ">✏️</div>
                            <div>
                                <h3 style="margin: 0; color: #1e293b; font-size: 24px; font-weight: 700;">Modifier la facture</h3>
                                <p style="margin: 5px 0 0 0; color: #64748b; font-size: 14px;">N° ${invoice.id}</p>
                            </div>
                        </div>
                        <button onclick="closeEditModal()" style="
                            background: rgba(148, 163, 184, 0.1);
                            border: none;
                            width: 35px;
                            height: 35px;
                            border-radius: 10px;
                            cursor: pointer;
                            color: #64748b;
                            font-size: 18px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            transition: all 0.2s ease;
                        " onmouseover="this.style.background='rgba(148, 163, 184, 0.2)'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='rgba(148, 163, 184, 0.1)'; this.style.transform='scale(1)'">&times;</button>
                    </div>
                    <form id="edit-invoice-form" style="display: flex; flex-direction: column; gap: 25px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">👤 Client :</label>
                            <input type="text" id="edit-client-name" value="${invoice.client}" style="
                                width: 100%; 
                                padding: 12px 16px; 
                                border: 2px solid #e2e8f0; 
                                border-radius: 12px; 
                                font-size: 14px; 
                                color: #1e293b;
                                background: #ffffff;
                                transition: all 0.2s ease;
                                outline: none;
                            " placeholder="Nom du client" required 
                            onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'"
                            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">💶 Montant (€) :</label>
                            <input type="number" id="edit-amount" step="0.01" value="${invoice.amount}" style="
                                width: 100%; 
                                padding: 12px 16px; 
                                border: 2px solid #e2e8f0; 
                                border-radius: 12px; 
                                font-size: 14px; 
                                color: #1e293b;
                                background: #ffffff;
                                transition: all 0.2s ease;
                                outline: none;
                            " placeholder="0.00" required
                            onchange="calculateEditCommission()"
                            onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'"
                            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                        </div>
                        
                        <!-- Champs de commission dans le modal d'édition -->
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">💰 Commission :</label>
                            <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 8px;">
                                <div style="position: relative; width: 100px;">
                                    <input type="number" id="edit-commission-rate" value="${invoice.commissionRate || 15}" min="0" max="100" step="0.1" style="
                                        width: 100%; 
                                        padding: 12px 35px 12px 16px; 
                                        border: 2px solid #e2e8f0; 
                                        border-radius: 12px; 
                                        font-size: 14px; 
                                        color: #1e293b;
                                        background: #ffffff;
                                        text-align: center;
                                        transition: all 0.2s ease;
                                        outline: none;
                                    " onchange="calculateEditCommission()"
                                    onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'"
                                    onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                    <span style="
                                        position: absolute;
                                        right: 10px;
                                        top: 50%;
                                        transform: translateY(-50%);
                                        color: #9ca3af;
                                        font-weight: 600;
                                        font-size: 12px;
                                    ">%</span>
                                </div>
                                <span style="color: #9ca3af; font-weight: 600;">=</span>
                                <div style="position: relative; flex: 1;">
                                    <input type="number" id="edit-commission-amount" value="${invoice.commission || 0}" step="0.01" style="
                                        width: 100%; 
                                        padding: 12px 40px 12px 16px; 
                                        border: 2px solid #ec4899; 
                                        border-radius: 12px; 
                                        font-size: 14px; 
                                        color: #ec4899;
                                        background: rgba(236, 72, 153, 0.05);
                                        font-weight: 600;
                                        transition: all 0.2s ease;
                                        outline: none;
                                    " placeholder="0.00" 
                                    onchange="updateEditCommissionRate()"
                                    onfocus="this.style.borderColor='#ec4899'; this.style.boxShadow='0 0 0 3px rgba(236, 72, 153, 0.1)'"
                                    onblur="this.style.borderColor='#ec4899'; this.style.boxShadow='none'">
                                    <span style="
                                        position: absolute;
                                        right: 15px;
                                        top: 50%;
                                        transform: translateY(-50%);
                                        color: #ec4899;
                                        font-weight: 600;
                                        font-size: 12px;
                                    ">€</span>
                                </div>
                            </div>
                            <small style="color: #64748b; font-size: 12px;">
                                💡 Ajustez le pourcentage ou modifiez directement le montant
                            </small>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">📝 Description :</label>
                            <textarea id="edit-description" style="
                                width: 100%; 
                                padding: 12px 16px; 
                                border: 2px solid #e2e8f0; 
                                border-radius: 12px; 
                                resize: vertical; 
                                min-height: 100px; 
                                font-size: 14px; 
                                color: #1e293b;
                                background: #ffffff;
                                font-family: inherit;
                                transition: all 0.2s ease;
                                outline: none;
                            " placeholder="Description des services fournis" required
                            onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'"
                            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">${invoice.description}</textarea>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">📅 Date d'échéance :</label>
                            <input type="date" id="edit-due-date" value="${convertDateForInput(invoice.dueDate)}" style="
                                width: 100%; 
                                padding: 12px 16px; 
                                border: 2px solid #e2e8f0; 
                                border-radius: 12px; 
                                font-size: 14px; 
                                color: #1e293b;
                                background: #ffffff;
                                transition: all 0.2s ease;
                                outline: none;
                            " required
                            onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'"
                            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">🏷️ Statut :</label>
                            <select id="edit-status" style="
                                width: 100%; 
                                padding: 12px 16px; 
                                border: 2px solid #e2e8f0; 
                                border-radius: 12px; 
                                font-size: 14px; 
                                color: #1e293b;
                                background: #ffffff;
                                transition: all 0.2s ease;
                                outline: none;
                                cursor: pointer;
                            " required
                            onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'"
                            onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                <option value="En attente" ${invoice.status === 'En attente' ? 'selected' : ''}>⏳ En attente</option>
                                <option value="Payée" ${invoice.status === 'Payée' ? 'selected' : ''}>✅ Payée</option>
                                <option value="En retard" ${invoice.status === 'En retard' ? 'selected' : ''}>⚠️ En retard</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                            <button type="button" onclick="closeEditModal()" style="
                                padding: 12px 24px;
                                border: 2px solid #e2e8f0;
                                background: #ffffff;
                                color: #475569;
                                border-radius: 12px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 500;
                                transition: all 0.2s ease;
                                outline: none;
                            " onmouseover="this.style.background='#f8fafc'; this.style.borderColor='#cbd5e1'" 
                               onmouseout="this.style.background='#ffffff'; this.style.borderColor='#e2e8f0'">
                                Annuler
                            </button>
                            <button type="submit" style="
                                padding: 12px 24px;
                                border: none;
                                background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                                color: #ffffff;
                                border-radius: 12px;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: 600;
                                transition: all 0.2s ease;
                                outline: none;
                                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
                            " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(59, 130, 246, 0.3)'" 
                               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.2)'">
                                ✏️ Modifier la facture
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.classList.add('modal-open');
            
            // Fermeture en cliquant à l'extérieur
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeEditModal();
                }
            });
            
            // Fermeture avec la touche Échap
            const handleEscape = function(e) {
                if (e.key === 'Escape') {
                    closeEditModal();
                    document.removeEventListener('keydown', handleEscape);
                }
            };
            document.addEventListener('keydown', handleEscape);
            
            // Ajouter l'événement de soumission
            document.getElementById('edit-invoice-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveInvoiceChanges(invoice.id);
            });
            
            // Focus sur le premier champ
            setTimeout(() => {
                document.getElementById('edit-client-name').focus();
            }, 100);
        }
        
        // ========== FONCTIONS DE COMMISSION POUR LE MODAL D'ÉDITION ==========
        
        // Fonction pour calculer la commission dans le modal d'édition
        function calculateEditCommission() {
            const amountInput = document.getElementById('edit-amount');
            const rateInput = document.getElementById('edit-commission-rate');
            const commissionInput = document.getElementById('edit-commission-amount');
            
            if (!amountInput || !rateInput || !commissionInput) return;
            
            const amount = parseFloat(amountInput.value) || 0;
            const rate = parseFloat(rateInput.value) || 15;
            
            const commissionAmount = (amount * rate) / 100;
            commissionInput.value = commissionAmount.toFixed(2);
            
            // Animation visuelle
            commissionInput.style.transform = 'scale(1.05)';
            setTimeout(() => {
                commissionInput.style.transform = 'scale(1)';
            }, 200);
        }
        
        // Fonction pour mettre à jour le taux basé sur le montant de commission dans l'édition
        function updateEditCommissionRate() {
            const amountInput = document.getElementById('edit-amount');
            const rateInput = document.getElementById('edit-commission-rate');
            const commissionInput = document.getElementById('edit-commission-amount');
            
            if (!amountInput || !rateInput || !commissionInput) return;
            
            const amount = parseFloat(amountInput.value) || 0;
            const commissionAmount = parseFloat(commissionInput.value) || 0;
            
            if (amount > 0) {
                const newRate = (commissionAmount / amount) * 100;
                rateInput.value = Math.round(newRate * 10) / 10;
                
                // Animation visuelle
                rateInput.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    rateInput.style.transform = 'scale(1)';
                }, 200);
            }
        }
        
        // Fonction pour fermer le modal d'édition
        function closeEditModal() {
            const modal = document.getElementById('edit-invoice-modal');
            if (modal) {
                modal.style.opacity = '0';
                modal.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    modal.remove();
                    document.body.classList.remove('modal-open');
                }, 300);
            }
        }
        
        // Fonction pour convertir la date française en format input
        function convertDateForInput(frenchDate) {
            // Convertir "20/07/2025" en "2025-07-20"
            if (!frenchDate || !frenchDate.includes('/')) return '';
            const parts = frenchDate.split('/');
            if (parts.length !== 3) return '';
            return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
        }
        
        // Fonction pour convertir la date input en format français
        function convertDateToFrench(inputDate) {
            // Convertir "2025-07-20" en "20/07/2025"
            if (!inputDate) return '';
            const date = new Date(inputDate);
            return date.toLocaleDateString('fr-FR');
        }
        
        // Fonction pour sauvegarder les modifications de la facture
        function saveInvoiceChanges(invoiceId) {
            const clientName = document.getElementById('edit-client-name').value;
            const amount = document.getElementById('edit-amount').value;
            const commissionAmount = document.getElementById('edit-commission-amount').value;
            const commissionRate = document.getElementById('edit-commission-rate').value;
            const description = document.getElementById('edit-description').value;
            const dueDate = document.getElementById('edit-due-date').value;
            const status = document.getElementById('edit-status').value;
            
            let invoices = getInvoices();
            const invoiceIndex = invoices.findIndex(inv => inv.id === invoiceId);
            
            if (invoiceIndex === -1) {
                showNotification('❌ Erreur lors de la modification', 'error');
                return;
            }
            
            // Mettre à jour la facture
            const oldInvoice = { ...invoices[invoiceIndex] };
            invoices[invoiceIndex] = {
                ...invoices[invoiceIndex],
                client: clientName,
                amount: parseFloat(amount),
                commission: parseFloat(commissionAmount),
                commissionRate: parseFloat(commissionRate),
                description: description,
                dueDate: convertDateToFrench(dueDate),
                status: status,
                updatedAt: new Date().toISOString()
            };
            
            // Sauvegarder
            localStorage.setItem('invoices', JSON.stringify(invoices));
            
            console.log(`💰 Facture ${invoiceId} modifiée - Commission: ${commissionAmount}€ (${commissionRate}%)`);
            
            // Animation du bouton
            const submitBtn = document.querySelector('#edit-invoice-form button[type="submit"]');
            submitBtn.innerHTML = '<span style="display: inline-block; animation: spin 1s linear infinite;">⏳</span> Modification en cours...';
            submitBtn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
            
            setTimeout(() => {
                // Notification de succès
                showNotification(`✅ Facture ${invoiceId} modifiée avec succès !`, 'success');
                
                // Fermer le modal
                closeEditModal();
                
                // Actualiser l'affichage
                displayInvoices();
                
                // Mettre à jour les statistiques financières
                updateFinancialStats();
            }, 1000);
        }
        
        // Fonction pour mettre à jour le statut d'une facture
        function updateInvoiceStatus(invoiceId, newStatus) {
            let invoices = getInvoices();
            const invoiceIndex = invoices.findIndex(invoice => invoice.id === invoiceId);
            
            if (invoiceIndex === -1) {
                showNotification('❌ Facture non trouvée', 'error');
                return;
            }
            
            const oldStatus = invoices[invoiceIndex].status;
            
            // Ne rien faire si le statut n'a pas changé
            if (oldStatus === newStatus) {
                return;
            }
            
            invoices[invoiceIndex].status = newStatus;
            invoices[invoiceIndex].updatedAt = new Date().toISOString();
            
            // Sauvegarder les modifications
            localStorage.setItem('invoices', JSON.stringify(invoices));
            
            // Mettre à jour visuellement le dropdown sélectionné
            updateDropdownVisual(invoiceId, newStatus);
            
            // Déterminer l'icône et le message selon le statut
            const statusMessages = {
                'En attente': { icon: '⏳', message: 'Facture marquée en attente de paiement', color: 'warning' },
                'Payée': { icon: '✅', message: 'Facture marquée comme payée', color: 'success' },
                'En retard': { icon: '⚠️', message: 'Facture marquée en retard', color: 'error' }
            };
            
            const statusInfo = statusMessages[newStatus];
            
            // Notification avec animation
            showStatusChangeNotification(invoiceId, oldStatus, newStatus, statusInfo);
            
            // Mettre à jour les statistiques financières
            updateFinancialStats();
            
            console.log(`📊 Statut facture ${invoiceId}: ${oldStatus} → ${newStatus}`);
        }
        
        // Fonction pour mettre à jour visuellement le dropdown spécifique
        function updateDropdownVisual(invoiceId, newStatus) {
            // Trouver le dropdown spécifique
            const dropdowns = document.querySelectorAll('.status-dropdown');
            let targetDropdown = null;
            
            dropdowns.forEach(dropdown => {
                const onchangeAttr = dropdown.getAttribute('onchange');
                if (onchangeAttr && onchangeAttr.includes(invoiceId)) {
                    targetDropdown = dropdown;
                }
            });
            
            if (!targetDropdown) return;
            
            // Définir les nouveaux styles selon le statut
            const statusStyles = {
                'En attente': { 
                    color: '#f59e0b', 
                    bg: 'rgba(245, 158, 11, 0.1)', 
                    border: 'rgba(245, 158, 11, 0.2)'
                },
                'Payée': { 
                    color: '#22c55e', 
                    bg: 'rgba(34, 197, 94, 0.1)', 
                    border: 'rgba(34, 197, 94, 0.2)'
                },
                'En retard': { 
                    color: '#ef4444', 
                    bg: 'rgba(239, 68, 68, 0.1)', 
                    border: 'rgba(239, 68, 68, 0.2)'
                }
            };
            
            const newStyle = statusStyles[newStatus];
            
            // Appliquer les nouveaux styles au dropdown
            targetDropdown.style.background = newStyle.bg;
            targetDropdown.style.color = newStyle.color;
            targetDropdown.style.borderColor = newStyle.border;
            
            // S'assurer que la bonne option est sélectionnée
            targetDropdown.value = newStatus;
        }
        
        // Fonction pour afficher une notification de changement de statut
        function showStatusChangeNotification(invoiceId, oldStatus, newStatus, statusInfo) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #1f2937, #374151);
                color: white;
                padding: 20px 25px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 10000;
                font-family: inherit;
                animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                min-width: 300px;
                border-left: 4px solid ${statusInfo.color === 'success' ? '#22c55e' : statusInfo.color === 'warning' ? '#f59e0b' : '#ef4444'};
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="
                        width: 45px;
                        height: 45px;
                        background: ${statusInfo.color === 'success' ? 'rgba(34, 197, 94, 0.2)' : statusInfo.color === 'warning' ? 'rgba(245, 158, 11, 0.2)' : 'rgba(239, 68, 68, 0.2)'};
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 20px;
                    ">${statusInfo.icon}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 700; font-size: 15px; margin-bottom: 4px;">Statut mis à jour</div>
                        <div style="font-size: 13px; opacity: 0.9; line-height: 1.4;">
                            <strong>${invoiceId}</strong><br>
                            ${oldStatus} → <strong>${newStatus}</strong>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: rgba(255,255,255,0.1);
                        border: none;
                        color: white;
                        width: 25px;
                        height: 25px;
                        border-radius: 50%;
                        cursor: pointer;
                        font-size: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    ">&times;</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove après 4 secondes
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.transform = 'translateX(100%)';
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 4000);
        }
        
        // Fonction de notification générale (si elle n'existe pas)
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                'success': '#22c55e',
                'error': '#ef4444',
                'warning': '#f59e0b',
                'info': '#3b82f6'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                font-family: inherit;
                font-weight: 500;
                animation: slideInRight 0.3s ease-out;
                max-width: 350px;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Expose showNotification si elle n'existe pas
        if (!window.showNotification) {
            window.showNotification = showNotification;
        }
        
        // ========== FONCTIONS DE SYNCHRONISATION FINANCIÈRE ==========
        
        // Fonction pour calculer et mettre à jour les statistiques financières
        function updateFinancialStats() {
            const invoices = getInvoices();
            console.log('📊 Mise à jour des statistiques financières...', invoices);
            
            // Calculer les statistiques
            const stats = calculateFinancialStats(invoices);
            
            // Mettre à jour l'affichage
            updateFinancialDisplay(stats);
            
            console.log('✅ Statistiques financières mises à jour:', stats);
        }
        
        // Fonction pour calculer toutes les statistiques financières
        function calculateFinancialStats(invoices) {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Reset time for accurate date comparison
            
            const stats = {
                pendingInvoices: 0,
                monthlyRevenue: 0,
                overdueInvoices: 0,
                totalCommissions: 0,
                totalRevenue: 0,
                paidInvoices: 0
            };
            
            let hasUpdatedStatus = false;
            
            invoices.forEach((invoice, index) => {
                const amount = parseFloat(invoice.amount) || 0;
                const commission = parseFloat(invoice.commission) || 0;
                const invoiceDate = new Date(convertFrenchDateToISO(invoice.issueDate || invoice.dateEmission));
                const dueDate = new Date(convertFrenchDateToISO(invoice.dueDate || invoice.dateEcheance));
                
                // Calculs généraux
                stats.totalRevenue += amount;
                stats.totalCommissions += commission;
                
                // Vérifier automatiquement si une facture en attente est maintenant en retard
                if (invoice.status === 'En attente' && dueDate < today) {
                    invoice.status = 'En retard';
                    invoice.updatedAt = new Date().toISOString();
                    hasUpdatedStatus = true;
                    console.log(`🔄 Facture ${invoice.id} automatiquement marquée en retard`);
                }
                
                // Selon le statut
                switch (invoice.status) {
                    case 'En attente':
                        stats.pendingInvoices++;
                        break;
                    case 'Payée':
                        stats.paidInvoices++;
                        // Si payée ce mois
                        if (invoiceDate.getMonth() === currentMonth && invoiceDate.getFullYear() === currentYear) {
                            stats.monthlyRevenue += amount;
                        }
                        break;
                    case 'En retard':
                        stats.overdueInvoices++;
                        break;
                }
            });
            
            // Si des statuts ont été mis à jour, sauvegarder
            if (hasUpdatedStatus) {
                localStorage.setItem('invoices', JSON.stringify(invoices));
                // Re-afficher les factures pour refléter les changements
                setTimeout(() => displayInvoices(), 100);
            }
            
            return stats;
        }
        
        // Fonction utilitaire pour convertir une date française en format ISO
        function convertFrenchDateToISO(frenchDate) {
            if (!frenchDate) return new Date();
            
            // Si c'est déjà une date ISO, la retourner
            if (frenchDate.includes('-')) {
                return frenchDate;
            }
            
            // Convertir du format dd/mm/yyyy au format yyyy-mm-dd
            const parts = frenchDate.split('/');
            if (parts.length === 3) {
                return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
            }
            
            return new Date();
        }
        
        // Fonction pour mettre à jour l'affichage des statistiques
        function updateFinancialDisplay(stats) {
            // Formater les montants en euros
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR'
                }).format(amount);
            };
            
            // Mettre à jour les éléments HTML
            const pendingElement = document.getElementById('pending-invoices');
            const monthlyElement = document.getElementById('monthly-revenue');
            const overdueElement = document.getElementById('overdue-invoices');
            const commissionsElement = document.getElementById('total-commissions');
            
            if (pendingElement) {
                pendingElement.textContent = stats.pendingInvoices;
                pendingElement.style.color = stats.pendingInvoices > 0 ? '#f59e0b' : '#22c55e';
            }
            
            if (monthlyElement) {
                monthlyElement.textContent = formatCurrency(stats.monthlyRevenue);
                monthlyElement.style.color = stats.monthlyRevenue > 0 ? '#22c55e' : '#6b7280';
            }
            
            if (overdueElement) {
                overdueElement.textContent = stats.overdueInvoices;
                overdueElement.style.color = stats.overdueInvoices > 0 ? '#ef4444' : '#22c55e';
            }
            
            if (commissionsElement) {
                commissionsElement.textContent = formatCurrency(stats.totalCommissions);
                commissionsElement.style.color = stats.totalCommissions > 0 ? '#ec4899' : '#6b7280';
            }
            
            // Animation de mise à jour
            [pendingElement, monthlyElement, overdueElement, commissionsElement].forEach(element => {
                if (element) {
                    element.style.transform = 'scale(1.1)';
                    element.style.transition = 'all 0.3s ease';
                    element.style.background = 'rgba(180, 138, 255, 0.1)';
                    element.style.borderRadius = '8px';
                    element.style.padding = '4px 8px';
                    setTimeout(() => {
                        element.style.transform = 'scale(1)';
                        element.style.background = 'transparent';
                    }, 300);
                }
            });
            
            // Ajouter un indicateur temporaire de mise à jour
            const updateIndicator = document.createElement('div');
            updateIndicator.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: rgba(180, 138, 255, 0.9);
                color: white;
                padding: 8px 15px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                z-index: 1000;
                animation: fadeIn 0.3s ease-in-out;
            `;
            updateIndicator.textContent = '📊 Statistiques mises à jour';
            
            document.body.appendChild(updateIndicator);
            setTimeout(() => {
                updateIndicator.style.opacity = '0';
                setTimeout(() => updateIndicator.remove(), 300);
            }, 2000);
        }
        
        // Fonction pour initialiser les statistiques au chargement
        function initializeFinancialStats() {
            // Attendre que le DOM soit complètement chargé
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    setTimeout(updateFinancialStats, 100);
                });
            } else {
                setTimeout(updateFinancialStats, 100);
            }
            
            // Vérifier les factures en retard toutes les heures
            setInterval(() => {
                console.log('🕐 Vérification automatique des factures en retard...');
                updateFinancialStats();
            }, 60 * 60 * 1000); // 1 heure
        }
        
        // Fonction pour forcer une mise à jour complète (utile pour le debugging)
        function refreshFinancialDashboard() {
            console.log('🔄 Actualisation forcée du dashboard financier...');
            updateFinancialStats();
            displayInvoices();
            showNotification('✅ Dashboard financier actualisé', 'success');
        }
        
        // ========== FONCTIONS DE GESTION DES MODÈLES DE COMMISSION ==========
        
        // Fonction pour mettre à jour l'affichage d'un modèle de commission
        function updateCommissionModel(modelNumber, percentage) {
            const valueElement = document.getElementById(`commission-value${modelNumber}`);
            const earningsElement = document.getElementById(`model${modelNumber}-earnings`);
            const commissionElement = document.getElementById(`model${modelNumber}-commission`);
            
            if (valueElement) {
                valueElement.textContent = percentage + '%';
            }
            
            // Calculer les montants basés sur 1000€ de revenus bruts
            const baseAmount = 1000;
            const commissionAmount = (baseAmount * percentage / 100);
            const modelEarnings = baseAmount - commissionAmount;
            
            if (earningsElement) {
                earningsElement.textContent = modelEarnings.toFixed(0) + '€';
            }
            
            if (commissionElement) {
                commissionElement.textContent = commissionAmount.toFixed(0) + '€';
            }
        }
        
        // Fonction pour sauvegarder la configuration d'un modèle
        function saveCommissionModel(modelNumber, percentage) {
            const commissionSettings = getCommissionSettings();
            commissionSettings[`model${modelNumber}`] = {
                percentage: parseInt(percentage),
                name: getModelName(modelNumber),
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('commissionSettings', JSON.stringify(commissionSettings));
            console.log(`💾 Modèle ${modelNumber} sauvegardé: ${percentage}%`);
            
            // Mettre à jour l'affichage des informations
            updateCommissionInfo();
        }
        
        // Fonction pour appliquer un modèle de commission
        function applyCommissionModel(modelNumber) {
            const commissionSettings = getCommissionSettings();
            const modelSettings = commissionSettings[`model${modelNumber}`];
            
            if (!modelSettings) {
                showNotification('⚠️ Erreur: Modèle non trouvé', 'error');
                return;
            }
            
            // Mettre à jour le modèle actif
            commissionSettings.activeModel = modelNumber;
            commissionSettings.activePercentage = modelSettings.percentage;
            commissionSettings.lastApplied = new Date().toISOString();
            
            localStorage.setItem('commissionSettings', JSON.stringify(commissionSettings));
            
            // Mettre à jour l'affichage
            updateCommissionInfo();
            updateCommissionCards();
            
            // Recalculer les statistiques financières
            updateFinancialStats();
            
            showNotification(`✅ ${getModelName(modelNumber)} appliqué (${modelSettings.percentage}%)`, 'success');
            
            console.log(`🎯 Modèle ${modelNumber} appliqué: ${modelSettings.percentage}%`);
        }
        
        // Fonction pour obtenir les paramètres de commission
        function getCommissionSettings() {
            const defaultSettings = {
                model1: { percentage: 25, name: 'Creator Boost', lastUpdated: null },
                model2: { percentage: 30, name: 'Influencer Pro', lastUpdated: null },
                model3: { percentage: 35, name: 'Elite Partnership', lastUpdated: null },
                activeModel: 1,
                activePercentage: 25,
                lastApplied: null
            };
            
            const saved = localStorage.getItem('commissionSettings');
            return saved ? { ...defaultSettings, ...JSON.parse(saved) } : defaultSettings;
        }
        
        // Fonction pour obtenir le nom d'un modèle
        function getModelName(modelNumber) {
            const names = {
                1: 'Creator Boost',
                2: 'Influencer Pro',
                3: 'Elite Partnership'
            };
            return names[modelNumber] || 'Modèle Inconnu';
        }
        
        // Fonction pour mettre à jour les informations de configuration
        function updateCommissionInfo() {
            const settings = getCommissionSettings();
            const activeModelElement = document.getElementById('active-commission-model');
            const lastUpdateElement = document.getElementById('last-commission-update');
            const affectedInvoicesElement = document.getElementById('affected-invoices-count');
            
            if (activeModelElement) {
                activeModelElement.textContent = `${getModelName(settings.activeModel)} (${settings.activePercentage}%)`;
            }
            
            if (lastUpdateElement) {
                const lastUpdate = settings.lastApplied ? 
                    new Date(settings.lastApplied).toLocaleDateString('fr-FR') : 
                    'Jamais';
                lastUpdateElement.textContent = lastUpdate;
            }
            
            if (affectedInvoicesElement) {
                const invoices = getInvoices();
                const affectedCount = invoices.length;
                affectedInvoicesElement.textContent = affectedCount;
            }
        }
        
        // Fonction pour mettre à jour l'apparence des cartes
        function updateCommissionCards() {
            const settings = getCommissionSettings();
            
            // Réinitialiser toutes les cartes
            for (let i = 1; i <= 3; i++) {
                const card = document.querySelector(`.commission-model-card:nth-child(${i})`);
                if (card) {
                    const badge = card.querySelector('div[style*="ACTIF"], div[style*="DISPONIBLE"], div[style*="EXCLUSIF"]');
                    if (badge) {
                        if (i === settings.activeModel) {
                            badge.textContent = 'ACTIF';
                            badge.style.background = 'rgba(34,197,94,0.2)';
                            badge.style.color = '#22c55e';
                        } else {
                            const originalTexts = ['DISPONIBLE', 'DISPONIBLE', 'EXCLUSIF'];
                            badge.textContent = originalTexts[i-1];
                            
                            if (i === 1) {
                                badge.style.background = 'rgba(34,197,94,0.2)';
                                badge.style.color = '#22c55e';
                            } else if (i === 2) {
                                badge.style.background = 'rgba(59,130,246,0.2)';
                                badge.style.color = '#3b82f6';
                            } else {
                                badge.style.background = 'rgba(236,72,153,0.2)';
                                badge.style.color = '#ec4899';
                            }
                        }
                    }
                }
            }
        }
        
        // Fonction pour réinitialiser les modèles
        function resetCommissionModels() {
            if (confirm('Êtes-vous sûr de vouloir réinitialiser tous les modèles de commission ?')) {
                localStorage.removeItem('commissionSettings');
                
                // Réinitialiser les sliders et affichages
                document.getElementById('commission-model1').value = 25;
                document.getElementById('commission-model2').value = 30;
                document.getElementById('commission-model3').value = 35;
                
                updateCommissionModel(1, 25);
                updateCommissionModel(2, 30);
                updateCommissionModel(3, 35);
                
                updateCommissionInfo();
                updateCommissionCards();
                
                showNotification('✅ Modèles de commission réinitialisés', 'success');
                console.log('🔄 Modèles de commission réinitialisés');
            }
        }
        
        // Fonction pour exporter les paramètres
        function exportCommissionSettings() {
            const settings = getCommissionSettings();
            const dataStr = JSON.stringify(settings, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `commission-settings-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('✅ Paramètres exportés', 'success');
            console.log('📁 Paramètres de commission exportés');
        }
        
        // Fonction pour initialiser les modèles de commission
        function initializeCommissionModels() {
            const settings = getCommissionSettings();
            
            // Mettre à jour les sliders avec les valeurs sauvegardées
            document.getElementById('commission-model1').value = settings.model1.percentage;
            document.getElementById('commission-model2').value = settings.model2.percentage;
            document.getElementById('commission-model3').value = settings.model3.percentage;
            
            // Mettre à jour l'affichage
            updateCommissionModel(1, settings.model1.percentage);
            updateCommissionModel(2, settings.model2.percentage);
            updateCommissionModel(3, settings.model3.percentage);
            
            updateCommissionInfo();
            updateCommissionCards();
            
            console.log('💳 Modèles de commission initialisés');

            // Charger et afficher les modèles sauvegardés
            loadModelsFromStorage();
        }

        // ========== NOUVELLES FONCTIONS POUR LA GESTION DES MODÈLES ========== //

        // Charger les modèles depuis le localStorage
        function loadModelsFromStorage() {
            console.log('🔄 Chargement des modèles depuis localStorage...');
            
            try {
                const savedModels = JSON.parse(localStorage.getItem('models') || '[]');
                console.log('📊 Modèles trouvés:', savedModels.length);
                
                // Afficher les modèles
                try {
                    displayModels(savedModels);
                    console.log('✅ Modèles affichés');
                } catch (displayError) {
                    console.error('❌ Erreur affichage modèles:', displayError);
                }
                
                // Mettre à jour le compteur (si l'élément existe)
                try {
                    const countElement = document.getElementById('models-count');
                    if (countElement) {
                        countElement.textContent = `${savedModels.length} modèle(s)`;
                        console.log('✅ Compteur mis à jour');
                    } else {
                        console.log('ℹ️ Élément models-count non trouvé (normal si pas affiché)');
                    }
                } catch (countError) {
                    console.error('❌ Erreur compteur:', countError);
                }
                
                // Mettre à jour les statistiques
                try {
                    updateGlobalStats(savedModels);
                    updateHeaderStats(savedModels);
                    updateFinancialStats(); // Nouvelle fonction pour les indicateurs financiers
                    console.log('✅ Statistiques mises à jour');
                } catch (statsError) {
                    console.error('❌ Erreur statistiques:', statsError);
                }
                
                // Gérer l'affichage des modèles
                try {
                    const modelsList = document.getElementById('models-list');
                    const quickAddSection = document.getElementById('quick-add-section');
                    const headerMainButton = document.querySelector('#financial-commissions button[onclick="openAddModelModal()"]');
                    
                    if (savedModels.length === 0) {
                        if (modelsList) modelsList.style.display = 'none';
                        if (quickAddSection) quickAddSection.style.display = 'none';
                        if (headerMainButton) {
                            headerMainButton.innerHTML = '<i class="fas fa-plus-circle"></i> Ajouter votre premier modèle';
                        }
                    } else {
                        if (modelsList) modelsList.style.display = 'grid';
                        if (quickAddSection) quickAddSection.style.display = 'block';
                        if (headerMainButton) {
                            headerMainButton.innerHTML = '<i class="fas fa-plus-circle"></i> Ajouter un nouveau modèle';
                        }
                    }
                    console.log('✅ États d\'interface mis à jour');
                } catch (stateError) {
                    console.error('❌ Erreur gestion états:', stateError);
                    console.log('ℹ️ Certains éléments d\'interface manquent (peut être normal)');
                }
                
                console.log('🎉 Chargement des modèles terminé avec succès');
                return true;
                
            } catch (error) {
                console.error('💥 Erreur critique lors du chargement des modèles:', error);
                console.error('Stack trace:', error.stack);
                return false;
            }
        }

        // Mettre à jour les statistiques dans le header
        function updateHeaderStats(models) {
            console.log('📊 Mise à jour statistiques header');
            
            try {
                // Calculer les vraies statistiques basées sur les modèles individuels
                let activeModelsCount = 0;
                let totalRevenue = 0;
                let totalCommission = 0;
                let modelsWithRevenue = 0;
                
                models.forEach(model => {
                    // Compter les modèles avec des revenus estimés
                    if (model.estimatedRevenue && model.estimatedRevenue > 0) {
                        activeModelsCount++;
                        totalRevenue += parseFloat(model.estimatedRevenue);
                        totalCommission += parseFloat(model.commission) || 0;
                        modelsWithRevenue++;
                    }
                });
                
                // Commission moyenne (uniquement des modèles avec revenus)
                const avgCommission = modelsWithRevenue > 0 ? 
                    (totalCommission / modelsWithRevenue).toFixed(1) : 
                    (models.length > 0 ? (models.reduce((sum, m) => sum + (parseFloat(m.commission) || 0), 0) / models.length).toFixed(1) : 0);
                
                // Mettre à jour les éléments du header
                const activeCountHeader = document.getElementById('active-models-count-header');
                const avgCommissionHeader = document.getElementById('average-commission-header');
                const estimatedRevenueHeader = document.getElementById('estimated-revenue-header');

                if (activeCountHeader) {
                    activeCountHeader.textContent = activeModelsCount;
                    console.log('✅ Active count header mis à jour:', activeModelsCount);
                } else {
                    console.log('ℹ️ Active count header non trouvé');
                }
                
                if (avgCommissionHeader) {
                    avgCommissionHeader.textContent = avgCommission + '%';
                    console.log('✅ Average commission header mis à jour:', avgCommission + '%');
                } else {
                    console.log('ℹ️ Average commission header non trouvé');
                }
                
                if (estimatedRevenueHeader) {
                    // Préserver l'icône d'information
                    estimatedRevenueHeader.innerHTML = `${totalRevenue.toFixed(0)}€<i class="fas fa-info-circle" style="font-size: 0.5em; position: absolute; top: -5px; right: -15px; color: rgba(59,130,246,0.6);"></i>`;
                    console.log('✅ Estimated revenue header mis à jour:', totalRevenue.toFixed(0) + '€');
                } else {
                    console.log('ℹ️ Estimated revenue header non trouvé');
                }
                
            } catch (error) {
                console.error('❌ Erreur dans updateHeaderStats:', error);
            }
        }

        // Afficher les modèles dans l'interface
        // Fonction pour attacher les gestionnaires d'événements aux boutons de revenus
        function attachRevenueEventListeners() {
            console.log('🔗 Attachement des gestionnaires d\'événements pour les revenus...');
            
            const container = document.getElementById('models-list');
            if (!container) {
                console.error('❌ Container models-list introuvable');
                return;
            }
            
            // Utiliser la délégation d'événements
            if (!container.hasAttribute('data-revenue-events-attached')) {
                container.addEventListener('click', function(e) {
                    const revenueButton = e.target.closest('.edit-revenue-btn');
                    if (revenueButton) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const modelIndex = parseInt(revenueButton.getAttribute('data-model-index'));
                        console.log('🔘 Clic sur bouton revenus pour modèle:', modelIndex);
                        editModelRevenue(modelIndex);
                    }
                });
                container.setAttribute('data-revenue-events-attached', 'true');
                console.log('✅ Délégation d\'événements attachée au container');
            }
        }

        function displayModels(models) {
            console.log('🖼️ Affichage des modèles:', models.length);
            
            try {
                const container = document.getElementById('models-list');
                
                if (!container) {
                    console.error('❌ Container models-list non trouvé');
                    return false;
                }
                
                console.log('✅ Container trouvé');
                container.innerHTML = '';

                if (models.length === 0) {
                    console.log('ℹ️ Aucun modèle à afficher');
                    return true;
                }

                models.forEach((model, index) => {
                    try {
                        const modelCard = createModelCard(model, index);
                        container.appendChild(modelCard);
                        console.log(`✅ Modèle ${index + 1} ajouté: ${model.name}`);
                    } catch (cardError) {
                        console.error(`❌ Erreur création carte modèle ${index}:`, cardError);
                    }
                });
                
                // Attacher les gestionnaires d'événements
                attachRevenueEventListeners();
                
                console.log('🎉 Affichage des modèles terminé');
                return true;
                
            } catch (error) {
                console.error('💥 Erreur critique dans displayModels:', error);
                return false;
            }
        }

        // Créer une carte de modèle
        function createModelCard(model, index) {
            const div = document.createElement('div');
            div.className = 'model-card';
            
            const statusColors = {
                'Actif': { bg: 'rgba(34,197,94,0.1)', border: 'rgba(34,197,94,0.3)', color: '#22c55e', status: '🟢 ACTIF' },
                'Inactif': { bg: 'rgba(107,114,128,0.1)', border: 'rgba(107,114,128,0.3)', color: '#6b7280', status: '⚫ INACTIF' },
                'En attente': { bg: 'rgba(245,158,11,0.1)', border: 'rgba(245,158,11,0.3)', color: '#f59e0b', status: '🟡 EN ATTENTE' }
            };
            
            const statusStyle = statusColors[model.status] || statusColors['En attente'];
            
            div.style.cssText = `
                background: linear-gradient(135deg, ${statusStyle.bg}, ${statusStyle.bg});
                border: 2px solid ${statusStyle.border};
                border-radius: 15px;
                padding: 20px;
                transition: all 0.3s ease;
            `;
            
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: ${statusStyle.color}; margin: 0; font-size: 1.1em; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-user"></i> ${model.name}
                    </h4>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <div style="background: ${statusStyle.bg}; color: ${statusStyle.color}; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 600;">
                            ${statusStyle.status}
                        </div>
                        <button onclick="deleteModel(${index})" style="
                            background: rgba(239,68,68,0.1);
                            border: 1px solid rgba(239,68,68,0.3);
                            border-radius: 6px;
                            color: #ef4444;
                            padding: 4px 8px;
                            cursor: pointer;
                            font-size: 0.8em;
                        " title="Supprimer">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                ${model.username ? `<div style="color: rgba(245,245,250,0.7); font-size: 0.9em; margin-bottom: 15px;">
                    <i class="fas fa-at" style="color: #b48aff;"></i> ${model.username}
                </div>` : ''}
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #f5f5fa; margin-bottom: 8px; font-weight: 600;">
                        Commission : ${model.commission}%
                    </label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="range" 
                               id="model-commission-${index}" 
                               min="5" max="50" 
                               value="${model.commission}" 
                               style="flex: 1; height: 6px; background: ${statusStyle.bg}; border-radius: 3px; outline: none;"
                               oninput="updateModelCommission(${index}, this.value)"
                               onchange="saveModelCommission(${index}, this.value)">
                        <span id="model-commission-display-${index}" style="color: ${statusStyle.color}; font-weight: bold; font-size: 1.2em; min-width: 45px;">${model.commission}%</span>
                    </div>
                </div>
                
                <div style="background: ${statusStyle.bg}; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: rgba(245,245,250,0.8);">Revenus estimés mensuels:</span>
                        <span style="color: #3b82f6; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 5px;" data-model-index="${index}" class="edit-revenue-btn" title="Cliquer pour modifier">
                            <span id="model-revenue-${index}">${model.estimatedRevenue || 0}€</span>
                            <i class="fas fa-edit" style="font-size: 0.7em; opacity: 0.7;"></i>
                        </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: rgba(245,245,250,0.8);">Commission agence (${model.commission}%):</span>
                        <span style="color: #f59e0b; font-weight: 600;" id="model-commission-amount-${index}">${((model.estimatedRevenue || 0) * model.commission / 100).toFixed(0)}€</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: rgba(245,245,250,0.8);">Revenus nets modèle:</span>
                        <span style="color: ${statusStyle.color}; font-weight: 600;" id="model-earnings-${index}">${((model.estimatedRevenue || 0) * (100 - model.commission) / 100).toFixed(0)}€</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button onclick="toggleModelStatus(${index})" style="
                        flex: 1;
                        background: ${model.status === 'Actif' ? 'rgba(239,68,68,0.1)' : 'linear-gradient(135deg, #22c55e, #16a34a)'};
                        border: ${model.status === 'Actif' ? '1px solid rgba(239,68,68,0.3)' : 'none'};
                        border-radius: 8px;
                        padding: 8px;
                        color: ${model.status === 'Actif' ? '#ef4444' : 'white'};
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 0.8em;
                    ">
                        <i class="fas fa-${model.status === 'Actif' ? 'pause' : 'play'}"></i> ${model.status === 'Actif' ? 'Désactiver' : 'Activer'}
                    </button>
                    <button onclick="editModel(${index})" style="
                        flex: 1;
                        background: rgba(59,130,246,0.1);
                        border: 1px solid rgba(59,130,246,0.3);
                        border-radius: 8px;
                        padding: 8px;
                        color: #3b82f6;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        font-size: 0.8em;
                    ">
                        <i class="fas fa-edit"></i> Modifier
                    </button>
                </div>
            `;
            
            return div;
        }

        // Ouvrir le modal d'ajout de modèle
        function openAddModelModal() {
            console.log('🚀 Ouverture du modal d\'ajout de modèle...');
            
            // Debug des éléments
            const debug = debugModels();
            
            const modal = document.getElementById('add-model-modal');
            // Correction du sélecteur - financial-commissions EST déjà l'élément avec la classe financial-tab-content
            const headerSection = document.querySelector('#financial-commissions');
            
            console.log('🔍 Éléments trouvés:', debug);
            console.log('  - Modal trouvé:', !!modal);
            console.log('  - Header Section trouvée:', !!headerSection);
            
            if (!modal) {
                console.error('❌ ERREUR: Modal add-model-modal introuvable !');
                console.log('🔍 Éléments disponibles avec "modal" dans l\'ID:');
                document.querySelectorAll('[id*="modal"]').forEach(el => {
                    console.log('  -', el.id, el.tagName);
                });
                return;
            }
            
            if (!headerSection) {
                console.error('❌ ERREUR: Section financial-commissions introuvable !');
                console.log('🔍 Toutes les sections trouvées:');
                document.querySelectorAll('div[id]').forEach(el => {
                    console.log('  -', el.id);
                });
                return;
            }
            
            console.log('✅ Tous les éléments nécessaires trouvés');
            
            // Agrandir la section header pour faire de la place
            headerSection.style.minHeight = '100vh';
            headerSection.style.display = 'flex';
            headerSection.style.flexDirection = 'column';
            headerSection.style.justifyContent = 'center';
            headerSection.style.alignItems = 'center';
            headerSection.style.position = 'relative';
            headerSection.style.transition = 'all 0.3s ease';
            
            // Afficher le modal
            modal.style.display = 'block';
            
            console.log('✅ Modal affiché, display:', modal.style.display);
            
            // Réinitialiser le formulaire
            const form = document.getElementById('add-model-form');
            if (form) {
                form.reset();
                console.log('✅ Formulaire réinitialisé');
            } else {
                console.warn('⚠️ Formulaire add-model-form introuvable');
            }
            
            // Réinitialiser les valeurs d'aperçu
            const preview = document.getElementById('commission-preview');
            if (preview) {
                preview.textContent = '25%';
                console.log('✅ Aperçu commission réinitialisé');
            } else {
                console.warn('⚠️ Element commission-preview introuvable');
            }
            
            updateCommissionPreview(25);
            
            console.log('🎉 Modal d\'ajout ouvert avec succès !');
        }

        // Fermer le modal d'ajout de modèle
        function closeAddModelModal() {
            const modal = document.getElementById('add-model-modal');
            const headerSection = document.querySelector('#financial-commissions');
            
            if (modal) {
                modal.style.display = 'none';
            }
            
            // Restaurer la taille normale de la section header
            if (headerSection) {
                headerSection.style.minHeight = 'auto';
                headerSection.style.display = 'block';
                headerSection.style.flexDirection = 'column';
                headerSection.style.justifyContent = 'flex-start';
                headerSection.style.alignItems = 'stretch';
                headerSection.style.position = 'static';
            }
        }

        // Mettre à jour l'aperçu de la commission dans le modal
        function updateCommissionPreview(value) {
            const preview = document.getElementById('commission-preview');
            const modelPreview = document.getElementById('model-earnings-preview');
            const agencyPreview = document.getElementById('agency-earnings-preview');
            
            if (preview) preview.textContent = value + '%';
            
            const modelEarnings = (1000 * (100 - value) / 100).toFixed(0);
            const agencyEarnings = (1000 * value / 100).toFixed(0);
            
            if (modelPreview) modelPreview.textContent = modelEarnings + '€';
            if (agencyPreview) agencyPreview.textContent = agencyEarnings + '€';
        }

        // Fonction de debug pour vérifier les éléments du modal
        function debugModels() {
            console.log('🔍 Debug des éléments du modal...');
            
            const modal = document.getElementById('add-model-modal');
            const headerSection = document.querySelector('#financial-commissions');
            const form = document.getElementById('add-model-form');
            const nameInput = document.getElementById('model-name');
            const usernameInput = document.getElementById('model-username');
            const commissionInput = document.getElementById('model-commission');
            
            console.log('Modal trouvé:', !!modal);
            console.log('Header section trouvée:', !!headerSection);
            console.log('Form trouvé:', !!form);
            console.log('Name input trouvé:', !!nameInput);
            console.log('Username input trouvé:', !!usernameInput);
            console.log('Commission input trouvé:', !!commissionInput);
            
            if (modal) {
                console.log('Modal display:', modal.style.display);
                console.log('Modal visible:', modal.offsetHeight > 0);
            }
            
            return {
                modal: !!modal,
                headerSection: !!headerSection,
                form: !!form,
                allInputs: !!nameInput && !!usernameInput && !!commissionInput
            };
        }

        // Soumettre le formulaire d'ajout de modèle
        function submitAddModelForm(event) {
            console.log('🚀 submitAddModelForm appelée');
            
            if (event) {
                event.preventDefault();
                console.log('✅ preventDefault appelé');
            }
            
            try {
                // Vérifications approfondies des éléments
                console.log('🔍 Recherche des éléments du formulaire...');
                
                const modal = document.getElementById('add-model-modal');
                const form = document.getElementById('add-model-form');
                const nameInput = document.getElementById('model-name');
                const usernameInput = document.getElementById('model-username');
                const commissionInput = document.getElementById('model-commission');
                
                console.log('Modal trouvé:', !!modal);
                console.log('Form trouvé:', !!form);
                console.log('Name input trouvé:', !!nameInput);
                console.log('Username input trouvé:', !!usernameInput);
                console.log('Commission input trouvé:', !!commissionInput);
                
                if (!nameInput) {
                    console.error('❌ Input nom manquant');
                    alert('Erreur: champ nom manquant. Réessayez en ouvrant le modal.');
                    return false;
                }
                
                if (!commissionInput) {
                    console.error('❌ Input commission manquant');
                    alert('Erreur: champ commission manquant. Réessayez en ouvrant le modal.');
                    return false;
                }
                
                // Récupération des valeurs avec validation
                const nameValue = nameInput.value ? nameInput.value.trim() : '';
                const usernameValue = usernameInput ? usernameInput.value.trim() : '';
                const commissionValue = commissionInput.value ? parseInt(commissionInput.value) : 25;
                
                console.log('Valeurs récupérées:');
                console.log('- Nom:', nameValue);
                console.log('- Username:', usernameValue);
                console.log('- Commission:', commissionValue);
                
                if (!nameValue || nameValue.length < 2) {
                    console.warn('⚠️ Nom invalide');
                    nameInput.focus();
                    alert('Veuillez saisir un nom valide (minimum 2 caractères)');
                    return false;
                }
                
                if (isNaN(commissionValue) || commissionValue < 5 || commissionValue > 50) {
                    console.warn('⚠️ Commission invalide');
                    alert('Commission invalide. Doit être entre 5% et 50%.');
                    return false;
                }
                
                const newModel = {
                    id: Date.now(),
                    name: nameValue,
                    username: usernameValue,
                    commission: commissionValue,
                    status: 'Actif',
                    createdAt: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                };

                console.log('💾 Nouveau modèle créé:', newModel);

                // Test de sauvegarde localStorage
                try {
                    const savedModels = JSON.parse(localStorage.getItem('models') || '[]');
                    console.log('📂 Modèles existants:', savedModels.length);
                    
                    savedModels.push(newModel);
                    localStorage.setItem('models', JSON.stringify(savedModels));
                    console.log('✅ Modèle sauvegardé dans localStorage');
                    
                    // Vérification de la sauvegarde
                    const verification = JSON.parse(localStorage.getItem('models') || '[]');
                    console.log('🔍 Vérification: nombre total de modèles:', verification.length);
                    
                } catch (storageError) {
                    console.error('❌ Erreur localStorage:', storageError);
                    alert('Erreur de sauvegarde. Vérifiez que le localStorage est disponible.');
                    return false;
                }

                // Test de rafraîchissement de l'affichage
                try {
                    console.log('🔄 Rafraîchissement de l\'affichage...');
                    loadModelsFromStorage();
                    console.log('✅ Affichage rafraîchi');
                } catch (displayError) {
                    console.error('❌ Erreur affichage:', displayError);
                    alert('Modèle ajouté mais erreur d\'affichage. Rechargez la page.');
                }
                
                // Fermer le modal
                try {
                    console.log('🚪 Fermeture du modal...');
                    closeAddModelModal();
                    console.log('✅ Modal fermé');
                } catch (modalError) {
                    console.error('❌ Erreur fermeture modal:', modalError);
                }

                // Notification de succès
                try {
                    showNotification(`✅ Modèle "${newModel.name}" ajouté avec succès !`, 'success');
                    console.log('✅ Notification affichée');
                } catch (notifError) {
                    console.error('❌ Erreur notification:', notifError);
                }
                
                console.log('🎉 Ajout de modèle terminé avec succès');
                return true;
                
            } catch (error) {
                console.error('💥 Erreur critique lors de l\'ajout du modèle:', error);
                console.error('Stack trace:', error.stack);
                alert(`Erreur technique: ${error.message}\nConsultez la console pour plus de détails.`);
                return false;
            }
        }

        // Mettre à jour la commission d'un modèle
        function updateModelCommission(index, value) {
            document.getElementById(`model-commission-display-${index}`).textContent = value + '%';
            
            // Récupérer les revenus estimés du modèle
            const models = JSON.parse(localStorage.getItem('models') || '[]');
            const estimatedRevenue = models[index] ? (models[index].estimatedRevenue || 0) : 0;
            
            // Mettre à jour les calculs basés sur les revenus estimés
            const agencyCommission = (estimatedRevenue * value / 100).toFixed(0);
            const modelEarnings = (estimatedRevenue * (100 - value) / 100).toFixed(0);
            
            document.getElementById(`model-earnings-${index}`).textContent = modelEarnings + '€';
            document.getElementById(`model-commission-amount-${index}`).textContent = agencyCommission + '€';
            
            // Mettre à jour temporairement les modèles pour le calcul des stats
            const tempModels = [...models];
            if (tempModels[index]) {
                tempModels[index].commission = parseInt(value);
                
                // Mettre à jour les statistiques du header en temps réel
                updateHeaderStats(tempModels);
                updateFinancialStats();
            }
        }

        // Sauvegarder la commission d'un modèle
        function saveModelCommission(index, value) {
            const savedModels = JSON.parse(localStorage.getItem('models') || '[]');
            if (savedModels[index]) {
                savedModels[index].commission = parseInt(value);
                savedModels[index].lastModified = new Date().toISOString();
                localStorage.setItem('models', JSON.stringify(savedModels));
                
                // Mettre à jour toutes les statistiques
                updateGlobalStats();
                updateHeaderStats(savedModels);
                updateFinancialStats();
                
                showNotification(`💰 Commission de ${savedModels[index].name} mise à jour : ${value}%`, 'info');
            }
        }

        // Basculer le statut d'un modèle
        function toggleModelStatus(index) {
            const savedModels = JSON.parse(localStorage.getItem('models') || '[]');
            if (savedModels[index]) {
                savedModels[index].status = savedModels[index].status === 'Actif' ? 'Inactif' : 'Actif';
                savedModels[index].lastModified = new Date().toISOString();
                localStorage.setItem('models', JSON.stringify(savedModels));
                
                // Recharger tout l'affichage pour mettre à jour toutes les statistiques
                loadModelsFromStorage();
                
                showNotification(`${savedModels[index].status === 'Actif' ? '✅' : '⏸️'} ${savedModels[index].name} ${savedModels[index].status === 'Actif' ? 'activé' : 'désactivé'}`, 'info');
            }
        }

        // Supprimer un modèle
        function deleteModel(index) {
            const savedModels = JSON.parse(localStorage.getItem('models') || '[]');
            if (savedModels[index]) {
                const modelName = savedModels[index].name;
                if (confirm(`Êtes-vous sûr de vouloir supprimer le modèle "${modelName}" ?\n\nCette action est irréversible.`)) {
                    savedModels.splice(index, 1);
                    localStorage.setItem('models', JSON.stringify(savedModels));
                    
                    loadModelsFromStorage();
                    showNotification(`🗑️ Modèle "${modelName}" supprimé`, 'warning');
                }
            }
        }

        // Modifier un modèle (fonction à implémenter)
        function editModel(index) {
            showNotification('🚧 Fonction de modification en cours de développement', 'info');
        }

        // Mettre à jour le compteur de modèles
        function updateModelsCount(count) {
            try {
                const countElement = document.getElementById('models-count');
                if (countElement) {
                    countElement.textContent = `${count} modèle(s)`;
                    console.log('✅ Compteur modèles mis à jour:', count);
                } else {
                    console.log('ℹ️ Élément models-count non trouvé (normal si pas affiché)');
                }
            } catch (error) {
                console.error('❌ Erreur mise à jour compteur:', error);
            }
        }

        // Mettre à jour les statistiques globales
        function updateGlobalStats(models) {
            console.log('📊 Mise à jour statistiques globales');
            
            try {
                const activeModels = models.filter(m => m.status === 'Actif');
                const avgCommission = models.length > 0 ? 
                    (models.reduce((sum, m) => sum + m.commission, 0) / models.length).toFixed(1) : 0;
                
                // Calculer les revenus estimés basés sur les revenus de chaque modèle
                const estimatedRevenue = activeModels.reduce((sum, model) => {
                    return sum + (model.estimatedRevenue || 0);
                }, 0);

                // Mettre à jour les statistiques du bas (si elles existent)
                const avgElement = document.getElementById('average-commission');
                const activeElement = document.getElementById('active-models-count');
                const revenueElement = document.getElementById('estimated-revenue');

                if (avgElement) {
                    avgElement.textContent = avgCommission + '%';
                    console.log('✅ Average commission global mis à jour');
                } else {
                    console.log('ℹ️ Average commission global non trouvé');
                }
                
                if (activeElement) {
                    activeElement.textContent = activeModels.length;
                    console.log('✅ Active count global mis à jour');
                } else {
                    console.log('ℹ️ Active count global non trouvé');
                }
                
                if (revenueElement) {
                    revenueElement.textContent = estimatedRevenue + '€';
                    console.log('✅ Revenue global mis à jour');
                } else {
                    console.log('ℹ️ Revenue global non trouvé');
                }

                // Synchroniser avec le header
                updateHeaderStats(models);
                
            } catch (error) {
                console.error('❌ Erreur dans updateGlobalStats:', error);
            }
        }

        // Fonction de notification
        function showNotification(message, type = 'info') {
            // Créer l'élément de notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'linear-gradient(135deg, #22c55e, #16a34a)' : 
                            type === 'warning' ? 'linear-gradient(135deg, #f59e0b, #d97706)' :
                            'linear-gradient(135deg, #3b82f6, #2563eb)'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                z-index: 999999;
                font-weight: 600;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;

            // Ajouter les styles d'animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(notification);

            // Supprimer après 3 secondes
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Fonction pour afficher des informations sur les revenus estimés
        function showRevenueInfo() {
            console.log('ℹ️ Affichage info revenus estimés');
            
            showNotification('💡 Les revenus estimés sont calculés automatiquement à partir des revenus individuels de vos modèles. Modifiez les revenus de chaque modèle pour ajuster ce total.', 'info', 4000);
        }

        // Fonction pour éditer les revenus estimés
        function editEstimatedRevenue() {
            console.log('✏️ Édition des revenus estimés');
            
            // Créer un modal d'édition
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(18,7,45,0.95);
                z-index: 999999;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(15px);
            `;
            
            const currentRevenue = localStorage.getItem('custom_estimated_revenue') || '0';
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1a093e, #120726);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 400px;
                    width: 90%;
                    border: 2px solid #b48aff;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                    text-align: center;
                " onclick="event.stopPropagation();">
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
                        <i class="fas fa-euro-sign" style="color: white; font-size: 1.5em;"></i>
                    </div>
                    
                    <h3 style="color: #f5f5fa; margin: 0 0 10px 0;">Revenus Estimés</h3>
                    <p style="color: rgba(245,245,250,0.7); margin: 0 0 25px 0; font-size: 0.9em;">
                        Définissez le montant de revenus estimés pour vos calculs
                    </p>
                    
                    <div style="margin-bottom: 25px;">
                        <input type="number" id="revenue-input" value="${currentRevenue}" min="0" step="100" 
                               placeholder="1000" style="
                            width: 100%;
                            border-radius: 12px;
                            border: 2px solid rgba(180,138,255,0.3);
                            background: rgba(180,138,255,0.05);
                            color: #f5f5fa;
                            padding: 15px;
                            font-size: 1.2em;
                            text-align: center;
                            font-weight: bold;
                            box-sizing: border-box;
                        ">
                        <div style="color: rgba(245,245,250,0.6); font-size: 0.8em; margin-top: 8px;">
                            Montant en euros
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px;">
                        <button onclick="closeRevenueModal()" style="
                            flex: 1;
                            background: rgba(107,114,128,0.2);
                            border: 2px solid rgba(107,114,128,0.3);
                            border-radius: 12px;
                            padding: 12px;
                            color: #9ca3af;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            Annuler
                        </button>
                        <button onclick="saveEstimatedRevenue()" style="
                            flex: 1;
                            background: linear-gradient(135deg, #3b82f6, #2563eb);
                            border: none;
                            border-radius: 12px;
                            padding: 12px;
                            color: white;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            Sauvegarder
                        </button>
                    </div>
                </div>
            `;
            
            // Fermer le modal en cliquant à l'extérieur
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeRevenueModal();
                }
            });
            
            document.body.appendChild(modal);
            
            // Focus sur l'input
            setTimeout(() => {
                document.getElementById('revenue-input').focus();
                document.getElementById('revenue-input').select();
            }, 100);
            
            // Fonction pour fermer le modal
            window.closeRevenueModal = function() {
                document.body.removeChild(modal);
                delete window.closeRevenueModal;
                delete window.saveEstimatedRevenue;
            };
            
            // Fonction pour sauvegarder
            window.saveEstimatedRevenue = function() {
                const newRevenue = document.getElementById('revenue-input').value;
                const revenueAmount = parseInt(newRevenue) || 0;
                
                // Sauvegarder dans localStorage
                localStorage.setItem('custom_estimated_revenue', revenueAmount.toString());
                
                // Mettre à jour l'affichage
                const headerElement = document.getElementById('estimated-revenue-header');
                if (headerElement) {
                    const euroSign = headerElement.querySelector('.euro-amount') || headerElement.firstChild;
                    if (euroSign && euroSign.nodeType === Node.TEXT_NODE) {
                        euroSign.textContent = revenueAmount + '€';
                    } else {
                        headerElement.innerHTML = `${revenueAmount}€<i class="fas fa-edit" style="font-size: 0.5em; position: absolute; top: -5px; right: -15px; color: rgba(59,130,246,0.6);"></i>`;
                    }
                }
                
                showNotification(`✅ Revenus estimés mis à jour : ${revenueAmount}€`, 'success');
                closeRevenueModal();
                
                console.log('💰 Revenus estimés sauvegardés :', revenueAmount);
            };
            
            // Gestion de la touche Entrée
            document.getElementById('revenue-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveEstimatedRevenue();
                }
            });
        }
        
        // Fonction pour éditer les revenus d'un modèle spécifique
        function editModelRevenue(modelIndex) {
            console.log(`✏️ Édition des revenus pour le modèle ${modelIndex}`);
            
            const models = JSON.parse(localStorage.getItem('models') || '[]');
            if (!models[modelIndex]) {
                console.error('❌ Modèle introuvable:', modelIndex);
                showNotification('❌ Erreur: Modèle introuvable', 'error');
                return;
            }
            
            const model = models[modelIndex];
            const currentRevenue = model.estimatedRevenue || 0;
            
            // Créer un modal d'édition
            const modal = document.createElement('div');
            modal.id = 'model-revenue-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(18,7,45,0.95);
                z-index: 999999;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(15px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1a093e, #120726);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 450px;
                    width: 90%;
                    border: 2px solid #b48aff;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                    text-align: center;
                " onclick="event.stopPropagation();">
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
                        <i class="fas fa-euro-sign" style="color: white; font-size: 1.5em;"></i>
                    </div>
                    
                    <h3 style="color: #f5f5fa; margin: 0 0 10px 0;">Revenus de ${model.name}</h3>
                    <p style="color: rgba(245,245,250,0.7); margin: 0 0 25px 0; font-size: 0.9em;">
                        Définissez les revenus mensuels estimés pour ce modèle
                    </p>
                    
                    <div style="margin-bottom: 20px;">
                        <input type="number" id="model-revenue-input" value="${currentRevenue}" placeholder="Ex: 2500" style="
                            width: 100%;
                            background: rgba(180,138,255,0.1);
                            border: 2px solid rgba(180,138,255,0.3);
                            border-radius: 12px;
                            padding: 15px;
                            color: #f5f5fa;
                            font-size: 1.1em;
                            text-align: center;
                            box-sizing: border-box;
                        " onfocus="this.style.borderColor='#b48aff'" onblur="this.style.borderColor='rgba(180,138,255,0.3)'">
                        <div style="color: rgba(245,245,250,0.6); font-size: 0.9em; margin-top: 8px;">
                            Commission agence: <span style="color: #f59e0b; font-weight: 600;" id="preview-commission">${((currentRevenue || 0) * model.commission / 100).toFixed(0)}€</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px;">
                        <button onclick="closeModelRevenueModal()" style="
                            flex: 1;
                            background: rgba(107,114,128,0.2);
                            border: 2px solid rgba(107,114,128,0.3);
                            border-radius: 12px;
                            padding: 12px;
                            color: #9ca3af;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            Annuler
                        </button>
                        <button onclick="saveModelRevenue(${modelIndex})" style="
                            flex: 2;
                            background: linear-gradient(135deg, #3b82f6, #2563eb);
                            border: none;
                            border-radius: 12px;
                            padding: 12px;
                            color: white;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            <i class="fas fa-save"></i> Sauvegarder
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Focus sur l'input
            setTimeout(() => {
                const input = document.getElementById('model-revenue-input');
                input.focus();
                input.select();
            }, 100);
            
            // Fermer le modal en cliquant à l'extérieur
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModelRevenueModal();
                }
            });
            
            // Mettre à jour la prévisualisation en temps réel
            const input = document.getElementById('model-revenue-input');
            input.addEventListener('input', function() {
                const revenue = parseInt(this.value) || 0;
                const commission = (revenue * model.commission / 100).toFixed(0);
                document.getElementById('preview-commission').textContent = commission + '€';
            });
            
            // Gestion de la touche Entrée et Échap
            modal.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    saveModelRevenue(modelIndex);
                } else if (e.key === 'Escape') {
                    closeModelRevenueModal();
                }
            });
        }
        
        // Fonction pour sauvegarder les revenus d'un modèle
        window.saveModelRevenue = function(modelIndex) {
            try {
                console.log('💾 Début sauvegarde revenus pour modèle:', modelIndex);
                
                const input = document.getElementById('model-revenue-input');
                if (!input) {
                    console.error('❌ Input model-revenue-input introuvable');
                    showNotification('❌ Erreur: Champ de saisie introuvable', 'error');
                    return;
                }
                
                const newRevenue = input.value;
                const revenueAmount = parseInt(newRevenue) || 0;
                
                console.log('💰 Nouveau montant:', revenueAmount);
                
                // Charger les modèles
                const models = JSON.parse(localStorage.getItem('models') || '[]');
                if (!models[modelIndex]) {
                    console.error('Modèle introuvable pour sauvegarde:', modelIndex);
                    showNotification('❌ Erreur: Modèle introuvable', 'error');
                    return;
                }
                
                console.log('📋 Modèle trouvé:', models[modelIndex].name);
                
                // Mettre à jour les revenus du modèle
                models[modelIndex].estimatedRevenue = revenueAmount;
                models[modelIndex].lastModified = new Date().toISOString();
                
                // Sauvegarder dans localStorage
                localStorage.setItem('models', JSON.stringify(models));
                console.log('✅ Sauvegarde localStorage effectuée');
                
                // Fermer le modal d'abord
                closeModelRevenueModal();
                
                // Rafraîchir l'affichage des modèles
                setTimeout(() => {
                    loadModelsFromStorage();
                    updateFinancialStats(); // Mettre à jour les indicateurs financiers
                    showNotification(`✅ Revenus de ${models[modelIndex].name} mis à jour : ${revenueAmount}€`, 'success');
                }, 100);
                
                console.log(`💰 Revenus du modèle ${models[modelIndex].name} sauvegardés :`, revenueAmount);
                
            } catch (error) {
                console.error('❌ Erreur dans saveModelRevenue:', error);
                showNotification('❌ Erreur lors de la sauvegarde', 'error');
            }
        };
        
        // Fonction pour fermer le modal de revenus des modèles
        window.closeModelRevenueModal = function() {
            const modal = document.getElementById('model-revenue-modal');
            if (modal) {
                modal.remove();
            }
        };
        
        // Exposer les fonctions globalement
        window.saveInvoice = saveInvoice;
        window.getInvoices = getInvoices;
        window.displayInvoices = displayInvoices;
        window.deleteInvoice = deleteInvoice;
        window.editInvoice = editInvoice;
        window.updateInvoiceStatus = updateInvoiceStatus;
        window.updateDropdownVisual = updateDropdownVisual;
        window.createEditModal = createEditModal;
        window.closeEditModal = closeEditModal;
        window.saveInvoiceChanges = saveInvoiceChanges;
        window.convertDateForInput = convertDateForInput;
        window.convertDateToFrench = convertDateToFrench;
        
        // Exposer les nouvelles fonctions financières
        window.updateFinancialStats = updateFinancialStats;
        window.calculateFinancialStats = calculateFinancialStats;
        window.updateFinancialDisplay = updateFinancialDisplay;
        window.initializeFinancialStats = initializeFinancialStats;
        window.refreshFinancialDashboard = refreshFinancialDashboard;
        window.convertFrenchDateToISO = convertFrenchDateToISO;
        
        // Exposer les nouvelles fonctions de commission
        window.calculateCommission = calculateCommission;
        window.updateCommissionRate = updateCommissionRate;
        window.setCommissionRate = setCommissionRate;
        window.updateCommissionButtons = updateCommissionButtons;
        window.saveDefaultCommissionSettings = saveDefaultCommissionSettings;
        window.loadDefaultCommissionSettings = loadDefaultCommissionSettings;
        window.calculateEditCommission = calculateEditCommission;
        window.updateEditCommissionRate = updateEditCommissionRate;
        
        // Exposer les nouvelles fonctions de modèles de commission
        window.updateCommissionModel = updateCommissionModel;
        window.saveCommissionModel = saveCommissionModel;
        window.applyCommissionModel = applyCommissionModel;
        window.getCommissionSettings = getCommissionSettings;
        window.resetCommissionModels = resetCommissionModels;
        window.exportCommissionSettings = exportCommissionSettings;
        window.initializeCommissionModels = initializeCommissionModels;
        
        // Fonction de test pour déboguer le modal
        window.testModalAddModel = function() {
            console.log('🧪 Test du modal d\'ajout de modèle');
            
            // Vérifier que les éléments existent
            const modal = document.getElementById('add-model-modal');
            const form = document.getElementById('add-model-form');
            const nameInput = document.getElementById('model-name');
            const usernameInput = document.getElementById('model-username');
            const commissionInput = document.getElementById('model-commission');
            
            console.log('Tests éléments:');
            console.log('- Modal:', !!modal, modal);
            console.log('- Form:', !!form, form);
            console.log('- Name Input:', !!nameInput, nameInput);
            console.log('- Username Input:', !!usernameInput, usernameInput);
            console.log('- Commission Input:', !!commissionInput, commissionInput);
            
            if (modal) {
                console.log('- Modal display:', modal.style.display);
                console.log('- Modal HTML:', modal.innerHTML.substring(0, 200) + '...');
            }
            
            // Test d'ouverture du modal
            try {
                openAddModelModal();
                console.log('✅ Modal ouvert avec succès');
            } catch (e) {
                console.error('❌ Erreur ouverture modal:', e);
            }
        };
        
        // Fonction de test pour ajouter un modèle de test
        window.testAddModel = function() {
            console.log('🧪 Test d\'ajout de modèle');
            
            // Remplir le formulaire
            const nameInput = document.getElementById('model-name');
            const usernameInput = document.getElementById('model-username');
            const commissionInput = document.getElementById('model-commission');
            
            if (nameInput) nameInput.value = 'Test Model';
            if (usernameInput) usernameInput.value = '@testmodel';
            if (commissionInput) commissionInput.value = '30';
            
            // Déclencher la soumission
            const event = new Event('submit');
            submitAddModelForm(event);
        };
        
        // Exposer les nouvelles fonctions de gestion des modèles individuels
        window.loadModelsFromStorage = loadModelsFromStorage;
        window.displayModels = displayModels;
        window.createModelCard = createModelCard;
        window.openAddModelModal = openAddModelModal;
        window.closeAddModelModal = closeAddModelModal;
        window.updateCommissionPreview = updateCommissionPreview;
        window.submitAddModelForm = submitAddModelForm;
        window.updateModelCommission = updateModelCommission;
        window.saveModelCommission = saveModelCommission;
        window.toggleModelStatus = toggleModelStatus;
        window.deleteModel = deleteModel;
        window.editModel = editModel;
        window.editModelRevenue = editModelRevenue;
        window.updateModelsCount = updateModelsCount;
        window.updateGlobalStats = updateGlobalStats;
        window.updateHeaderStats = updateHeaderStats;
        window.showNotification = showNotification;
        
        // Expose les fonctions globalement
        window.openBackupModal = openBackupModal;
        window.closeBackupModal = closeBackupModal;
        
        // Fonction de test
        window.testInvoiceModal = function() {
            console.log('🧪 Test du modal de facture...');
            openBackupModal();
        };
        
        // Message de confirmation au chargement
        window.addEventListener('load', function() {
            console.log('✅ Modal de facture de secours prêt !');
            console.log('🔧 Pour tester : testInvoiceModal()');
            
            // Afficher les factures existantes au chargement
            setTimeout(() => {
                displayInvoices();
                // Initialiser les statistiques financières
                updateFinancialStats();
                // Charger les paramètres de commission par défaut
                loadDefaultCommissionSettings();
                // Initialiser les modèles de commission
                initializeCommissionModels();
            }, 500);
            
            // Mettre à jour immédiatement aussi
            updateFinancialStats();
        });
        
        // Fonction pour ajouter automatiquement le modèle Lea
        function initializeLeaModel() {
            console.log('🎭 Initialisation du modèle Lea...');
            
            // Récupérer les modèles existants
            let models = JSON.parse(localStorage.getItem('models') || '[]');
            
            // Vérifier si Lea existe déjà
            const leaExists = models.find(model => model.name === 'Lea' || model.onlyfansName === 'Leaaaa');
            
            if (!leaExists) {
                // Créer le modèle Lea
                const leaModel = {
                    id: Date.now(),
                    name: 'Lea',
                    onlyfansName: 'Leaaaa',
                    commission: 30,
                    estimatedRevenue: 0,
                    dateAdded: new Date().toISOString()
                };
                
                // Ajouter Lea à la liste
                models.push(leaModel);
                
                // Sauvegarder dans localStorage
                localStorage.setItem('models', JSON.stringify(models));
                
                console.log('✅ Modèle Lea ajouté:', leaModel);
                
                // Forcer le rechargement des modèles immédiatement
                setTimeout(() => {
                    console.log('🔄 Rechargement forcé des modèles...');
                    loadModelsFromStorage();
                }, 100);
                
                // Afficher notification
                setTimeout(() => {
                    showNotification('🎭 Modèle "Lea" ajouté avec succès ! Commission: 30%', 'success');
                }, 500);
            } else {
                console.log('ℹ️ Le modèle Lea existe déjà');
                // Forcer le rechargement même si Lea existe déjà
                setTimeout(() => {
                    loadModelsFromStorage();
                }, 100);
            }
        }
        
        // Fonction de débogage pour vérifier les modèles
        function debugModels() {
            console.log('=== DEBUG MODÈLES ===');
            const models = JSON.parse(localStorage.getItem('models') || '[]');
            console.log('📊 Modèles dans localStorage:', models.length);
            models.forEach((model, index) => {
                console.log(`${index + 1}. ${model.name} (@${model.onlyfansName || 'N/A'}) - ${model.commission}%`);
            });
            
            const modelsList = document.getElementById('models-list');
            console.log('📋 Container models-list:', !!modelsList);
            if (modelsList) {
                console.log('   - Display:', modelsList.style.display);
                console.log('   - Children:', modelsList.children.length);
            }
            console.log('==================');
            return models;
        }
        
        // Rendre debugModels accessible globalement
        window.debugModels = debugModels;
        
        // Fonction de test pour le modal
        function testModal() {
            console.log('🧪 Test du modal...');
            openAddModelModal();
            console.log('✅ Modal ouvert');
        }
        window.testModal = testModal;
        
        // Aussi au DOMContentLoaded pour plus de sécurité
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM chargé - Initialisation des modèles');
            
            // Initialiser le modèle Lea automatiquement
            initializeLeaModel();
            
            setTimeout(() => {
                updateFinancialStats();
                displayInvoices();
                // Initialiser les modèles de commission aussi ici
                initializeCommissionModels();
                
                // Charger les modèles explicitement (avec timeout supplémentaire)
                setTimeout(() => {
                    console.log('🔄 Rechargement final des modèles...');
                    loadModelsFromStorage();
                    
                    // Double vérification avec debugModels
                    setTimeout(() => {
                        debugModels();
                    }, 500);
                }, 200);
                
                // Vérifier que les fonctions sont bien attachées
                console.log('✅ Fonctions disponibles:');
                console.log('- openAddModelModal:', typeof window.openAddModelModal);
                console.log('- submitAddModelForm:', typeof window.submitAddModelForm);
                console.log('- loadModelsFromStorage:', typeof window.loadModelsFromStorage);
                
                // Vérifier que tous les éléments critiques sont présents
                console.log('🔍 Vérification des éléments du modal:');
                
                const modal = document.getElementById('add-model-modal');
                const form = document.getElementById('add-model-form');
                const nameInput = document.getElementById('model-name');
                const commissionInput = document.getElementById('model-commission');
                
                console.log('- Modal présent:', !!modal);
                console.log('- Form présent:', !!form);
                console.log('- Name input présent:', !!nameInput);
                console.log('- Commission input présent:', !!commissionInput);
                
                if (modal && form && nameInput && commissionInput) {
                    console.log('✅ Tous les éléments du modal sont présents');
                    console.log('🎯 Vous pouvez utiliser testModalAddModel() et testAddModel() pour déboguer');
                } else {
                    console.warn('⚠️ Certains éléments du modal manquent');
                    console.log('🔧 Essayez de recharger la page ou vérifiez le HTML');
                    
                    // Diagnostic plus poussé
                    if (!modal) console.error('❌ Modal add-model-modal manquant');
                    if (!form) console.error('❌ Form add-model-form manquant');
                    if (!nameInput) console.error('❌ Input model-name manquant');
                    if (!commissionInput) console.error('❌ Input model-commission manquant');
                }
                
                console.log('📋 Commandes de debug disponibles:');
                console.log('  - testModalAddModel() : teste le modal');
                console.log('  - testAddModel() : teste l\'ajout d\'un modèle');
                console.log('  - loadModelsFromStorage() : recharge les modèles');
                
            }, 100);
        });

        // Fonction pour mettre à jour les indicateurs financiers
        function updateFinancialStats() {
            try {
                const models = JSON.parse(localStorage.getItem('models') || '[]');
                let totalRevenue = 0;
                let totalCommissions = 0;
                let activeModels = 0;
                
                models.forEach(model => {
                    if (model.estimatedRevenue && model.estimatedRevenue > 0) {
                        const revenue = parseFloat(model.estimatedRevenue);
                        const commission = parseFloat(model.commission) / 100;
                        
                        totalRevenue += revenue;
                        totalCommissions += revenue * commission;
                        activeModels++;
                    }
                });
                
                // Mise à jour des éléments DOM
                const totalRevenueElement = document.getElementById('total-revenue');
                const currentInvoicesElement = document.getElementById('current-invoices');
                const overdueInvoicesElement = document.getElementById('overdue-invoices');
                const totalCommissionsElement = document.getElementById('total-commissions');
                
                if (totalRevenueElement) {
                    totalRevenueElement.textContent = totalRevenue.toFixed(0) + ' €';
                }
                
                if (currentInvoicesElement) {
                    currentInvoicesElement.textContent = activeModels;
                }
                
                if (overdueInvoicesElement) {
                    // Pour les factures en retard, on peut utiliser une logique différente
                    // Pour l'instant, on met 0
                    overdueInvoicesElement.textContent = '0';
                }
                
                if (totalCommissionsElement) {
                    totalCommissionsElement.textContent = totalCommissions.toFixed(0) + ' €';
                }
                
                console.log('✅ Indicateurs financiers mis à jour:', {
                    totalRevenue: totalRevenue.toFixed(0) + ' €',
                    activeModels,
                    totalCommissions: totalCommissions.toFixed(0) + ' €'
                });
                
            } catch (error) {
                console.error('❌ Erreur lors de la mise à jour des stats financières:', error);
                
                // Valeurs par défaut en cas d'erreur
                const elements = ['total-revenue', 'current-invoices', 'overdue-invoices', 'total-commissions'];
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = '--';
                });
            }
        }

        // Initialisation simple
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ Dashboard chargé avec succès');
        });

        // Fonction globale pour déclencher des animations de succès (désactivée)
        window.triggerSuccessAnimation = function(selector) {
            console.log('Animation désactivée pour:', selector);
        };
    </script>

</body>
</html>


